(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["ymaps"],{58040:t=>{function e(){var t;this.getSetting=function(t){var e=this._errorSettings[t];return null===e?null:e||""},function(t,e){var o={client:["690.2354",1e3,100,0],uncaught:["690.2361",100,10,0],external:["690.2854",100,10,0],script:["690.2609",100,10,0]},i={};e.ERROR_LEVEL={INFO:"info",DEBUG:"debug",WARN:"warn",ERROR:"error",FATAL:"fatal"},e._errorSettings={clck:"https://yandex.ru/clck/click",beacon:!0,project:"unknown",page:"",env:"",experiments:[],additional:{},platform:"",region:"",dc:"",host:"",service:"",level:"",version:"",yandexuid:"",coordinates_gp:"",referrer:!0,preventError:!1,unhandledRejection:!1,uncaughtException:!0,debug:!1,limits:{},silent:{},filters:{},pageMaxAge:864e6,initTimestamp:+new Date};var n=!1;function r(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);return t}function a(t){return"boolean"==typeof t&&(t=+t),"number"==typeof t?t+"":null}e.initErrors=function(o){r(e._errorSettings,o),!n&&e._errorSettings.uncaughtException&&(!function(){var o=e._errorSettings;if(t.addEventListener)t.addEventListener("error",s),o.resourceFails&&t.addEventListener("error",u,!0),"Promise"in t&&o.unhandledRejection&&t.addEventListener("unhandledrejection",(function(t){var e,o=t.reason,i={};o&&(o.stack&&o.message?e=o.message:"[object Event]"===(e=String(o))?e="event.type: "+o.type:"[object Object]"===e&&(i.unhandledObject=o),o.target&&o.target.src&&(i.src=o.target.src),s({message:"Unhandled rejection: "+e,stack:o.stack,additional:i}))}));else{var i=t.onerror;t.onerror=function(t,e,o,n,r){s({error:r||new Error(t||"Empty error"),message:t,lineno:o,colno:n,filename:e}),i&&i.apply(this,arguments)}}}(),n=!0)},e.updateErrors=function(t){r(e._errorSettings,t)},e.updateAdditional=function(t){e._errorSettings.additional=r(e._errorSettings.additional||{},t)},e._handleError=function(t,n){var r,a,s=e._errorSettings;if(s.preventError&&t.preventDefault&&t.preventDefault(),n)r=t,a="client";else{r=e._normalizeError(t),a=r.type;var u=s.onError;"function"==typeof u&&u(r);var l=s.transform;"function"==typeof l&&(r=l(r))}var c=+new Date,d=s.initTimestamp,p=s.pageMaxAge;if(!(-1!==p&&d&&d+p<c)){var h=o[a][1];"number"==typeof s.limits[a]&&(h=s.limits[a]);var _=o[a][2];"number"==typeof s.silent[a]&&(_=s.silent[a]);var m=o[a][3];if(m<h||-1===h){r.path=o[a][0];var f=e._getErrorData(r,{silent:m<_||-1===_?"no":"yes",isCustom:Boolean(n)},s),y=function(t){i[r.message]=!1,e._sendError(t.path,t.vars),o[a][3]++}.bind(this,f);if(void 0===s.throttleSend)y();else{if(i[r.message])return;i[r.message]=!0,setTimeout(y,s.throttleSend)}}}},e._getReferrer=function(e){var o=e.referrer,i=typeof o;return"function"===i?o():"string"===i&&o?o:!1!==o&&t.location?t.location.href:void 0},e._buildExperiments=function(t){return t instanceof Array?t.join(";"):""},e._buildAdditional=function(t,e){var o="";try{var i=r(r({},t),e);0!==Object.keys(i).length&&(o=JSON.stringify(i))}catch(n){}return o},e._getErrorData=function(o,i,n){i=i||{};var r=e._buildExperiments(n.experiments),s=e._buildAdditional(n.additional,o.additional),u={"-stack":o.stack,"-url":o.file,"-line":o.line,"-col":o.col,"-block":o.block,"-method":o.method,"-msg":o.message,"-env":n.env,"-external":o.external,"-externalCustom":o.externalCustom,"-project":n.project,"-service":o.service||n.service,"-page":o.page||n.page,"-platform":n.platform,"-level":o.level,"-experiments":r,"-version":n.version,"-region":n.region,"-dc":n.dc,"-host":n.host,"-yandexuid":n.yandexuid,"-coordinates_gp":o.coordinates_gp||n.coordinates_gp,"-referrer":e._getReferrer(n),"-source":o.source,"-sourceMethod":o.sourceMethod,"-type":i.isCustom?o.type:"","-additional":s,"-adb":a(Ya.blocker)||a(n.blocker),"-cdn":t.YaStaticRegion,"-ua":navigator.userAgent,"-silent":i.silent,"-ts":+new Date,"-init-ts":n.initTimestamp};return n.debug&&t.console&&console[console[o.level]?o.level:"error"]("[error-counter] "+o.message,u,o.stack),{path:o.path,vars:u}},e._baseNormalizeError=function(t){var e=(t=t||{}).error,o=t.filename||t.fileName||"",i=e&&e.stack||t.stack||"",n=t.message||"",r=e&&e.additional||t.additional;return{file:o,line:t.lineno||t.lineNumber,col:t.colno||t.colNumber,stack:i,message:n,additional:r}},e._normalizeError=function(t){var o=e._baseNormalizeError(t),i="uncaught",n=e._isExternalError(o.file,o.message,o.stack),r="",a="";return n.hasExternal?(i="external",r=n.common,a=n.custom):/^Script error\.?$/.test(o.message)&&(i="script"),o.external=r,o.externalCustom=a,o.type=i,o},e._createVarsString=function(t){var e=[];for(var o in t)t.hasOwnProperty(o)&&(t[o]||0===t[o])&&e.push(o+"="+encodeURIComponent(t[o]).replace(/\*/g,"%2A"));return e.join(",")},e._sendError=function(t,o){e.send(null,t,e._createVarsString(o),null,null,null,null)};var s=function(t){e._handleError(t,!1)},u=function(t){var o=t.target;if(o){var i=o.srcset||o.src;if(i||(i=o.href),i){var n=o.tagName||"UNKNOWN";e.logError({message:n+" load error",additional:{src:i}})}}}}("undefined"!=typeof self?self:window,this),(t=this).logError=function(e,o){e=e||{},"string"!=typeof o&&void 0!==o||((o=new Error(o)).justCreated=!0);var i=e.message||"",n=t._baseNormalizeError(o);n.message&&(i&&(i+="; "),i+=n.message),n.message=i||"Empty error";for(var r=["service","source","type","block","additional","level","page","method","sourceMethod","coordinates_gp"],a=0;a<r.length;a++){var s=r[a];e[s]?n[s]=e[s]:o&&o[s]&&(n[s]=o[s])}t._handleError(n,!0)},function(t){function e(){var e=t.getSetting("clck"),o=t.countersBatchData.join("\r\n");if((t.countersBatchData=[],t.counterTimerId=null,e)&&!(navigator.sendBeacon&&t.getSetting("beacon")&&navigator.sendBeacon(e,o)))if("undefined"!=typeof self&&self.fetch)fetch(e,{method:"POST",body:o});else{var i=new XMLHttpRequest;i.open("POST",e),i.send(o)}}t.countersBatchData=[],t.counterTimerId,t.send=function(o,i,n,r,a,s,u){clearTimeout(t.counterTimerId);var l=function(e,o,i,n,r,a){var s=t.getSetting("slots");return[a?"/"+a.join("/"):"","/path="+o,s?"/slots="+s.join(";"):"",i?"/vars="+i:"","/cts="+(new Date).getTime(),"/*"]}(0,i,n,0,0,u);t.countersBatchData.push("/reqid="+t.getSetting("reqid")+l.join("")),t.countersBatchData.length<42?t.counterTimerId=setTimeout(e,15):e()}}(this),function(t){var e={url:{0:/(miscellaneous|extension)_bindings/,1:/^chrome:/,2:/kaspersky-labs\.com\//,3:/^(?:moz|chrome)-extension:\/\//,4:/^file:/,5:/^resource:\/\//,6:/webnetc\.top/,7:/local\.adguard\.com/},message:{0:/__adgRemoveDirect/,1:/Content Security Policy/,2:/vid_mate_check/,3:/ucapi/,4:/Access is denied/i,5:/^Uncaught SecurityError/i,6:/__ybro/,7:/__show__deepen/,8:/ntp is not defined/,9:/Cannot set property 'install' of undefined/,10:/NS_ERROR/,11:/Error loading script/,12:/^TypeError: undefined is not a function$/,13:/__firefox__\.(?:favicons|metadata|reader|searchQueryForField|searchLoginField)/},stack:{0:/(?:moz|chrome)-extension:\/\//,1:/adguard.*\.user\.js/i}};function o(t,e){if(t&&e){var o=[];for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];"string"==typeof n&&(n=new RegExp(n)),n instanceof RegExp&&n.test(t)&&o.push(i)}return o.join("_")}}function i(t,i){var n,r=[];for(var a in e)e.hasOwnProperty(a)&&(n=o(t[a],i[a]))&&r.push(a+"~"+n);return r.join(";")}t._isExternalError=function(o,n,r){var a=t._errorSettings.filters||{},s={url:(o||"")+"",message:(n||"")+"",stack:(r||"")+""},u=i(s,e),l=i(s,a);return{common:u,custom:l,hasExternal:!(!u&&!l)}}}(this)}window.Ya=window.Ya||{},void 0!==t.exports?(t.exports=e,t.exports.default=e):window.Ya.ErrorLogger=e},40220:(t,e,o)=>{"use strict";o.r(e),o.d(e,{EventBlockerLayer:()=>n});var i=o(94578),n=function(t){function e(e){var o;return(o=t.call(this,e)||this).element=document.createElement("div"),o.element.style.width="100%",o.element.style.height="100%",o.element.style.position="absolute",o.element.style.top="0",o.element.style.left="0",o}(0,i.Z)(e,t);var o=e.prototype;return o.findObjectInPosition=function(){return{type:"empty-object"}},o.destroy=function(){},e}(o(39670).x)},26267:(t,e,o)=>{"use strict";o.d(e,{_:()=>n});var i=o(41372),n=function(t){function e(o){var i=t.call(this,void 0===o?"Aborted":o)||this;return i.name="AbortError",i.__proto__=e.prototype,i}return(0,i.ZT)(e,t),e}(Error)},86457:(t,e,o)=>{"use strict";o.d(e,{GA:()=>c});var i=o(41372),n=o(9902),r=(0,n.Symbol)("EventEmitter"),a=(0,n.Symbol)("EventEmitter.MixinConstructor"),s=(0,n.Symbol)("EventEmitter.MixinPrototype"),u=function(){function t(){}return t[a]=function(t){t._eventListenersHash={}},t[s]=function(e){e[r]=t.prototype[r],e.group=t.prototype.group,e.on=t.prototype.on,e.offSingle=t.prototype.offSingle,e._emit=t.prototype._emit},t.prototype.on=function(t,e){return this.group().on(t,e)},t.prototype.offSingle=function(t,e){var o=this._eventListenersHash[t];o&&o.delete(e)},t.prototype.group=function(){return new t._eventGroupImpl(this)},t.prototype._emit=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var i=this._eventListenersHash[t],n=void 0;if(i){var r=[];i.forEach((function(t){return r.push(t)}));for(var a=0,s=r;a<s.length;a++){var u=s[a],l=u(e[0]);void 0!==l&&(n=l)}}return n},t._eventGroupImpl=function(){function t(t){this._listeners=[],this._emitter=t}return t.prototype.on=function(t,e){var o=this._emitter._eventListenersHash[t];return o?o.add(e):(this._emitter._eventListenersHash[t]=new n.Set,this._emitter._eventListenersHash[t].add(e)),this._listeners.push([t,e]),this},t.prototype.offAll=function(){for(var t=0,e=this._listeners;t<e.length;t++){var o=e[t],i=o[0],n=o[1];this._emitter._eventListenersHash[i].delete(n)}this._listeners=[]},t}(),t}();u.prototype[r]=!0;var l=function(){},c=function(t){return void 0===t&&(t=l),{with:function(){if(e=t.prototype,Boolean(e&&e[r]))return t;var e,o=function(t){function e(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];var i=t.apply(this,e)||this;return u[a](i),i}return(0,i.ZT)(e,t),e}(t);return u[s](o.prototype),o}}}},85623:(t,e,o)=>{"use strict";o.d(e,{Cr:()=>r,ZE:()=>a,$7:()=>s,JO:()=>u});var i=o(41372),n=o(27486);function r(t,e){return(0,i.pi)((0,i.pi)({},t),{geometry:t.geometry&&a(t.geometry,e)})}function a(t,e){switch(t.type){case"Point":return(0,i.pi)((0,i.pi)({},t),{coordinates:e(t.coordinates)});case"LineString":return(0,i.pi)((0,i.pi)({},t),{coordinates:t.coordinates.map(e)});case"MultiLineString":return(0,i.pi)((0,i.pi)({},t),{coordinates:t.coordinates.map((function(t){return t.map(e)}))});case"Polygon":return(0,i.pi)((0,i.pi)({},t),{coordinates:t.coordinates.map((function(t){return t.map(e)}))});case"MultiPolygon":return(0,i.pi)((0,i.pi)({},t),{coordinates:t.coordinates.map((function(t){return t.map((function(t){return t.map(e)}))}))});default:(0,n._y)(new Error("Unexpected geometry type: ".concat(t.type)))}}function s(t){var e;return"FeatureCollection"===t.type?(e=[]).concat.apply(e,t.features.map((function(t){return s(t)}))):[t]}function u(t){"string"!=typeof t.id&&(0,n._y)(new Error("Feature or collection id must be a string"))}},12949:(t,e,o)=>{"use strict";o.d(e,{I:()=>l,o:()=>u});var i=o(41372),n=o(9902),r=o(85623),a=o(45428),s=o(86457),u="__root__",l=function(t){function e(e){var o=(void 0===e?{}:e).disablePointGeometry,i=t.call(this)||this;return i._features=new n.Map,i._groups=new n.Map([[u,{type:"group",id:u,style:(0,a.as)({}),children:[],parentGroupId:null}]]),i._disablePointGeometry=Boolean(o),i}return(0,i.ZT)(e,t),Object.defineProperty(e.prototype,"features",{get:function(){return this._features},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groups",{get:function(){return this._groups},enumerable:!1,configurable:!0}),e.prototype.addGroup=function(t,e,o){var i={type:"group",id:t,style:(0,a.as)(e),children:[],parentGroupId:o};this._addChild(o,i),this._groups.set(t,i),this._emit("groupAdded",t),this._emit("changed")},e.prototype.removeGroupAndChildren=function(t){if(this._groups.has(t)){for(var e=this._groups.get(t),o=[e],i=[];o.length>0;){var n=o.pop();i.push(n);for(var r=0,a=n.children;r<a.length;r++){var s=a[r];"feature"===s.type?(this._features.delete(s.id),i.push(s)):o.push(s)}this._groups.delete(n.id)}e.parentGroupId&&this._removeChild(e.parentGroupId,e),this._emit("groupRemoved",{id:t,removed:i}),this._emit("changed")}},e.prototype.addFeature=function(t,e,o,i){(0,r.JO)(t),this._assertPointIsAllowed(t);var n={type:"feature",id:t.id,feature:t,style:(0,a.oL)(t.geometry,e),bbox:o,parentGroupId:i};this._addChild(i,n),this._features.set(n.id,n),this._emit("featureAdded",n.id),this._emit("changed")},e.prototype.removeFeatureById=function(t){if(this._features.has(t)){var e=this._features.get(t);e.parentGroupId&&this._removeChild(e.parentGroupId,e),this._features.delete(t),this._emit("featureRemoved",t),this._emit("changed")}},e.prototype.updateFeature=function(t,e,o){this._assertPointIsAllowed(t);var i=this._features.get(t.id),n=this._features.get(t.id).parentGroupId,r={type:"feature",id:t.id,feature:t,style:o?(0,a.oL)(t.geometry,o):i.style,bbox:e,parentGroupId:n},s=this._groups.get(n),u=s.children.indexOf(i);s.children[u]=r,this._features.set(r.id,r),this._emit("featureUpdated",r.id),this._emit("changed")},e.prototype.hasFeatureWithId=function(t){return this._features.has(t)},e.prototype.getFeatureById=function(t){var e;return null!==(e=this._features.get(t))&&void 0!==e?e:null},e.prototype.moveFeatureToGroup=function(t,e){var o=this._features.get(t);o.parentGroupId!==e&&(this._removeChild(o.parentGroupId,o),this._addChild(e,o),o.parentGroupId=e,this._emit("featureMovedToGroup",t),this._emit("changed"))},e.prototype._addChild=function(t,e){this._groups.get(t).children.push(e)},e.prototype._removeChild=function(t,e){var o=this._groups.get(t),i=o.children.indexOf(e);o.children.splice(i,1)},e.prototype._assertPointIsAllowed=function(t){if(this._disablePointGeometry&&"Point"===t.geometry.type)throw new Error('Unexpected geometry type: "'.concat(t.geometry.type,'"'))},e}((0,s.GA)().with())},45428:(t,e,o)=>{"use strict";o.d(e,{oL:()=>l,as:()=>d,Zj:()=>u});var i=o(41372),n=o(9902);var r={width:1,opacity:1,color:"rgb(0,102,255)",palette:[],simplifyPalette:!0,dash:[]},a={url:"No icon url provided",offset:[0,0],scale:1},s={zIndex:0,opacity:1};function u(t){var e=(0,i.pi)((0,i.pi)({},r),t);return(0,i.pi)((0,i.pi)({},e),{dash:(0,i.ev)([],e.dash,!0),paletteColors:[]})}function l(t,e){var o=e.stroke||[r],s="LineString"===t.type?function(t,e){for(var o=t.coordinates.length-1,i=[],r=[],a=new n.Set,s=[],l=0,c=e;l<c.length;l++){var d=c[l],p=d.palette,h=u(d);if(r.push(h),p&&0!==p.length){for(var _=new n.Map,m=0,f=0;f<p.length;f++){var y=p[f],v=y.count,g=y.color;_.set(m,g),m+=v;var b=f===p.length-1||m>o;if(b||g!==p[f+1].color){var S=b?o:m;if(a.has(S)||(a.add(S),s.push(S)),b)break}}i.push({stopsColors:_,paletteColors:h.paletteColors})}}s.sort((function(t,e){return t-e}));for(var x=0,E=i;x<E.length;x++){var z=E[x],w=(_=z.stopsColors,z.paletteColors);for(w.push(_.get(0)),f=0;f<s.length-1;f++)g=_.get(s[f]),w.push("string"==typeof g?g:w[w.length-1])}return{paletteColorStops:s,stroke:r}}(t,o):{paletteColorStops:[],stroke:o.map(u)},l=s.stroke,d=s.paletteColorStops;return{zIndex:c(e.zIndex,0),fill:e.fill||"rgb(0,102,255)",fillOpacity:c(e.fillOpacity,.6),fillRule:e.fillRule||"evenodd",stroke:l,paletteColorStops:d,cursor:e.cursor||"inherit",interactive:c(e.interactive,!0),simplificationRate:c(e.simplificationRate,2),icon:(0,i.pi)((0,i.pi)({},a),e.icon)}}function c(t,e){return void 0!==t?t:e}function d(t){return(0,i.pi)((0,i.pi)({},s),t)}},72366:(t,e,o)=>{"use strict";o.d(e,{L:()=>i});var i="hidden"},67444:(t,e,o)=>{"use strict";function i(t,e){for(var o=e.x,i=e.y,n=t.length-1,r=!1,a=0;a<t.length;a++){var s=t[a].y<=i&&t[n].y>i||t[n].y<=i&&t[a].y>i,u=o>(t[n].x-t[a].x)*(i-t[a].y)/(t[n].y-t[a].y)+t[a].x;s&&u&&(r=!r),n=a}return r}function n(t,e){for(var o=1;o<t.length;o++)if(i(t[o],e))return!1;return i(t[0],e)}function r(t,e){if("Point"===t.type)return!1;if("LineString"===t.type)return!1;if("Polygon"===t.type)return n(t.coordinates,e);if("MultiPolygon"===t.type){for(var o=0,i=t.coordinates;o<i.length;o++){if(n(i[o],e))return!0}return!1}return!1}o.d(e,{u:()=>i,R:()=>r})},88367:(t,e,o)=>{"use strict";function i(t,e,o){return t-Math.floor((t-e)/(o-e))*(o-e)}function n(t,e,o){return Math.max(Math.min(t,o),e)}o.d(e,{d:()=>i,q:()=>n})},59027:(t,e,o)=>{"use strict";o.d(e,{$:()=>u,B:()=>s});var i=o(88084),n=o(80414),r=o(26267),a=o(27486),s=function(){var t=this;this.promise=new Promise((function(e,o){t.resolve=e,t.reject=function(t){t&&(0,a.H)(t),o(t)}}))},u=function(){function t(t){var e=this;this._queue=[],this._processing=[],this._paused=!1,this._changed=!1,this._onTaskAbort=function(t,o){var i=e._processing.indexOf(t);if(-1!==i)e._processing.splice(i,1);else{var n=e._queue.indexOf(t);-1!==n&&e._queue.splice(n,1),o.reject(new r._)}},this._maxConcurrency=t}return t.prototype.enqueue=function(t,e){var o=this;void 0===e&&(e=0);var n=new i.AbortController,r=new s,a={task:t,abortController:n,process:function(){return t(n.signal).then(r.resolve,r.reject)},priority:e};return n.signal.addEventListener("abort",(function(){return o._onTaskAbort(a,r)})),this._queue.push(a),this._changed=!0,this._paused||this._process(),{abortController:n,promise:r.promise,updatePriority:function(){a.priority=e,o._changed=!0}}},t.prototype.pause=function(){this._paused=!0},t.prototype.resume=function(){this._paused=!1,this._process()},t.prototype._process=function(){var t,e=this;if(!(this._processing.length>=this._maxConcurrency)){this._changed&&this._queue.sort((function(t,e){return t.priority-e.priority}));var o=this._queue.splice(0,this._maxConcurrency-this._processing.length);(t=this._processing).push.apply(t,o);for(var i=function(t){(0,n.promiseFinally)(t.process(),(function(){var o=e._processing.indexOf(t);-1!==o&&e._processing.splice(o,1),e._process()}))},r=0,a=o;r<a.length;r++){i(a[r])}}},t}()},34009:(t,e,o)=>{"use strict";o.d(e,{d:()=>u,_:()=>i});var i,n=o(41372),r=o(86457),a=o(59027),s=o(27486);!function(t){t[t.QUICK=1]="QUICK",t[t.INTERMEDIATE=2]="INTERMEDIATE",t[t.FULL=3]="FULL"}(i||(i={}));var u=function(t){function e(){var e=t.call(this)||this;return e._rafId=0,e._animationsCounter=0,e._framesSinceIntermediateRendering=0,e._renderFrame=function(){e._rafId=0,e._updateIsRequested=!1;var t=Date.now();try{e._emit("beforeRender",t);var o=e._getQualityForCurrentFrame();e._emit("render",{time:t,qualityHint:o})}catch(i){i&&"object"==typeof i&&e._lastTriggerStack&&(i.additionalInfo=e._lastTriggerStack),(0,s._y)(i)}e._isRunning&&e._requestFrame()},e._updateIsRequested=!1,e._isRunning=!1,e}return(0,n.ZT)(e,t),Object.defineProperty(e.prototype,"isActive",{get:function(){return this._isRunning},enumerable:!1,configurable:!0}),e.prototype.start=function(){this._isRunning=!0,this._requestFrame(),this._lastTriggerStack=(new Error).stack},e.prototype.stop=function(){this._isRunning&&(this._isRunning=!1,this._updateIsRequested||this._cancelFrame(),this._lastTriggerStack=void 0)},e.prototype.renderImmediately=function(t){var e=Date.now();this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=0),this._updateIsRequested=!1,this._emit("beforeRender",e),this._emit("render",{time:e,qualityHint:t})},e.prototype.update=function(){this._isRunning||(this._lastTriggerStack=(new Error).stack),this._updateIsRequested=!0,this._requestFrame()},e.prototype.destroy=function(){this._cancelFrame()},e.prototype.animate=function(t){var e=this;0===this._animationsCounter&&this.start(),this._animationsCounter++;var o=!0,i=this.on("beforeRender",(function(n){o?t(n):(i.offAll(),e._animationsCounter--,0===e._animationsCounter&&e.stop())})),n=new a.B;return{complete:n.promise,get isRunning(){return o},stop:function(){o?(o=!1,n.resolve()):console.warn("Trying to stop animation twice")}}},e.prototype.animateForDuration=function(t,e){var o=-1,i=this.animate((function(n){if(o<0)o=n;else{var r=(n-o)/e;r<1?t(r):(t(1),i.stop())}}));return i},e.prototype._requestFrame=function(){this._rafId||(this._rafId=requestAnimationFrame(this._renderFrame))},e.prototype._cancelFrame=function(){cancelAnimationFrame(this._rafId),this._rafId=0},e.prototype._getQualityForCurrentFrame=function(){return this._isRunning?this._framesSinceIntermediateRendering<12?(this._framesSinceIntermediateRendering++,i.QUICK):(this._framesSinceIntermediateRendering=1,i.INTERMEDIATE):(this._framesSinceIntermediateRendering=0,i.FULL)},e}((0,r.GA)().with())},33435:(t,e,o)=>{"use strict";o.d(e,{Nt:()=>l,PP:()=>d,B5:()=>c});var i=o(41372);function n(t,e){return t===e?null:{old:t,new:e}}var r=o(86068),a=o(97549),s=o(2194),u=o(86457),l=function(t){function e(e,o){var i=t.call(this)||this;return i._makeFields=function(t,e){return{tileSize:(null==e?void 0:e.size)||r.SF,transparent:Boolean(null==e?void 0:e.transparent),clampMapZoom:Boolean(t.clampMapZoom),zoomRange:t.zoomRange||(0,a.oF)(),fetchHotspots:null==e?void 0:e.fetchHotspots,hotspotAbortRadius:(null==e?void 0:e.hotspotAbortRadius)||r.Sv,vectorHotspots:t.vector&&t.vector.hotspots||{},awaitAllTilesOnFirstDisplay:Boolean(null==e?void 0:e.awaitAllTilesOnFirstDisplay)}},i.setSource(e),i.worldOptions=o,i}return(0,i.ZT)(e,t),Object.defineProperty(e.prototype,"rasterSourceDescription",{get:function(){return this._source.raster},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vectorSourceDescription",{get:function(){return this._source.vector},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"internalFindHostpotInPosition",{get:function(){var t;return null===(t=this._source.raster)||void 0===t?void 0:t._internalFindHotspotInPosition},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vectorHotspots",{get:function(){return this._fields.vectorHotspots},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoomRange",{get:function(){return this._fields.zoomRange},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clampMapZoom",{get:function(){return this._fields.clampMapZoom},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transparent",{get:function(){return this._fields.transparent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileSize",{get:function(){return this._fields.tileSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fetchHotspots",{get:function(){return this._fields.fetchHotspots},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hotspotAbortRadius",{get:function(){return this._fields.hotspotAbortRadius},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"awaitAllTilesOnFirstDisplay",{get:function(){return this._fields.awaitAllTilesOnFirstDisplay},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileRevealDuration",{get:function(){var t,e;return Math.max(null!==(e=null===(t=this._source.raster)||void 0===t?void 0:t.tileRevealDuration)&&void 0!==e?e:200,0)},enumerable:!1,configurable:!0}),e.prototype.getHotspotTileDataSource=function(){return this._rasterSource.fetchHotspots?{fetchHotspots:this._rasterSource.fetchHotspots,hotspotAbortRadius:this._rasterSource.hotspotAbortRadius||r.Sv,tileSize:this._rasterSource.size||r.SF,inset:void 0===this._rasterSource.hotspotInset?r.zw:this._rasterSource.hotspotInset,padding:this._rasterSource.hotspotPadding||0,zoomRange:this.zoomRange,internalFindHotspotInPosition:this.internalFindHostpotInPosition}:null},e.prototype.setSource=function(t){var e,o=this._makeFields(t,t.raster),r=(0,i.pi)((0,i.pi)({},function(t,e){for(var o={},i=0,r=Object.keys(t);i<r.length;i++){var a=r[i];o[a]=n(t[a],e[a])}return o}(this._fields||{},o)),{fetchTile:n(this._rasterSource&&this._rasterSource.tileUrl,null===(e=t.raster)||void 0===e?void 0:e.tileUrl)});this._source=t,this._fields=o,t.raster&&(this._rasterSource=t.raster,"string"==typeof this._rasterSource.tileUrl&&(this._tileUrlGenerator=c(this._rasterSource.tileUrl))),this._emit("changed"),this._emit("sourceChanged",r)},e.prototype.generateTileUrl=function(t,e,o,i){var n=this.fitTileIntoWorld(t,e,o);if(!n)return null;var r=n.x,a=n.y;return this._tileUrlGenerator(r,a,o,i)},e.prototype.fitTileIntoWorld=function(t,e,o){var i=(0,s.Su)(o,this.tileSize);return(0,s.v0)({x:t,y:e},i,this.worldOptions)?(0,s.Rf)({x:t,y:e},i):null},e}((0,u.GA)().with());function c(t){return function(e,o,i,n){return t.replace("{{x}}",String(e)).replace("{{y}}",String(o)).replace("{{z}}",String(i)).replace("{{scale}}",String(n)).replace(/\{\{d\|(\d+)\}\}/,(function(t,n){var r=(e+o+i)%Number(n)+1;return String(r)}))}}function d(t,e){return t.fetchHotspots===e.fetchHotspots&&t.hotspotAbortRadius===e.hotspotAbortRadius&&t.tileSize===e.tileSize}},2194:(t,e,o)=>{"use strict";o.d(e,{TG:()=>d,ZR:()=>p,YC:()=>h,v0:()=>f,Rf:()=>m,Su:()=>y,vD:()=>v,jl:()=>_});var i=o(41372),n=o(9902),r=o(29306),a=o(77698),s=o(88367),u=o(67444),l=o(2568),c=o(27486);function d(t,e,o,i){var n=a.divn(e,2*o),r=a.sub(t,n);a.divn(r,i,r),a.applyFunction(r,Math.floor,r);var s=a.add(t,n);return a.divn(s,i,s),a.applyFunction(s,Math.floor,s),{minX:r.x,minY:r.y,maxX:s.x,maxY:s.y}}function p(t,e,o,i,n){var r=a.divn(o,2*i);return[{x:r.x,y:r.y},{x:r.x,y:-r.y},{x:-r.x,y:-r.y},{x:-r.x,y:r.y}].map((function(t){return a.rotate(t,-e)})).map((function(e){return a.sub(t,e)})).map((function(t){return a.divn(t,n)}))}function h(t,e,o,s,u,d,p){var h={worldCenter:t,zoom:(0,n.mathLog2)(Math.pow(2,s)*u),azimuth:e,tilt:o},_=function(t,e,o,n,s){var u=e.worldCenter,d=e.tilt,p=e.azimuth,h=e.zoom,_={x:0,y:0,z:.5*-r.B.convertPixelSizeToWorldSize(o,h).y/Math.tan(.5*t)};l.lM(_,d,_),l.jI(_,p,_),l.IH(_,(0,i.pi)((0,i.pi)({},u),{z:0}),_);for(var m=Math.tan(.5*t),f=o.x/o.y,y=l.Ue(m*f,m,1),v=[l.JG(l.jQ),l.JG(l.jQ),l.JG(l.jQ),l.JG(l.jQ)],b=l.Ue(0,0,0),S={origin:_,direction:b},x=0;x<4;++x){l.PV(g[x],y,b),l.lM(b,d,b),l.jI(b,p,b),l.ek(l.XY,S,v[x])||(0,c._y)(new Error("Visible quadrilateral is unbounded, engine can't handle that case (yet)"))}return v.map((function(t){var e=r.B.worldToPixels(t,n);return a.divn(e,s)}))}(Math.PI/6,h,d,s,p),m=function(t){for(var e=1/0,o=-1/0,i=[],n=0,r=1;n<t.length;++n,r=++r%t.length){var a=[t[n],t[(n+1)%t.length]].sort((function(t,e){return t.y-e.y})),s=a[0],u=a[1],l=Math.floor(s.y),c=Math.ceil(u.y);e=Math.min(e,l),o=Math.max(o,c);var d=(u.x-s.x)/(u.y-s.y),p=s.x-(isFinite(d)?d*(s.y-l):0);i.push({firstRow:l,lastRow:c,startX:s.x,endX:u.x,x:p,k:d})}for(var h=[],_=e;_<o;_++){for(var m=1/0,f=-1/0,y=0,v=i;y<v.length;y++){var g=v[y];if(!(_<g.firstRow||_>=g.lastRow)){var b=g.x+g.k,S=g.k>=0?Math.max(g.x,g.startX):Math.min(g.x,g.startX),x=g.k>=0?Math.min(b,g.endX):Math.max(b,g.endX);m=Math.floor(Math.min(m,S,x)),f=Math.ceil(Math.max(f,S,x)),g.x=b}}for(p=m;p<f;p++)h.push({x:p,y:_})}return h}(_),f=new n.Map;return m.forEach((function(t){return f.set(v(t,s),(0,i.pi)((0,i.pi)({},t),{border:!1}))})),{tiles:f,tileBounds:_}}function _(t,e){return t.every((function(t){return(0,u.u)(e,t)}))}function m(t,e){return{x:(0,s.d)(t.x,0,e),y:(0,s.d)(t.y,0,e)}}function f(t,e,o){var i=t.x,n=t.y;return(o.cycledX||i<e&&i>=0)&&(o.cycledY||n<e&&n>=0)}function y(t,e){return Math.ceil(Math.pow(2,t+8)/e)}function v(t,e){return"".concat(t.x,".").concat(t.y,".").concat(e)}var g=[l.Ue(-1,1,-1),l.Ue(1,1,-1),l.Ue(1,-1,-1),l.Ue(-1,-1,-1)]},35357:(t,e,o)=>{"use strict";o.d(e,{N:()=>r});var i=o(41372),n=o(9902),r=function(t){function e(e){var o=t.call(this)||this;return o._tiles=new n.Map,o.setSource(e),o}return(0,i.ZT)(e,t),Object.defineProperty(e.prototype,"priority",{get:function(){return this._source.priority},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"workerUrl",{get:function(){return this._source.workerUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rootTiles",{get:function(){return this._tiles},enumerable:!1,configurable:!0}),e.prototype.setSource=function(t){this._source=t,this._emit("changed")},e.prototype.addRootTile=function(t){if(!this._tiles.has(t.id)){var e=(0,i.pi)({},t);this._tiles.set(e.id,e),this._emit("rootTileAdded",e)}},e.prototype.replaceRootTile=function(t){if(this._tiles.has(t.id)){var e=(0,i.pi)({},t);this._tiles.set(e.id,e),this._emit("rootTileReplaced",e)}},e.prototype.removeRootTile=function(t){this._tiles.delete(t)&&this._emit("rootTileRemoved",t)},e.prototype.showRootTile=function(t){this._setHidden(t,!1),this._emit("rootTileShown",t)},e.prototype.hideRootTile=function(t){this._setHidden(t,!0),this._emit("rootTileHidden",t)},e.prototype._setHidden=function(t,e){var o=this._tiles.get(t);o&&(o.isHidden=e)},e}((0,o(86457).GA)().with())},30952:(t,e,o)=>{"use strict";o.d(e,{x:()=>n});var i=o(88367);function n(){return(0,i.q)(devicePixelRatio,1,3)}},57450:(t,e,o)=>{"use strict";o.d(e,{B:()=>n});var i=o(9902);function n(t,e,o,n,r,a){void 0===n&&(n=function(){}),void 0===r&&(r=function(){}),void 0===a&&(a=function(){return!0});var s=new i.Map,u=[],l=[],c=[];function d(t,e){n(t,e),c.push(t)}return e.forEach((function(e,i){var n=t.get(i);if(n&&a(n,e)?(r(n,e),l.push(n)):n&&(d(n,i),n=void 0),!n){var c=o(e);u.push(c),n=c}s.set(i,n)})),t.forEach((function(t,o){e.has(o)||d(t,o)})),{result:s,created:u,updated:l,removed:c}}},41824:(t,e,o)=>{"use strict";o.d(e,{Os:()=>g,wm:()=>y,XA:()=>m,k6:()=>v,Rv:()=>f});var i=o(41372),n=o(77698),r=o(2568),a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function s(){return new Array(16)}function u(t,e){void 0===e&&(e=s());for(var o=0;o<16;++o)e[o]=t[o];return e}function l(t,e,o){void 0===o&&(o=s());for(var i=0;i<16;i+=4)for(var n=t[i],r=t[i+1],a=t[i+2],u=t[i+3],l=0;l<4;++l)o[i+l]=n*e[l]+r*e[4+l]+a*e[8+l]+u*e[12+l];return o}var c=u(a);function d(t,e,o,i,n){void 0===n&&(n=s());var a=r.lu(e,o);r.Fv(a,a);var u=r.kC(i,a);r.Fv(u,u);var d=r.kC(a,u);return c[0]=u.x,c[1]=d.x,c[2]=a.x,c[4]=u.y,c[5]=d.y,c[6]=a.y,c[8]=u.z,c[9]=d.z,c[10]=a.z,c[12]=-r.AK(u,e),c[13]=-r.AK(d,e),c[14]=-r.AK(a,e),l(t,c,n)}function p(t,e,o){void 0===o&&(o=r.Ue(0,0,0));var i=t[3]*e.x+t[7]*e.y+t[11]*e.z+t[15],n=(t[0]*e.x+t[4]*e.y+t[8]*e.z+t[12])/i,a=(t[1]*e.x+t[5]*e.y+t[9]*e.z+t[13])/i,s=(t[2]*e.x+t[6]*e.y+t[10]*e.z+t[14])/i;return o.x=n,o.y=a,o.z=s,o}var h=o(29306),_=o(27486);function m(t,e){var o=e.container.getBoundingClientRect();return y({x:t.x-o.left,y:t.y-o.top},e)}function f(t,e){var o=v(t,e),i=e.container.getBoundingClientRect();return n.add(o,{x:i.left,y:i.top},o),o}function y(t,e){var o=e.size,n=e.zoom,a=e.worldCenter,s=e.azimuth,u=e.tilt,l=e.fov,c=Math.tan(.5*l),d={x:0,y:0,z:g(-h.B.convertPixelSizeToWorldSize(o,n).y,l)};r.lM(d,u,d),r.jI(d,s,d),r.IH(d,(0,i.pi)((0,i.pi)({},a),{z:0}),d);var p=o.x/o.y,m=r.Ue(c*p,c,1),f={x:2*(t.x-o.x/2)/o.x,y:2*(o.y/2-t.y)/o.y,z:-1};r.PV(f,m,f),r.lM(f,u,f),r.jI(f,s,f);var y=r.ek(r.XY,{origin:d,direction:f});return y||(0,_._y)(new Error("Pointer above the horizon.")),y}function v(t,e){var o=e.size,c=e.zoom,_=e.worldCenter,m=e.azimuth,f=e.tilt,y=e.fov,v=(0,i.pi)((0,i.pi)({},t),{z:t.z||0}),b=h.B.convertPixelSizeToWorldSize(o,c),S=n.divn(b,2),x=g(-b.y,y),E={x:0,y:0,z:x};r.lM(E,f,E),r.jI(E,m,E),r.IH(E,(0,i.pi)((0,i.pi)({},_),{z:0}),E);var z=d(a,E,(0,i.pi)((0,i.pi)({},_),{z:0}),r.jI({x:0,y:1,z:0},m));if(f>0||v.z>0){var w=-S.y*Math.sin(f),T=-w-x,C=w-x,R=S.x/-S.y,A=function(t,e,o,i,n,r){void 0===r&&(r=s());for(var a=1/Math.tan(.5*e),u=a/o,l=(i+n)/(i-n),c=2*i*n/(i-n),d=0;d<16;d+=4){r[d]=t[d]*u,r[d+1]=t[d+1]*a;var p=t[d+2],h=t[d+3];r[d+2]=p*l+h*c,r[d+3]=-p}return r}(u(a),y,R,T,C);return A[0]=A[0]*o.x/2,A[5]=A[5]*(-o.y/2),A[8]=-o.x/2,A[9]=-o.y/2,p(l(z,A),v)}var P=p(z,v),M=n.add(P,S);return h.B.worldToRelativePixels(M,c)}function g(t,e){return.5*t/Math.tan(.5*e)}},2568:(t,e,o)=>{"use strict";function i(t,e,o){return{x:t,y:e,z:o}}o.d(e,{Ue:()=>i,jQ:()=>n,JG:()=>r,IH:()=>a,lu:()=>s,PV:()=>u,Fv:()=>l,AK:()=>c,kC:()=>d,lM:()=>p,jI:()=>h,XY:()=>_,ek:()=>m});var n=i(0,0,0);function r(t,e){return void 0===e&&(e=i(0,0,0)),e.x=t.x,e.y=t.y,e.z=t.z,e}function a(t,e,o){return void 0===o&&(o=i(0,0,0)),o.x=t.x+e.x,o.y=t.y+e.y,o.z=t.z+e.z,o}function s(t,e,o){return void 0===o&&(o=i(0,0,0)),o.x=t.x-e.x,o.y=t.y-e.y,o.z=t.z-e.z,o}function u(t,e,o){return void 0===o&&(o=i(0,0,0)),o.x=t.x*e.x,o.y=t.y*e.y,o.z=t.z*e.z,o}function l(t,e){return void 0===e&&(e=i(0,0,0)),function(t,e,o){return void 0===o&&(o=i(0,0,0)),o.x=t.x/e,o.y=t.y/e,o.z=t.z/e,o}(t,function(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)+Math.pow(t.z,2))}(t),e)}function c(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}function d(t,e,o){void 0===o&&(o=i(0,0,0));var n=t.y*e.z-t.z*e.y,r=t.z*e.x-t.x*e.z,a=t.x*e.y-t.y*e.x;return o.x=n,o.y=r,o.z=a,o}function p(t,e,o){void 0===o&&(o=i(0,0,0));var n=Math.cos(e),r=Math.sin(e),a=t.y;return o.x=t.x,o.y=a*n-t.z*r,o.z=a*r+t.z*n,o}function h(t,e,o){void 0===o&&(o=i(0,0,0));var n=Math.cos(e),a=Math.sin(e);return t=t===o?r(t):t,o.x=t.x*n-t.y*a,o.y=t.x*a+t.y*n,o.z=t.z,o}var _={normal:i(0,0,1),distance:0};function m(t,e,o){void 0===o&&(o=i(0,0,0));var n=c(e.direction,t.normal);if(0===n)return null;var s=(t.distance-c(t.normal,e.origin))/n;return s<0?null:(r(e.direction,o),function(t,e,o){void 0===o&&(o=i(0,0,0)),o.x=t.x*e,o.y=t.y*e,o.z=t.z*e}(o,s,o),a(o,e.origin,o),o)}},29306:(t,e,o)=>{"use strict";o.d(e,{B:()=>u});var i=o(41372),n=o(9902),r=o(88367),a=o(77698),s=256,u={getScale:function(t,e){return Math.pow(2,e-t)},getWorldPixelSize:function(t){return Math.pow(2,t)*s},worldToPixels:function(t,e){var o=Math.pow(2,e)/2*s;return a.muln({x:t.x+1,y:1-t.y},o)},worldToRelativePixels:function(t,e){var o=Math.pow(2,e)/2*s;return a.mulv(t,{x:o,y:-o})},worldToTile:function(t,e,o){var i=u.worldToPixels(t,e);return a.divn(i,o)},moveCloseToCenter:function(t,e,o){o=o||t;var i=a.sub(t,e).x;return Math.abs(i)>1?a.add(o,{x:-2*(0,n.mathSign)(i),y:0}):o},convertPixelSizeToWorldSize:function(t,e,o){var i=Math.pow(2,e)/2*s;return a.divv(t,{x:i,y:-i},o)},pixelsToWorld:function(t,e){var o=Math.pow(2,e)/2*s;return{x:t.x/o-1,y:1-t.y/o}},fitViewportToWorld:function(t,e){var o=e.zoom,i=e.worldOptions,n=e.size,r=void 0===n?a.ORIGIN:n;if(i.cycledX&&i.cycledY)return t;var s=u.convertPixelSizeToWorldSize(r,o);return{x:l(t.x,s.x,i.cycledX),y:l(t.y,-s.y,i.cycledY)}},restrictToZeroWorld:function(t,e){var o=(0,i.pi)({},t);return e.cycledX&&(o.x=(0,r.d)(o.x,-1,1)),e.cycledY&&(o.y=(0,r.d)(o.y,-1,1)),o},computePixelPerfectWorldCoordinates:function(t,e,o,i,n){void 0===i&&(i=1),void 0===n&&(n={x:0,y:0,z:t.z});var r=u.getWorldPixelSize(e)/2*i*o;return a.applyFunction(t,(function(t){return Math.round(t*r)/r}),n)}};function l(t,e,o){var i=e/2;return o?(0,r.d)(t,-1,1):(0,r.q)(t,Math.min(0,i-1),Math.max(0,1-i))}},97549:(t,e,o)=>{"use strict";o.d(e,{i3:()=>r,oF:()=>n,Hx:()=>a});var i=o(27486),n=function(){return{min:0,max:21}},r=function(t){t.min>=t.max&&(0,i._y)(new Error("Invalid zoom range, min >= max (".concat(t.min," >= ").concat(t.max,")"))),(t.min<0||t.max<0)&&(0,i._y)(new Error("Invalid zoom range, min or max is less than zero (min=".concat(t.min," max=").concat(t.max,")")))},a=function(t,e,o){return void 0===o&&(o=n()),o.min=Math.max(t.min,e.min),o.max=Math.min(t.max,e.max),o}},97293:(t,e,o)=>{"use strict";o.r(e),o.d(e,{Behaviors:()=>fe,CustomDomLayer:()=>bt.x,DblClickBehavior:()=>ce,DeviceActiveState:()=>zt,DragBehavior:()=>le,Dragger:()=>qt,EventsManager:()=>we,Magnifier:()=>pe,MarkersDataSource:()=>gt,OneFingerZoomBehavior:()=>he,PinchTiltRotateBehavior:()=>de,QualityHint:()=>v._,RotateBehavior:()=>_e,RoundScrollZoomBehavior:()=>oe,SmoothScrollZoomBehavior:()=>re,TwoFingersGestureRecognizer:()=>Qt,WheelDevice:()=>ee,YaMap:()=>We,ZoomDirection:()=>$t,assertFeatureOrCollectionIdIsString:()=>y.JO,bbox2:()=>i,computeDrawingStyle:()=>qe.oL,computeGroupStyle:()=>qe.as,computeStrokeStyle:()=>qe.Zj,createDevice:()=>Xt,createYandexHotspotFetchFunction:()=>Ke,cycleRestrict:()=>R.d,errorLoggerFactory:()=>A.YD,eventify:()=>E.GA,extractCopyrights:()=>$e.h,flattenFeatures:()=>y.$7,getDefaultZoomRange:()=>g.oF,loadHotspotsByPointerPosition:()=>Ue,loadHotspotsForViewport:()=>Qe,polyfills:()=>to,restrict:()=>R.q,screenToWorldCoordinates:()=>C.XA,transformFeatureCoordinates:()=>y.Cr,transformGeometryCoordinates:()=>y.ZE,vec2:()=>u,worldUtils:()=>z.B});var i={};o.r(i),o.d(i,{computeBBoxForPoints:()=>d,computeOverlap:()=>c,expandBBox:()=>p,isBBoxEqual:()=>_,isBBoxInBBox:()=>h,pointIsInBBox:()=>l,scaleBBox:()=>f,translateBBox:()=>m});var n=o(41372),r=o(9902),a=o(88084),s=o(80414),u=o(77698);function l(t,e){return e.minX<=t.x&&t.x<=e.maxX&&e.minY<=t.y&&t.y<=e.maxY}function c(t,e,o){void 0===o&&(o={minX:0,maxX:0,minY:0,maxY:0});var i=t.minX>e.minX?t.minX:e.minX,n=t.maxX>e.maxX?e.maxX:t.maxX;if(i>n)return null;var r=t.minY>e.minY?t.minY:e.minY,a=t.maxY>e.maxY?e.maxY:t.maxY;return r>a?null:(o.minX=i,o.maxX=n,o.minY=r,o.maxY=a,o)}function d(t,e){if(void 0===e&&(e={minX:0,maxX:0,minY:0,maxY:0}),0===t.length)return e;e.maxX=t[0].x,e.minX=t[0].x,e.maxY=t[0].y,e.minY=t[0].y;for(var o=1;o<t.length;++o){var i=t[o],n=i.x,r=i.y;n<e.minX&&(e.minX=n),n>e.maxX&&(e.maxX=n),r<e.minY&&(e.minY=r),r>e.maxY&&(e.maxY=r)}return e}function p(t,e,o){return void 0===o&&(o={minX:0,maxX:0,minY:0,maxY:0}),o.minX=t.minX-e.x,o.maxX=t.maxX+e.x,o.minY=t.minY-e.y,o.maxY=t.maxY+e.y,o}function h(t,e){return e.minX>=t.minX&&e.minY>=t.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function _(t,e){return t.minX===e.minX&&t.maxX===e.maxX&&t.minY===e.minY&&t.maxY===e.maxY}function m(t,e,o){return void 0===o&&(o={minX:0,maxX:0,minY:0,maxY:0}),o.minX=t.minX+e.x,o.maxX=t.maxX+e.x,o.minY=t.minY+e.y,o.maxY=t.maxY+e.y,o}function f(t,e,o,i){return void 0===o&&(o=function(t){return{x:t.minX+(t.maxX-t.minX)/2,y:t.minY+(t.maxY-t.minY)/2}}(t)),void 0===i&&(i={minX:0,maxX:0,minY:0,maxY:0}),i.minX=t.minX*e,i.maxX=t.maxX*e,i.minY=t.minY*e,i.maxY=t.maxY*e,m(i,u.muln(o,1-e),i),i}var y=o(85623),v=o(34009),g=o(97549),b=o(86068),S=o(10804),x=30*S.Z,E=o(86457),z=o(29306);function w(t){var e=document.createElement("ymaps");return t&&(e.className=t),e}var T=o(30952),C=o(41824),R=o(88367),A=o(27486),P=[25,25,25,25],M=function(){function t(t,e){var o,i,r,a,s,u,l,c;this._projection=e,this.options=(0,n.pi)((0,n.pi)({},t.options),{blockEvents:Boolean(null===(o=t.options)||void 0===o?void 0:o.blockEvents),blockBehaviors:Boolean(null===(i=t.options)||void 0===i?void 0:i.blockBehaviors),draggable:Boolean(null===(r=t.options)||void 0===r?void 0:r.draggable),mapFollowsOnDrag:Boolean(null===(a=t.options)||void 0===a?void 0:a.mapFollowsOnDrag),mapActiveZoneMargin:null!==(u=null===(s=t.options)||void 0===s?void 0:s.mapActiveZoneMargin)&&void 0!==u?u:P,zIndex:(null===(l=t.options)||void 0===l?void 0:l.zIndex)||0,disableRoundCoordinates:Boolean(null===(c=t.options)||void 0===c?void 0:c.disableRoundCoordinates)}),this.container=this._makeWrapper(t.element),this.element=t.element,this.cookie=t.cookie,this._state={type:"idle",coordinates:t.coordinates},this.toggleDrag(this.options.draggable)}return Object.defineProperty(t.prototype,"coordinates",{get:function(){return this._state.coordinates},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldCoordinates",{get:function(){return this._projection.toGlobalCoordinates(this._state.coordinates)},enumerable:!1,configurable:!0}),t.prototype.toggleDrag=function(t){this.options.draggable=t},t.prototype.toggleRoundCoordinates=function(t){t!==this.options.disableRoundCoordinates&&(this.options.disableRoundCoordinates=t,this.reposition(!0))},t.prototype.setCoordinates=function(t){this._state.coordinates=t,this.reposition(!0)},t.prototype.setWorldCoordinates=function(t){this.setCoordinates(this._projection.fromGlobalCoordinates(t))},t.prototype.setZIndex=function(t){this.options.zIndex=t,this.reposition(!0)},t.prototype.destroy=function(){this._layer=void 0},t.prototype.reposition=function(t){if(void 0===t&&(t=!1),this._layer){var e=function(t,e,o){var i=t.zoom,n=t.size,r=t.tilt,a=t.azimuth,s=t.fov,u=o&&0===r?z.B.computePixelPerfectWorldCoordinates(t.center,i,(0,T.x)(),1):t.center,l=t.projection.toGlobalCoordinates(e),c=o?z.B.computePixelPerfectWorldCoordinates(l,i,(0,T.x)(),1):l,d=t.worldOptions.cycledX?z.B.moveCloseToCenter(c,u):c;return d.y=(0,R.q)(d.y,-1,1),(0,C.k6)(d,{azimuth:a,tilt:r,worldCenter:u,zoom:i,size:n,fov:s})}(this._layer,this.coordinates,!this.options.disableRoundCoordinates&&t),o=e.x,i=e.y;this.container.style.transform="translate(".concat(o,"px, ").concat(i,"px)"),this.container.style.zIndex=String(this.options.zIndex)}},t.prototype.attachToLayer=function(t){this._layer&&(0,A._y)(new Error("Marker is already attached to the layer")),this._layer=t,this.reposition()},t.prototype.detachFromLayer=function(){this._layer||(0,A._y)(new Error("Marker is not attached to the layer")),this._layer=void 0},t.prototype._makeWrapper=function(t){var e=w("ymaps3x0--marker");return e.appendChild(t),e},t}();function D(t,e,o,i,n){var r=t.toGlobalCoordinates(e);return n?u.sub(r,L(n,o,i)):r}function L(t,e,o){var i=z.B.convertPixelSizeToWorldSize({x:(t[3]-t[1])/2,y:(t[0]-t[2])/2},e);return u.rotate(i,o,i),i}var I,O=o(9370);var F,k=o(33435),j=o(59027),B=o(57450),G=o(26267),Z=o(2194),W=function(t){return Math.abs(t)>=1e21?t.toPrecision(100):t.toFixed(5)};function N(t,e){return t.state=e,t}!function(t){t[t.QUEUED=0]="QUEUED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED",t[t.ANIMATING=3]="ANIMATING",t[t.READY=4]="READY",t[t.EMPTY=5]="EMPTY",t[t.REMOVED=6]="REMOVED"}(F||(F={}));var Y=function(t){function e(e,o,i,a,s,l,c,d,p,h,_,m,f){var y=t.call(this)||this;return y._currentTiles=new r.Map,y._renderedOffset={x:0,y:0},y._renderedScale=0,y._renderedAzimuth=0,y._renderedTilt=0,y._loadedTiles=new r.Set,y._haveTilesToAnimate=!1,y._tileBounds=[u.ORIGIN,u.ORIGIN,u.ORIGIN,u.ORIGIN],y.element=w("ymaps3x0--tile-layer__container"),y.state={tilesLoaded:0,tilesTotal:0,tilesReady:0,borderLoaded:0,borderReady:0,borderTotal:0,graphicsReady:0,graphicsTotal:0},y._createTile=function(t){var e=y._computeScreenCordinatesForTile(t),o=y._computeTilePriority(t),i=(0,n.pi)({state:F.QUEUED,info:t,screenX:Math.round(e.x),screenY:Math.round(e.y),animate:y._tileSource.tileRevealDuration>0&&(!y._firstScreen||y._animateFirstScreen),animationStartTs:0,image:null},y._tileLoadingQueue.enqueue((function(t){var e,o=null===(e=y._tileSource.rasterSourceDescription)||void 0===e?void 0:e.tileUrl;return"function"==typeof o?y._generateTile(o,i,t):y._loadTile(i,t)}),o));return i.promise.then((function(t){i.abortController.signal.aborted||y._onTileLoad(t)})).catch((function(t){t instanceof G._||(0,A._y)(t)})),i},y._updateTile=function(t,e){t.info=e;var o=y._computeScreenCordinatesForTile(t.info);t.state===F.QUEUED&&t.updatePriority(y._computeTilePriority(t.info)),t.screenX===o.x&&t.screenY===o.y||(t.screenX=o.x,t.screenY=o.y,t.state!==F.ANIMATING&&t.state!==F.READY||(t.element.style.left=o.x+"px",t.element.style.top=o.y+"px"))},y._removeTile=function(t){var e;t.state!==F.QUEUED&&t.state!==F.LOADING||t.abortController.abort(),t.state===F.LOADED&&y._loadedTiles.delete(t),t.state!==F.ANIMATING&&t.state!==F.READY||null===(e=t.element.parentElement)||void 0===e||e.removeChild(t.element),t.state!==F.READY&&t.state!==F.ANIMATING&&t.state!==F.LOADED||!t.ctx||(t.ctx=void 0),N(t,F.REMOVED)},y._generateTile=function(t,e,o){var i=N(e,F.LOADING),n=y._tileSource.fitTileIntoWorld(e.info.x,e.info.y,y.zoom);if(null===n){var r=N(i,F.EMPTY);return y._countReadyTile(r),Promise.resolve(r)}return t(n.x,n.y,y.zoom).then((function(t){if(o.aborted)throw new G._;var e=N(i,F.LOADED),n=document.createElement("canvas");n.width=t.width,n.height=t.height,n.style.width="".concat(y._tileSource.tileSize,"px"),n.style.height="".concat(y._tileSource.tileSize,"px"),n.style.position="absolute";var r=n.getContext("2d");if(null===r)throw new Error("Can't obtain canvas context");return r.drawImage(t,0,0),e.ctx=r,e.element=n,y._countLoadedTile(e),e})).catch((function(t){if((0,A.H)(t),o.aborted)throw new G._;var e=N(i,F.EMPTY);return y._countReadyTile(e),e}))},y._loadTile=function(t,e){var o=N(t,F.LOADING),i=y._tileSource.generateTileUrl(o.info.x,o.info.y,y.zoom,(0,T.x)());if(!i){var n=N(o,F.EMPTY);return y._countReadyTile(n),Promise.resolve(n)}var r=new j.B,a=new Image,s=function(t){if(a.onerror=null,a.onload=null,e.removeEventListener("abort",u),0===t){var i=N(o,F.LOADED);i.element=a,r.resolve(i),y._countLoadedTile(i)}else if(1===t){var n=N(o,F.EMPTY);r.resolve(n),y._countReadyTile(n)}else 2===t&&(a.src="",r.reject(new G._))},u=s.bind(null,2);e.addEventListener("abort",u);var l=s.bind(null,0),c=s.bind(null,1);return a.decode?(a.src=i,a.decode().then(l,c)):(a.onload=l,a.onerror=c,a.src=i),r.promise},y._onTileLoad=function(t){t.state===F.LOADED?(y._loadedTiles.add(t),y._emit("requestRender")):t.state===F.EMPTY&&y._countReadyTile(t)},y._shouldAwaitAllTiles=m,y._releaseAwaitAllTilesTrigger=f,y._visibleCenter=o,y._scale=i,y._azimuth=a,y._tilt=s,y._fov=l,y._size=d,y._tileSource=p,y._parent=e,y.zoom=c,y._animateFirstScreen=h,y._tileLoadingQueue=_,y.element.dataset.z=String(c),e.appendChild(y.element),y.element.addEventListener("dragstart",(function(t){t.stopPropagation(),t.preventDefault()})),y._fetchedCenter=y._visibleCenter,y._fetched=!1,y._firstScreen=!0,y}return(0,n.ZT)(e,t),Object.defineProperty(e.prototype,"needsRender",{get:function(){return 0!==this._loadedTiles.size||this._haveTilesToAnimate},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this.element.parentElement.removeChild(this.element),this._currentTiles.forEach((function(t){t.state!==F.QUEUED&&t.state!==F.LOADING||t.abortController.abort()}))},e.prototype.resize=function(t){this._fetched=!1,this._size=t,this.reposition(v._.FULL)},e.prototype.update=function(t,e,o,i,n){this._visibleCenter=z.B.computePixelPerfectWorldCoordinates(t,this.zoom,(0,T.x)(),i),this._azimuth=e,this._tilt=o,this._scale=i,this._fov=n},e.prototype.setVisibile=function(t){this.element.style.display=t?"":"none"},e.prototype.freeze=function(){var t=this;this._loadedTiles.clear(),this._currentTiles.forEach((function(e,o){e.state<=F.LOADED&&(t._currentTiles.delete(o),e.state!==F.QUEUED&&e.state!==F.LOADING||e.abortController.abort())}))},e.prototype.unfreeze=function(){this._fetched=!1},e.prototype.reposition=function(t){var e=u.sub(this._fetchedCenter,this._visibleCenter),o=this._tileSource.worldOptions.cycledX?z.B.moveCloseToCenter(this._fetchedCenter,this._visibleCenter,e):e,i=z.B.worldToRelativePixels(o,this.zoom),n=t>=v._.FULL;if(n&&u.applyFunction(i,Math.round,i),t===v._.FULL||!u.areEqual(i,this._renderedOffset)||this._renderedScale!==this._scale||this._renderedAzimuth!==this._azimuth||this._renderedTilt!==this._tilt){var r=t===v._.QUICK?u.ORIGIN:this._computeContainerSubpixelOffset((0,T.x)());this._renderedOffset=u.sub(i,r,i);var a=(0,C.Os)(this._size.y,this._fov),s=a-a/this._scale,l=s*Math.sin(this._tilt),c=s*Math.cos(this._tilt),d=[(n?this._renderedOffset.x.toString():W(this._renderedOffset.x))+"px",(n?this._renderedOffset.y.toString():W(this._renderedOffset.y))+"px","0px"].join(", ");this.element.style.transform="\n            rotateX(".concat(W(this._tilt),"rad)\n            translate3d(0px, ").concat(l,"px, ").concat(c,"px)\n            rotateZ(").concat(W(this._azimuth),"rad) translate3d(").concat(d,")\n        "),this._renderedScale=this._scale,this._renderedAzimuth=this._azimuth,this._renderedTilt=this._tilt}},e.prototype.render=function(t){var e=(0,Z.ZR)(z.B.worldToPixels(this._visibleCenter,this.zoom),this._azimuth,this._size,this._scale,this._tileSource.tileSize);this._fetched&&!(0,Z.jl)(e,this._tileBounds)||this._fetch(),this._fetch(),this.reposition(t.qualityHint),this._shouldAwaitAllTiles()&&this.state.tilesLoaded!==this.state.tilesTotal||(this._attachLoadedTiles(t.time),this._revealNewTiles(t.time))},e.prototype.finishTileAnimations=function(){var t=this;this._haveTilesToAnimate&&(this._currentTiles.forEach((function(e){e.state===F.ANIMATING&&(e.element.style.opacity="1",t._countReadyTile(N(e,F.READY)))})),this._haveTilesToAnimate=!1)},e.prototype._computeContainerSubpixelOffset=function(t){var e=this._parent.getBoundingClientRect(),o={x:e.left,y:e.top};return u.applyFunction(o,(function(e){var o=e*t;return(o-Math.round(o))/t}))},e.prototype._fetch=function(){var t=this,e=u.sub(this._fetchedCenter,this._visibleCenter).x;this._fetchedCenter=this._visibleCenter;var o=z.B.worldToPixels(this._fetchedCenter,this.zoom);this._centralTilePoint=u.add(u.divn(o,this._tileSource.tileSize),{x:-.5,y:-.5});var i=(0,Z.YC)(this._visibleCenter,this._azimuth,this._tilt,this.zoom,this._scale,this._size,this._tileSource.tileSize),n=i.tiles,a=i.tileBounds;this._tileBounds=a;var s=(0,Z.Su)(this.zoom,this._tileSource.tileSize),l=this._currentTiles,c=e>1;(c||e<-1)&&(l=new r.Map,this._currentTiles.forEach((function(e){var o=e.info,i=o.x,n=o.y,r=c?-s:s;l.set((0,Z.vD)({x:i+r,y:n},t.zoom),e)})));var d=(0,B.B)(l,n,this._createTile,this._removeTile,this._updateTile);this._currentTiles=d.result,this._updateState()&&this._emitStateChanged(),this._fetched=!0,this._firstScreen=!1},e.prototype._attachLoadedTiles=function(t){var e=this;if(0!==this._loadedTiles.size){var o=document.createDocumentFragment();this._loadedTiles.forEach((function(i){if(i.element.style.left=i.screenX+"px",i.element.style.top=i.screenY+"px",i.element.style.width="".concat(e._tileSource.tileSize,"px"),i.element.style.height="".concat(e._tileSource.tileSize,"px"),i.animate){var n=N(i,F.ANIMATING);n.element.style.opacity="0",n.animationStartTs=t}else i.element.style.opacity="1",e._countReadyTile(N(i,F.READY));o.appendChild(i.element)})),this.element.appendChild(o),this._loadedTiles.clear()}},e.prototype._revealNewTiles=function(t){var e=this;this._haveTilesToAnimate=!1,this._currentTiles.forEach((function(o){if(o.state===F.ANIMATING){var i=e._tileSource.tileRevealDuration>0?Math.min(1,(t-o.animationStartTs)/e._tileSource.tileRevealDuration):1;o.element.style.opacity=String(i),i<1?e._haveTilesToAnimate=!0:e._countReadyTile(N(o,F.READY))}})),this._haveTilesToAnimate?this._emit("requestRender"):this._releaseAwaitAllTilesTrigger()},e.prototype._countLoadedTile=function(t){t.info.border?this.state.borderLoaded++:this.state.tilesLoaded++,this._emitStateChanged()},e.prototype._countReadyTile=function(t){t.info.border?this.state.borderReady++:this.state.tilesReady++,this._emitStateChanged()},e.prototype._emitStateChanged=function(){this.state=(0,n.pi)({},this.state),this._emit("stateChanged")},e.prototype._updateState=function(){var t={borderTotal:0,borderLoaded:0,borderReady:0,tilesTotal:0,tilesReady:0,tilesLoaded:0,graphicsTotal:0,graphicsReady:0};this._currentTiles.forEach((function(e){e.info.border?t.borderTotal++:t.tilesTotal++,e.state!==F.LOADED&&e.state!==F.ANIMATING&&e.state!==F.READY||(e.info.border?t.borderLoaded++:t.tilesLoaded++),e.state===F.READY&&(e.info.border?t.borderReady++:t.tilesReady++)}));var e=t.borderTotal!==this.state.borderTotal||t.borderLoaded!==this.state.borderLoaded||t.borderReady!==this.state.borderReady||t.tilesTotal!==this.state.tilesTotal||t.tilesReady!==this.state.tilesReady||t.tilesLoaded!==this.state.tilesLoaded;return e&&(this.state=t),e},e.prototype._computeTilePriority=function(t){return(t.border?Number.MAX_SAFE_INTEGER/2:0)+(e=t,o=this._centralTilePoint,Math.pow(e.x-o.x,2)+Math.pow(e.y-o.y,2));var e,o},e.prototype._computeScreenCordinatesForTile=function(t){var e=this._tileSource.tileSize,o=z.B.worldToPixels(this._visibleCenter,this.zoom),i=u.muln(t,e),n=u.add(u.sub(i,o),u.divn(this._size,2));return u.applyFunction(n,Math.round)},e}((0,E.GA)().with()),H=o(92383),X=30*S.Z,V=function(t){function e(e,o,i,n,r,a){var s=t.call(this)||this;return s._needsRender=!0,s._awaitAllTilesTrigger=!1,s._fov=X,s._deprecatedLayers=[],s.element=w("ymaps3x0--layer ymaps3x0--tile-layer"),s._onForegroundTileReady=function(){(s._layer.state.tilesReady===s._layer.state.tilesTotal||s._tileSource.transparent&&s._layer.state.tilesLoaded>0)&&s._cleanUpDeprecatedLayers(),s._emit("stateChanged")},s._shouldAwaitAllTiles=function(){return s._awaitAllTilesTrigger},s._releaseAwaitAllTilesTrigger=function(){s._awaitAllTilesTrigger=!1,s._oldDataSourceLayer&&(s._oldDataSourceLayer.destroy(),s._oldDataSourceLayer=void 0)},s._awaitAllTilesTrigger=i.awaitAllTilesOnFirstDisplay,s._size=e,s._camera=o,s._tileSource=i,s._zoomRoundingRule=n,s._processingQueue=a,s._updatePerspective(),s._roundZoom=s._zoomRoundingRule(s._camera.zoom),s._createLayerForCurrentZoom(r),s._inZoomRange=!0,s._tileSourceSubscription=s._tileSource.group().on("sourceChanged",(function(t){return s.handleDataSourceUpdate(t)})),s}return(0,n.ZT)(e,t),Object.defineProperty(e.prototype,"center",{get:function(){return this._camera.worldCenter},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoom",{get:function(){return this._camera.zoom},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._layer.state},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._tileSourceSubscription.offAll(),this._layer.destroy(),this._cleanUpDeprecatedLayers()},e.prototype.update=function(t,e){this._needsRender=!0,(0,H.Bm)(this._camera,t)||this._releaseAwaitAllTilesTrigger(),this._camera=t,this._fov=e,this._roundZoom=this._zoomRoundingRule(this._camera.zoom),this._roundZoom!==this._layer.zoom&&this._layer.freeze()},e.prototype.handleDataSourceUpdate=function(t){this._awaitAllTilesTrigger=this._tileSource.awaitAllTilesOnFirstDisplay,(t.fetchTile||t.tileSize)&&(t.fetchTile&&this._awaitAllTilesTrigger?this._oldDataSourceLayer||(this._oldDataSourceLayer=this._layer,this._oldDataSourceLayer.freeze()):this._layer.destroy(),this._cleanUpDeprecatedLayers(),this._createLayerForCurrentZoom(!0),this._emit("requestRender"))},e.prototype.render=function(t){if(this._needsRender||this._layer.needsRender||t.qualityHint===v._.FULL){if(this._checkZoomInZoomRange())this._inZoomRange||(this._layer.unfreeze(),this._layer.setVisibile(!0),this._inZoomRange=!0);else{if(!this._inZoomRange)return;this._layer.freeze(),this._layer.setVisibile(!1),this._cleanUpDeprecatedLayers(),this._inZoomRange=!1}this._updatePerspective(),this._needsRender=!1,t.qualityHint===v._.FULL&&this._roundZoom!==this._layer.zoom&&(this._layerEventGroup.offAll(),Math.abs(this._layer.zoom-this._roundZoom)>3?this._layer.destroy():this._deprecatedLayers.push(this._layer),this._createLayerForCurrentZoom(!0));for(var e=0,o=this._deprecatedLayers;e<o.length;e++){var i=o[e];this._updateLayer(i),i.reposition(t.qualityHint),i.finishTileAnimations()}this._updateLayer(this._layer),this._roundZoom===this._layer.zoom?this._layer.render(t):this._layer.reposition(t.qualityHint),this._sortLayers()}},e.prototype._updateLayer=function(t){var e=z.B.getScale(t.zoom,this._camera.zoom);t.update(this._camera.worldCenter,this._camera.azimuth,this._camera.tilt,e,this._fov)},e.prototype.resize=function(t){this._needsRender=!0,this._size=t,this._layer.resize(t);for(var e=0,o=this._deprecatedLayers;e<o.length;e++){o[e].resize(t)}this._updatePerspective()},e.prototype.findObjectInPosition=function(){return null},e.prototype._updatePerspective=function(){this.element.style.perspective="".concat((0,C.Os)(this._size.y,this._fov),"px")},e.prototype._checkZoomInZoomRange=function(){return this._roundZoom>=this._tileSource.zoomRange.min&&this._roundZoom<=this._tileSource.zoomRange.max},e.prototype._cleanUpDeprecatedLayers=function(){for(var t=0,e=this._deprecatedLayers;t<e.length;t++){e[t].destroy()}this._deprecatedLayers=[]},e.prototype._createLayerForCurrentZoom=function(t){var e=this,o=(0,r.arrayFind)(this._deprecatedLayers,(function(t){return t.zoom===e._roundZoom}));if(o)this._deprecatedLayers.splice(this._deprecatedLayers.indexOf(o),1),o.unfreeze();else{var i=(0,R.q)(this._zoomRoundingRule(this._camera.zoom),this._tileSource.zoomRange.min,this._tileSource.zoomRange.max),n=z.B.getScale(i,this._camera.zoom);o=new Y(this.element,this._camera.worldCenter,n,this._camera.azimuth,this._camera.tilt,this._fov,i,this._size,this._tileSource,t,this._processingQueue,this._shouldAwaitAllTiles,this._releaseAwaitAllTilesTrigger)}this._layer=o,this._layerEventGroup=this._layer.on("stateChanged",this._onForegroundTileReady).on("requestRender",(function(){return e._emit("requestRender")}))},e.prototype._sortLayers=function(){for(var t=Math.round(this._camera.zoom),e=(0,n.ev)([this._layer],this._deprecatedLayers,!0),o=e.reduce((function(t,e){var o=e.zoom;return Math.max(o,t)}),-1/0),i=0,r=e;i<r.length;i++){var a=r[i];t===a.zoom?a.element.style.zIndex=String(o):t>a.zoom?a.element.style.zIndex=String(a.zoom-t):a.element.style.zIndex=String(o-a.zoom)}},e}((0,E.GA)().with()),q=o(77122),U=o(87619),Q=function(t){function e(e){var o=e.size,i=e.camera,n=e.worldOptions,r=e.projection,a=e.dataSource,s=t.call(this)||this;return s._fov=X,s._fullRenderedZoom=-1/0,s.element=w("ymaps3x0--layer ymaps3x0--marker-layer"),s._size=o,s._camera=i,s._needsRender=!0,s._dataSource=a,s.projection=r,s.worldOptions=n,s._dataSourceEventGroup=s._dataSource.group().on("markerAdded",(function(t){return s._addMarker(t)})).on("markerRemoved",(function(t){return s._removeMarker(t)})),s._dataSource.markers.forEach((function(t){return s._addMarker(t)})),s}return(0,n.ZT)(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return U.A},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){var t=this;this._dataSource.markers.forEach((function(e){return t._removeMarker(e)})),this._dataSourceEventGroup.offAll()},Object.defineProperty(e.prototype,"fov",{get:function(){return this._fov},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoom",{get:function(){return this._camera.zoom},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this._camera.worldCenter},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"azimuth",{get:function(){return this._camera.azimuth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tilt",{get:function(){return this._camera.tilt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),e.prototype.update=function(t,e){this._needsRender=!0,this._camera=t,this._fov=e},e.prototype.resize=function(t){this._needsRender=!0,this._size=t},e.prototype.render=function(t){var e=t.qualityHint;this._needsRender&&(e>=v._.FULL&&(this._fullRenderedZoom=this._camera.zoom),this._needsRender=e<v._.FULL,this._reposition(e>=v._.FULL||this._fullRenderedZoom===this._camera.zoom))},e.prototype.findObjectByElement=function(t){var e=(0,r.arrayFind)(this._dataSource.markers,(function(e){return e.container.contains(t)}));return e?{type:"marker",marker:e}:null},e.prototype.findObjectInPosition=function(t){var e=(0,C.Rv)(t,(0,n.pi)((0,n.pi)({},this._camera),{size:this._size,container:this.element,fov:this._fov}));if(!isFinite(e.x)||!isFinite(e.y))return null;var o=document.elementFromPoint(e.x,e.y);if(!this.element.contains(o))return null;for(var i=0,r=this._dataSource.markers;i<r.length;i++){var a=r[i];if(a.container.contains(o))return{type:"marker",marker:a}}return null},e.prototype._addMarker=function(t){var e=t;e.attachToLayer(this),this.element.appendChild(e.container),this._needsRender=!0},e.prototype._removeMarker=function(t){var e=t;e.detachFromLayer(),this.element.removeChild(e.container),this._needsRender=!0},e.prototype._reposition=function(t){void 0===t&&(t=!1),this.element.style.transformOrigin="".concat(this._size.x/2,"px ").concat(this._size.y/2,"px"),this._dataSource.markers.forEach((function(e){return e.reposition(t)}))},e}((0,E.GA)().with());var K="http://www.w3.org/2000/svg";function J(t,e){for(var o=Math.floor((t+1)/2),i=Math.floor((e+1)/2),n=[],r=o;r<=i;r++)n.push(r);return n}function $(t,e){if(t.length<3||e<=0)return(0,n.ev)([],t,!0);var o=[];return o.push(t[0]),tt(t,o,0,t.length-1,Math.pow(e,2)),o.push(t[t.length-1]),o}function tt(t,e,o,i,n){for(var r=t[o],a=t[i],s=a.x-r.x,u=a.y-r.y,l=Math.pow(s,2)+Math.pow(u,2),c=0,d=0,p=-1/0,h=-1,_=o+1;_<i;_++){c=t[_].x-r.x,d=t[_].y-r.y;var m=l>0?(s*c+u*d)/l:0,f=0;if(m>1)f=Math.pow(t[_].x-a.x,2)+Math.pow(t[_].y-a.y,2);else if(m>0){var y=r.x+s*m,v=r.y+u*m;f=Math.pow(t[_].x-y,2)+Math.pow(t[_].y-v,2)}else f=Math.pow(c,2)+Math.pow(d,2);f>p&&(p=f,h=_)}p>n&&(tt(t,e,o,h,n),e.push(t[h]),tt(t,e,h,i,n))}function et(t,e,o){for(var i=[],n={x:0,y:0},r={x:1/0,y:1/0},a={x:e,y:-e},s=0,l=0,c=0,d=t;c<d.length;c++){var p=d[c];s=p.x-r.x,l=p.y-r.y,(i.length<2||s>=o||s<=-o||l>=o||l<=-o)&&(u.mulv(p,a,n),i.push({x:n.x,y:n.y}),r.x=p.x,r.y=p.y)}return i}var ot=function(){function t(t,e,o){var i=this;this._strokeStamp="",this._lineSegments=[],this._simplifiedLineSegments=new r.Map,this._colorLines=new r.Map,this.worldsTranslations=[],this.geometry=(0,n.pi)({},t.geometry),this.bbox=o,J(o.minX,o.maxX).reduce((function(t,e){return t.add(e).add(-e)}),new r.Set).forEach((function(t){return i.worldsTranslations.push({x:2*t,y:0})})),this.worldsTranslations.sort((function(t,e){return t.x-e.x})),this.updateStyle(e)}return Object.defineProperty(t.prototype,"style",{get:function(){return this._style},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strokeSize",{get:function(){return this._strokeSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxStrokeWidth",{get:function(){return this._maxStrokeWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strokeStamp",{get:function(){return this._strokeStamp},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPalette",{get:function(){return this.style.paletteColorStops.length>0},enumerable:!1,configurable:!0}),t.prototype.updateStyle=function(t){this._style=t,this._strokeSize="LineString"===this.geometry.type||"MultiLineString"===this.geometry.type?this._style.stroke.length:1,this._maxStrokeWidth=-1/0,this._strokeStamp="";for(var e=0;e<this._strokeSize;e++){var o=this.style.stroke[e];o.width>this._maxStrokeWidth&&(this._maxStrokeWidth=o.width),this._strokeStamp+=o.paletteColors.length>0?"c":"p"}"LineString"===this.geometry.type&&t.paletteColorStops.length>0&&(this._lineSegments=function(t,e){for(var o=[],i=0,n=0,r=e;n<r.length;n++){var a=r[n],s=t.slice(i,a+1);o.push({coordinates:s,length:it(s)}),i=a}return o}(this.geometry.coordinates,t.paletteColorStops))},t.prototype.getStrokeStyleForStrokeIndex=function(t){return this.style.stroke.length-1<t&&(0,A._y)(new Error("Can't find stroke style for stroke with index ".concat(t))),this.style.stroke[this.style.stroke.length-1-t]},t.prototype.getSimplifiedLineSegments=function(t,e){var o=this;if(t=Math.round(t),!this._simplifiedLineSegments.has(t)){var i=z.B.getWorldPixelSize(t)/2,r=this._lineSegments.map((function(t){var r=et(t.coordinates,i,e);return(0,n.pi)((0,n.pi)({},t),{coordinates:$(r,o.style.simplificationRate)})}));this._simplifiedLineSegments.set(t,r)}return this._simplifiedLineSegments.get(t)},t.prototype.getColorLine=function(t,e,o){e=Math.round(e);var i="".concat(t,"_").concat(e);if(!this._colorLines.has(i)){var n=this.getStrokeStyleForStrokeIndex(t),r=n.paletteColors,a=n.simplifyPalette;this._colorLines.set(i,function(t,e,o,i){for(var n=[],r=t.length-1,a=1.5/z.B.getWorldPixelSize(o),s=[],u=0,l="",c=0,d={},p=0;p<t.length;p++){var h=t[p],_=h.coordinates,m=h.length;i?s.push.apply(s,_):s=_,u+=m;var f=e[p];d[f]=void 0===d[f]?m:d[f]+m,d[f]>c&&(c=d[f],l=f);var y=n[n.length-1];i&&p!==r&&(!y||l!==y.color)&&u<a||(y&&l===y.color?y.coordinates=y.coordinates.concat(s):n.push({coordinates:s,color:l}),s=[],u=0,l="",c=0,d={})}return n}(this.getSimplifiedLineSegments(e,o),r,e,a))}return this._colorLines.get(i)},t.prototype.hasStructuralDifferenceWithOtherModel=function(t){return this.geometry.type!==t.geometry.type||this._strokeStamp!==t.strokeStamp||"MultiPolygon"===this.geometry.type&&"MultiPolygon"===t.geometry.type&&this.geometry.coordinates.length!==t.geometry.coordinates.length},t}();function it(t){for(var e={x:0,y:0},o=0,i=1;i<t.length;i++)u.sub(t[i-1],t[i],e),o+=u.length(e);return o}function nt(t,e,o,i){var n=e.y-t.y,r=t.x-e.x,a=n*t.x+r*t.y,s=i.y-o.y,l=o.x-i.x,c=s*o.x+l*o.y,d=n*l-s*r;if(Math.abs(d)<1e-12)return null;var p=(l*a-r*c)/d,h=(c*n-a*s)/d;return u.create(p,h)}function rt(t,e,o){return void 0===o&&(o=!1),function(t,e,o){for(var i=t,n=[],r=e[e.length-1],a=0,s=e;a<s.length;a++){for(var u=s[a],l=i[o?i.length-1:0],c=0,d=i;c<d.length;c++){var p=d[c],h=at(r,u,l);if(at(r,u,p)){if(!h)null===(_=nt(r,u,l,p))&&(0,A._y)(new Error("Lines are collinear or parallel")),n.push(_);n.push(p)}else if(h){var _;null===(_=nt(r,u,l,p))&&(0,A._y)(new Error("Lines are collinear or parallel")),n.push(_)}l=p}i=n,n=[],r=u}return i}(t,e,o)}function at(t,e,o){return(e.x-t.x)*(o.y-t.y)>(e.y-t.y)*(o.x-t.x)}var st=o(72366);function ut(t){for(;t.firstChild;)t.removeChild(t.firstChild)}var lt=[(0,n.pi)({},u.ORIGIN)],ct=function(){function t(t,e,o){this._recreateDomStructureOnNextRender=!1,this._clippedPointElements=[],this._renderedCenter=u.ORIGIN,this._renderedZoom=-1/0,this._renderedBBoxes=[],this._isVisible=!1,this._translation={x:0,y:0};var i="ymaps3x0--feature-".concat(t,"-").concat(e);this._model=o,this.element=document.createElementNS(K,"g"),this.element.setAttribute("stroke-linejoin","round"),this.element.setAttribute("stroke-linecap","round"),this.element.setAttribute("id",i),this.elementCopy=document.createElementNS(K,"use"),this.elementCopy.setAttribute("href","#".concat(i)),this.elementCopy.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#".concat(i)),this.elementCopy.setAttribute("data-feature-id",e),this._featureId=e,this._fullWorldVisibleData={worldsTranslations:lt,bboxes:[o.bbox]},this._createDomStructure()}return Object.defineProperty(t.prototype,"model",{get:function(){return this._model},enumerable:!1,configurable:!0}),t.prototype.setModel=function(t){this._recreateDomStructureOnNextRender=this._recreateDomStructureOnNextRender||this._model.hasStructuralDifferenceWithOtherModel(t),this._model=t,this._teardownRenderedState(),this._fullWorldVisibleData={worldsTranslations:lt,bboxes:[t.bbox]}},t.prototype.render=function(t){var e=t.fullWorldVisible?this._fullWorldVisibleData:this._computeWorldsTranslationsAndBBoxes(t.svgBBox,t.viewportWorldsTranslations),o=e.worldsTranslations,i=e.bboxes;0!==o.length?(this._setVisibility(!0),this._needsFullRender(i,t.zoom)?(this._fullRender(t,o,i),this.adjustStrokeWidthAndDash(t.clippingPadding)):this._reposition(t.pixelCenter)):this._setVisibility(!1)},t.prototype.adjustStrokeWidthAndDash=function(t,e){void 0===e&&(e=1),Math.min(this.model.maxStrokeWidth/e,t)===t&&(e=this.model.maxStrokeWidth/t);for(var o=0;o<this.model.strokeSize;o++){var i=this.model.getStrokeStyleForStrokeIndex(o),n=i.dash,r=(i.width/e).toFixed(3),a=(1===e?n:n.map((function(t){return t/e}))).join(" ");if("MultiPolygon"===this.model.geometry.type||"Polygon"===this.model.geometry.type)return this.element.setAttribute("stroke-width",r),void this.element.setAttribute("stroke-dasharray",a);var s=this.element.childNodes[o];s&&(s.setAttribute("stroke-width",r),s.setAttribute("stroke-dasharray",a))}},t.prototype._computeWorldsTranslationsAndBBoxes=function(t,e){for(var o=this.model,i=o.bbox,n=o.worldsTranslations,r={},a={worldsTranslations:[],bboxes:[]},s=0,u=e.concat(n);s<u.length;s++){var l=u[s];if(r[l.x]=r[l.x]||{},!r[l.x][l.y]){r[l.x][l.y]=!0;var d=c(t,{minX:i.minX+l.x,maxX:i.maxX+l.x,minY:i.minY+l.y,maxY:i.maxY+l.y});d&&(a.worldsTranslations.push(l),a.bboxes.push(d))}}return a},t.prototype._needsFullRender=function(t,e){if(this._recreateDomStructureOnNextRender||0===this._renderedBBoxes.length||this._renderedBBoxes.length!==t.length||this._renderedZoom!==e)return!0;for(var o=0;o<this._renderedBBoxes.length;o++)if(!h(this._renderedBBoxes[o],t[o]))return!0;return!1},t.prototype._reposition=function(t){var e=u.sub(this._renderedCenter,t);this._setTranslation(e.x,e.y)},t.prototype._fullRender=function(t,e,o){var i=t.fullWorldVisible||1===o.length&&_(this._model.bbox,o[0]);switch(this._renderedCenter=t.pixelCenter,this._renderedZoom=t.zoom,this._renderedBBoxes=o,this.element.style.cursor=this.model.style.cursor,this.model.style.interactive?this.element.style.pointerEvents="":this.element.style.pointerEvents="none",this._setTranslation(0,0),this._recreateDomStructureOnNextRender&&(this._recreateDomStructureOnNextRender=!1,this._createDomStructure()),this.model.geometry.type){case"Point":this.element.setAttribute("fill","none"),this._renderPoint(this.model.geometry.coordinates,t,e);break;case"LineString":case"MultiLineString":if(this.element.setAttribute("fill","none"),this.model.hasPalette)this._renderLineWithPalette(e,t,i);else{var n="LineString"===this.model.geometry.type?[this.model.geometry.coordinates]:this.model.geometry.coordinates;this._renderLinesWithoutPalette(n,e,t,i)}break;case"Polygon":case"MultiPolygon":this.element.setAttribute("fill",this.model.style.fill),this.element.setAttribute("fill-opacity",String(this.model.style.fillOpacity)),this.element.setAttribute("fill-rule",this.model.style.fillRule);var r=this.model.geometry,a="Polygon"===r.type?[r.coordinates]:r.coordinates;this._renderPolygons(a,e,t,i);break;default:(0,A._y)(new Error("Unexpected geometry type: ".concat(this.model.geometry.type)))}},t.prototype._renderLineWithPalette=function(t,e,o){for(var i=null,n=0;n<this.model.strokeSize;n++){var r=this.element.childNodes[n],a=this.model.getStrokeStyleForStrokeIndex(n);a.paletteColors.length>0?this._renderColorLineStroke(r,n,e,o,t):(null===i&&(i=this._computeSplittedLinePath(e,o,t)),ht(r,i,a))}},t.prototype._renderLinesWithoutPalette=function(t,e,o,i){for(var n=[],r=0,a=t;r<a.length;r++){var s=et(a[r],o.halfWorldSize,o.pointFilterBox);n.push(dt(s,o,i,e,this.model.style.simplificationRate))}for(var u=n.join(" "),l=0;l<this.model.strokeSize;l++)ht(this.element.childNodes[l],u,this.model.getStrokeStyleForStrokeIndex(l))},t.prototype._renderPolygons=function(t,e,o,i){for(var n=0;n<t.length;n++){for(var r=[],a=0,s=t[n];a<s.length;a++){var u=et(s[a],o.halfWorldSize,o.pointFilterBox);r.push(dt(u,o,i,e,this.model.style.simplificationRate,!0))}ht(this.element.childNodes[n],r.join(" "),this.model.style.stroke[0])}},t.prototype._renderColorLineStroke=function(t,e,o,i,n){var r=this,a=this.model.getColorLine(e,o.zoom,o.pointFilterBox),s=this.model.getStrokeStyleForStrokeIndex(e);ut(t);var u=document.createDocumentFragment(),l=z.B.getScale(Math.round(o.zoom),o.zoom),c=null;a.forEach((function(t){var e=t.coordinates,a=t.color;if(a!==st.L){var d=dt(e,o,i,n,0,!1,l),p=pt(r._featureId);ht(p,d,s),p.setAttribute("stroke",a),u.insertBefore(p,c),c=p}})),t.appendChild(u)},t.prototype._computeSplittedLinePath=function(t,e,o){for(var i=[],n=0,r=this.model.getSimplifiedLineSegments(t.zoom,t.pointFilterBox);n<r.length;n++){var a=r[n].coordinates;i.push.apply(i,a)}return dt(i,t,e,o,0,!1,z.B.getScale(Math.round(t.zoom),t.zoom))},t.prototype._renderPoint=function(t,e,o){this._setImageElementsCount(o.length);for(var i=this.model.style.icon,n=i.scale,r=i.offset,a="scale(".concat(n,") translate(").concat(100*r[0],"%, ").concat(100*r[1],"%)"),s=0;s<o.length;s++){var l=this.element.children[s];l.getAttribute("transform")!==a&&(l.style.transform=a),l.getAttribute("href")!==this.model.style.icon.url&&l.setAttribute("href",this.model.style.icon.url);var c=u.add(t,o[s]),d=z.B.worldToRelativePixels(c,e.zoom);u.sub(d,e.pixelCenter,d),l.setAttribute("x",d.x.toString()),l.setAttribute("y",d.y.toString())}},t.prototype._setImageElementsCount=function(t){for(;this.element.children.length<t;){var e=document.createElementNS(K,"image");e.style.transformBox="fill-box",e.setAttribute("data-feature-id",this._featureId),this.element.appendChild(e)}for(;this.element.children.length>t&&this.element.lastChild;)this.element.removeChild(this.element.lastChild)},t.prototype._setPointVisibility=function(t){t?this._unclipPoint():this._clipPoint()},t.prototype._clipPoint=function(){this._clippedPointElements.length=0;for(var t=0;t<this.element.children.length;t++){var e=this.element.children[t];this._clippedPointElements.push(e),this.element.removeChild(e)}},t.prototype._unclipPoint=function(){for(var t=0,e=this._clippedPointElements;t<e.length;t++){var o=e[t];this.element.appendChild(o)}this._clippedPointElements.length=0},t.prototype._createDomStructure=function(){if(ut(this.element),"Point"!==this.model.geometry.type)if("MultiPolygon"!==this.model.geometry.type)for(e=0;e<this.model.strokeSize;e++){var t=this.model.getStrokeStyleForStrokeIndex(e).paletteColors.length>0&&"LineString"===this.model.geometry.type?document.createElementNS(K,"g"):pt(this._featureId);this.element.appendChild(t)}else for(var e=0;e<this.model.geometry.coordinates.length;e++){var o=pt(this._featureId);this.element.appendChild(o)}},t.prototype._setVisibility=function(t){this._isVisible!==t&&(this.element.style.display=t?"":"none","Point"===this._model.geometry.type&&this._setPointVisibility(t),this._isVisible=t)},t.prototype._setTranslation=function(t,e){this._translation.x===t&&this._translation.y===e||(this.element.setAttribute("transform","translate(".concat(t," ").concat(e,")")),this._translation={x:t,y:e})},t.prototype._teardownRenderedState=function(){this._renderedZoom=-1/0,this._renderedBBoxes=[],this._renderedCenter=u.ORIGIN},t}();function dt(t,e,o,i,n,r,a){void 0===n&&(n=0),void 0===r&&(r=!1),void 0===a&&(a=1);for(var s=[],l={x:0,y:0},c=function(i){var c=z.B.worldToRelativePixels(i,e.zoom),d=t;if(!o){var p=u.sub(e.pixelCenter,c),h=e.clippingWindow.map((function(t){var e=u.add(t,p);return 1===a?e:u.divn(e,a,e)}));d=rt(t,h,r)}if(d.length>0){var _=0===n?d:$(d,n),m=u.sub(c,e.pixelCenter),f="M"+_.map((function(t){return 1!==a&&(t=u.muln(t,a,l)),u.add(t,m,l),"".concat(l.x,",").concat(l.y)})).join(" L");r&&(f+=" Z"),s.push(f)}},d=0,p=i;d<p.length;d++){c(p[d])}return s.join(" ")}function pt(t){var e=document.createElementNS(K,"path");return e.setAttribute("data-feature-id",t),e}function ht(t,e,o){t.setAttribute("d",e);var i=o.opacity,n=o.color;t.setAttribute("stroke-opacity",String(i)),t.setAttribute("stroke",n)}var _t=o(12949),mt={x:50,y:50},ft=18*S.Z,yt=0,vt=function(t){function e(e,o,i,n){var a=t.call(this)||this;a._svg=document.createElementNS(K,"svg"),a._zeroWorld=document.createElementNS(K,"g"),a._groups=new r.Map,a._features=new r.Map,a._nodesToRemove=new r.Set,a._renderedWorldCopies=new r.Set,a._multiWorldsSource=document.createDocumentFragment(),a._layerId=String(yt++),a._elementChildrenKey=(0,r.Symbol)("childrenSet"),a._shouldRender=!0,a._fullWorldRendered=!1,a._lastTimeStrokeAdjusted=0,a._willChangeFlag=!1,a._fov=X,a._isSvgFixedAtAzimuth=!1,a.element=w("ymaps3x0--layer ymaps3x0--graphics-layer"),a._camera=o,a.resize(e),a._worldOptions=i,a._dataSource=n,a._renderedZoom=o.zoom,a._zoomOfAdjustedStoke=o.zoom,a._renderedCenter=o.worldCenter;var s=document.createElementNS(K,"g");return a._multiWorldsSource.appendChild(s),a._groups.set(_t.o,{id:_t.o,element:a._zeroWorld,elementCopy:s}),a._svg.appendChild(a._zeroWorld),a._svg.setAttributeNS("xmlns","xlink","http://www.w3.org/1999/xlink"),a._svg.ondragstart=function(){return!1},a.element.appendChild(a._svg),a._dataSourcesSubscriptions=n.group().on("groupAdded",(function(t){return a._addGroup(t)})).on("groupRemoved",(function(t){return a._removeGroup(t)})).on("featureAdded",(function(t){return a._addFeatureById(t)})).on("featureRemoved",(function(t){return a._removeFeatureById(t)})).on("featureUpdated",(function(t){return a._updateFeatureById(t)})).on("featureMovedToGroup",(function(){return a._shouldRender=!0})),a._dataSource.groups.forEach((function(t){var e=t.id;e!==_t.o&&a._addGroup(e)})),a._dataSource.features.forEach((function(t){var e=t.id;return a._addFeatureById(e)})),a}return(0,n.ZT)(e,t),e.prototype.destroy=function(){this._features.clear(),this._dataSourcesSubscriptions.offAll(),this._shouldRender=!0},Object.defineProperty(e.prototype,"state",{get:function(){return U.A},enumerable:!1,configurable:!0}),e.prototype.resize=function(t){this._size=t,this._halfSize=u.divn(this._size,2),this._setSvgSizeValues(),this._shouldRender=!0,this._updatePerspective()},e.prototype.update=function(t,e){this._camera=t,this._fov=e},e.prototype.render=function(t){var e=t.qualityHint;if(this._cleanupNodesToRemove(),this._updatePerspective(),0!==this._features.size){this.element.style.setProperty("display",null);var o=this._getVisibleWorlds(),i=z.B.getScale(this._renderedZoom,this._camera.zoom);e===v._.QUICK?(this._setWillChange(!0),this._positionZeroWorld(i)):this._needsFullRender(e)?(this._fullRender(o),this._renderWorldCopies(this._camera.zoom,!0)):(this._adjustStrokeWidthAndDash(i),this._positionZeroWorld(i),this._renderWorldCopies(this._renderedZoom))}else this.element.style.display="none"},e.prototype.findObjectInPosition=function(t){var e=(0,C.Rv)(t,(0,n.pi)((0,n.pi)({},this._camera),{size:this._size,container:this.element,fov:this._fov}));if(!isFinite(e.x)||!isFinite(e.y))return null;var o=document.elementFromPoint(e.x,e.y);if(!o)return null;var i=o.getAttribute("data-feature-id");return null!==i&&this._dataSource.hasFeatureWithId(i)&&this.element.contains(o)?{type:"feature",featureId:i}:null},e.prototype._addGroup=function(t){var e=document.createElementNS(K,"g");this._groups.set(t,{id:t,element:e,elementCopy:e.cloneNode()}),this._shouldRender=!0},e.prototype._removeGroup=function(t){var e=t.id,o=t.removed;this._nodesToRemove.add(this._groups.get(e));for(var i=0,n=o;i<n.length;i++){var r=n[i];"feature"===r.type?this._removeFeatureById(r.id):this._groups.delete(r.id)}this._shouldRender=!0},e.prototype._addFeatureById=function(t){var e=this._dataSource.features.get(t),o=e.feature,i=e.style,n=e.bbox,r=new ot(o,i,n),a=new ct(this._layerId,o.id,r),s={id:o.id,element:a.element,elementCopy:a.elementCopy,renderer:a};this._features.set(o.id,s),this._shouldRender=!0},e.prototype._removeFeatureById=function(t){this._nodesToRemove.add(this._features.get(t)),this._features.delete(t),this._shouldRender=!0},e.prototype._updateFeatureById=function(t){var e=this._features.get(t),o=this._dataSource.features.get(t),i=o.feature,n=o.style,r=o.bbox;e.renderer.setModel(new ot(i,n,r)),this._shouldRender=!0},e.prototype._needsFullRender=function(t){if(t===v._.QUICK)return!1;var e=this._computeHalfSvgWorldSize(),o={minX:this._renderedCenter.x-e.x,maxX:this._renderedCenter.x+e.x,minY:this._renderedCenter.y-e.y,maxY:this._renderedCenter.y+e.y},i=this._computeHalfViewportSize(),n=!h(o,{minX:this._camera.worldCenter.x-i.x,maxX:this._camera.worldCenter.x+i.x,minY:this._camera.worldCenter.y-i.y,maxY:this._camera.worldCenter.y+i.y}),r=Math.abs(this._renderedZoom-this._camera.zoom);return n||r>=2||t===v._.FULL&&(this._shouldRender||this._camera.zoom!==this._renderedZoom)},e.prototype._fullRender=function(t){var e=this;this._setSvgSizeValues(),this._setSvgAttributes();var o=this._getRenderVariables(t);this._setWillChange(!1),this._shouldRender=!1,this._renderedZoom=this._camera.zoom,this._renderedCenter=this._camera.worldCenter,this._fullWorldRendered=o.fullWorldVisible,this._zoomOfAdjustedStoke=this._camera.zoom,this._lastTimeStrokeAdjusted=performance.now(),this._positionZeroWorld(),this._dataSource.groups.forEach((function(t){var i=e._groups.get(t.id),n=i.element,r=i.elementCopy;n.setAttribute("opacity",String(t.style.opacity)),r.setAttribute("opacity",String(t.style.opacity)),e._renderChildren(t.children,n,r,o)}))},e.prototype._updatePerspective=function(){var t=(0,C.Os)(this._size.y,this._fov);this._perspective!==t&&(this._perspective=t,this.element.style.perspective="".concat(t,"px"))},e.prototype._renderChildren=function(t,e,o,i){for(var n,r,a=null,s=null,u=0,l=(r=function(t,e){return e.style.zIndex-t.style.zIndex},(n=t).map((function(t,e){return e})).sort((function(t,e){var o=n[t],i=n[e],a=r(o,i);return 0!==a?a:t-e})).map((function(t){return n[t]})));u<l.length;u++){var c=l[u],d=void 0,p=void 0;switch(c.type){case"group":var h=this._groups.get(c.id);d=h.element,p=h.elementCopy;break;case"feature":var _=this._features.get(c.id);_.renderer.render(i),d=_.element,p=_.elementCopy}this._insertElementBefore(e,d,a),this._insertElementBefore(o,p,s),a=d,s=p}},e.prototype._getCachedChildren=function(t){var e,o;return(e=t)[o=this._elementChildrenKey]||(e[o]=new r.Set)},e.prototype._insertElementBefore=function(t,e,o){var i=this._getCachedChildren(t);i.has(e)||(t.insertBefore(e,o),i.add(e))},e.prototype._removeElement=function(t){var e=t.parentNode;e&&(e.removeChild(t),this._getCachedChildren(e).delete(t))},e.prototype._adjustStrokeWidthAndDash=function(t){var e=performance.now(),o=e-this._lastTimeStrokeAdjusted;Math.abs(this._zoomOfAdjustedStoke-this._camera.zoom)>=.5&&o>250?(this._setWillChange(!1),this._zoomOfAdjustedStoke=this._camera.zoom,this._lastTimeStrokeAdjusted=e,this._features.forEach((function(e){e.renderer.adjustStrokeWidthAndDash(50,t)}))):this._setWillChange(!0)},e.prototype._cleanupNodesToRemove=function(){var t=this;0!==this._nodesToRemove.size&&(this._nodesToRemove.forEach((function(e){t._removeElement(e.element),t._removeElement(e.elementCopy)})),this._nodesToRemove.clear())},e.prototype._getSvgPixelBBox=function(){var t=z.B.worldToPixels(this._camera.worldCenter,this._camera.zoom);return{minX:t.x-this._halfSvgSize.x,maxX:t.x+this._halfSvgSize.x,minY:t.y-this._halfSvgSize.y,maxY:t.y+this._halfSvgSize.y}},e.prototype._getClippingWindow=function(t){var e=p(t,mt),o=e.minX,i=e.maxX,n=e.minY,r=e.maxY,a=z.B.worldToPixels(this._camera.worldCenter,this._camera.zoom),s=u.sub({x:o,y:n},a);return[u.sub({x:o,y:r},a),s,u.sub({x:i,y:n},a),u.sub({x:i,y:r},a)]},e.prototype._positionZeroWorld=function(t){void 0===t&&(t=1);var e=this._worldOptions.cycledX?z.B.moveCloseToCenter(this._renderedCenter,this._camera.worldCenter):this._renderedCenter,o=this._camera,i=o.zoom,n=o.azimuth,r=o.tilt,a=z.B.worldToRelativePixels(e,i),s=z.B.worldToRelativePixels(this._camera.worldCenter,i),l=u.sub(a,s),c=u.sub(this._halfSize,this._halfSvgSize),d="translate3d(".concat(l.x,"px, ").concat(l.y,"px, 0px)"),p="translate3d(".concat(c.x,"px, ").concat(c.y,"px, 0px)"),h=["".concat(p),"rotateX(".concat(r,"rad)"),"rotateZ(".concat(n,"rad)"),"".concat(d),"scale(".concat(t,")")];this._svg.style.setProperty("transform",h.join(" "))},e.prototype._clearWorldCopies=function(){for(var t=this._svg.querySelectorAll("g[data-world-copy]"),e=0;e<t.length;e++)this._svg.removeChild(t[e]);this._renderedWorldCopies.clear()},e.prototype._renderWorldCopies=function(t,e){void 0===e&&(e=!1),this._worldOptions.cycledX&&(e&&this._clearWorldCopies(),this._fullWorldRendered&&this._makeMissingWorldCopies(t))},e.prototype._makeMissingWorldCopies=function(t){for(var e=z.B.getWorldPixelSize(t),o=0,i=(0,n.ev)([-1,1],this._getVisibleWorlds(),!0);o<i.length;o++){var r=i[o];if(0!==r&&!this._renderedWorldCopies.has(r)){var a=document.createElementNS(K,"g");a.setAttribute("data-world-copy",String(r));var s=this._halfSvgSize.x+e*r;a.setAttribute("transform","translate(".concat(s,", ").concat(this._halfSvgSize.y,")")),a.appendChild(this._multiWorldsSource.cloneNode(!0)),this._svg.appendChild(a),this._renderedWorldCopies.add(r)}}},e.prototype._getVisibleWorlds=function(){var t=this._computeHalfViewportSize().x+.11111111111111112,e=this._camera.worldCenter;return J(e.x-t,e.x+t)},e.prototype._getRenderVariables=function(t){var e,o,i,n,r,a,s,u,l=z.B.getWorldPixelSize(this._camera.zoom),c=this._getSvgPixelBBox(),d=(e=c,o=this._camera.zoom,i=e.minX,n=e.maxX,r=e.minY,a=e.maxY,s=z.B.pixelsToWorld({x:i,y:a},o),u=z.B.pixelsToWorld({x:n,y:r},o),{minX:s.x,maxX:u.x,minY:s.y,maxY:u.y}),p=d.minX<=-1&&d.maxX>=1;return{pixelCenter:z.B.worldToRelativePixels(this._camera.worldCenter,this._camera.zoom),zoom:this._camera.zoom,worldSize:l,halfWorldSize:l/2,clippingWindow:this._getClippingWindow(c),clippingPadding:50,pointFilterBox:1/l,fullWorldVisible:p,viewportWorldsTranslations:t.map((function(t){return{x:2*t,y:0}})),svgBBox:d}},e.prototype._setWillChange=function(t){this._willChangeFlag!==t&&(this._willChangeFlag=t,this._svg.style.setProperty("will-change",t?"transform":""))},e.prototype._computeHalfViewportSize=function(){var t=z.B.convertPixelSizeToWorldSize(this._halfSize,this._camera.zoom);return u.applyFunction(t,Math.abs,t),t},e.prototype._computeHalfSvgWorldSize=function(){var t=z.B.convertPixelSizeToWorldSize(this._halfSvgSize,this._renderedZoom);if(u.applyFunction(t,Math.abs,t),this._camera.tilt){var e=Math.cos(H.oU),o={x:this._camera.azimuth?e:1,y:e};u.mulv(t,o,t)}if(this._camera.azimuth){var i=(0,R.d)(-ft,0,2*Math.PI)<this._camera.azimuth||this._camera.azimuth<ft,n=this._isSvgFixedAtAzimuth||i?.65:.45;u.muln(t,n,t)}return t},e.prototype._setSvgSizeValues=function(){var t=u.muln(this._size,2);if(this._camera.tilt){var e={x:1,y:1/Math.cos(H.oU)};u.mulv(t,e,t)}if(this._camera.azimuth){var o=u.length(t);t={x:o,y:o},this._isSvgFixedAtAzimuth=!0}else this._isSvgFixedAtAzimuth=!1;this._svgSize=t,this._halfSvgSize=u.divn(t,2)},e.prototype._setSvgAttributes=function(){this._svg.setAttribute("width",String(this._svgSize.x)),this._svg.setAttribute("height",String(this._svgSize.y)),this._svg.setAttribute("viewBox","0 0 ".concat(this._svgSize.x," ").concat(this._svgSize.y)),this._zeroWorld.setAttribute("transform","translate(".concat(this._halfSvgSize.x,", ").concat(this._halfSvgSize.y,")"))},e}((0,E.GA)().with());var gt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._markers=[],e.markers=e._markers,e}return(0,n.ZT)(e,t),e.prototype.addMarker=function(t){this._markers.push(t),this._emit("markerAdded",t),this._emit("changed")},e.prototype.removeMarker=function(t){var e=(0,r.arrayFindIndex)(this._markers,(function(e){return e===t}));-1!==e&&(this._markers.splice(e,1),this._emit("markerRemoved",t),this._emit("changed"))},e}((0,E.GA)().with()),bt=o(39670),St=o(35357),xt=new r.WeakMap,Et=function(t){function e(e,o,i,a,s,u,l,c){var d=t.call(this)||this;return d._layerImplementationsById=new r.Map,d._dataSourceSubscriptions=[],d._dataSources={},d._processingQueue=new j.$(20),d.element=w(),d._createLayerImplementation=function(t){if("customDomLayer"===t.type){t.options.raster.implementation||(0,A._y)(new Error("Implementation not provided"));var e=new(0,t.options.raster.implementation)({camera:d._camera,size:d._size,projection:d._projection,layerDescription:t});e instanceof bt.x||(0,A._y)(new Error("Implementation must be derived from CustomDomLayer"));var o=e.group().on("requestRender",d._requestRenderLoopUpdate);return(0,n.pi)((0,n.pi)({},t),{layer:e,eventGroup:o})}var i=d._dataSources[t.source];if(i instanceof _t.I)return d._createGraphicsLayerImplementation(t,i);if(i instanceof gt)return d._createMarkersLayerImplementation(t,i);if(i instanceof St.N)throw new Error("Tile3dDataSource is not supported by raster engine");return d._createTileLayerImplementation(t,i)},d._destroyLayerImplementation=function(t){d._removeLayerElementFromDom(t.layer),t.layer.destroy(),t.eventGroup.offAll(),d._resetTileHotspotsLayer(t,null),t.tileSourceEventGroup&&t.tileSourceEventGroup.offAll()},d._requestRenderLoopUpdate=function(){return d.renderLoop.update()},d._emitHotspotsChanged=function(){return d._emit("hotspotsChanged")},d._onLayerStateChange=function(){var t=!0,e=!1,o=!0,i=!1;d._layerImplementationsById.forEach((function(n){var r=n.layer,a=xt.get(r),s=a.loaded;a.loaded=r.state.tilesLoaded===r.state.tilesTotal,t=t&&a.loaded,!s&&a.loaded&&(e=!0);var u=a.ready;a.ready=r.state.tilesReady===r.state.tilesTotal,o=o&&a.ready,!u&&a.ready&&(i=!0)})),d._emit("stateChanged"),t&&e&&d._emit("tilesLoaded"),o&&i&&d._emit("tilesReady")},d._size=e,d._camera=o,d._worldOptions=a,d._projection=s,d.renderLoop=i,d._zoomRoundingRule=l,d.animateFirstScreen=c,d._layers=[],d._renderLoopSubscriptions=d.renderLoop.on("render",d._render.bind(d)),d.setDataSources(u),d}return(0,n.ZT)(e,t),e.prototype.setDataSources=function(t){this._destroyDataSourceSubscriptions(),this._dataSources=(0,n.pi)({},t);for(var e=0,o=Object.keys(this._dataSources);e<o.length;e++){var i=o[e];this._dataSourceSubscriptions.push(this._dataSources[i].on("changed",this._requestRenderLoopUpdate))}},e.prototype.setLayers=function(t){var e=[];this._layerImplementationsById.forEach((function(t,o){return e.push(o)}));for(var o=new r.Map,i=0,n=t;i<n.length;i++){var a=n[i],s=this._dataSources[a.source];(s instanceof k.Nt&&s.rasterSourceDescription&&"ground"===a.type||s instanceof _t.I||s instanceof gt||"customDomLayer"===a.type)&&o.set(a.id,a)}var u=(0,B.B)(this._layerImplementationsById,o,this._createLayerImplementation,this._destroyLayerImplementation,(function(){}),(function(t,e){return t.source===e.source&&t.type===e.type}));this._layerImplementationsById=u.result,this._flattenLayers(),this._layerImplementationsById.forEach((function(t){var e=t.layer;xt.has(e)||xt.set(e,{ready:e.state.tilesReady===e.state.tilesTotal,loaded:e.state.tilesLoaded===e.state.tilesTotal})})),this._applyLayersOptions(),this._addLayerElementsToDom(),0===u.created.length&&0===u.removed.length&&function(t,e){if(t.length!==e.length)return!1;for(var o=0;o<t.length;o++)if(t[o]!==e[o])return!1;return!0}(e,t.map((function(t){return t.id})))||(this._emit("stateChanged"),this.renderLoop.update())},e.prototype.getIndoorPlans=function(){return null},e.prototype.getVisibleObjects=function(){return null},e.prototype.getTile3dState=function(){return null},e.prototype.getLayerReadyState=function(t){var e=this._layerImplementationsById.get(t);return e?e.layer.state:void 0},e.prototype.destroy=function(){this.setLayers([]),this._destroyDataSourceSubscriptions(),this._renderLoopSubscriptions.offAll(),this._removeLayerElementsFromDom()},e.prototype.update=function(t,e){this._camera=t,this._layers.forEach((function(o){return o.layer.update(t,e)}))},e.prototype.resize=function(t){this._size=t,this._layers.forEach((function(e){return e.layer.resize(t)}))},e.prototype.findObjectInPosition=function(t){for(var e=this._layers.length-1;e>=0;e--){var o=this._layers[e],i=o.layer,r=o.implementation,a=r.id,s=r.source,u=i.findObjectInPosition(t);if(u)return(0,n.pi)({layer:a,source:s},u)}return null},e.prototype.findObjectInPositionEx=function(t){for(var e={layers:[]},o=this._layers.length-1;o>=0;o--){var i=this._layers[o],r=i.layer,a=i.implementation,s=a.id,u=a.source,l=r.findObjectInPosition(t);if(e.layers.push({layer:s,object:l&&(0,n.pi)({layer:s,source:u},l)}),l)break}return e},e.prototype.findMarkerByElement=function(t){for(var e=this._layers.length-1;e>=0;e--){var o=this._layers[e],i=o.layer,r=o.implementation,a=r.id,s=r.source;if(i instanceof Q){var u=i.findObjectByElement(t);if(u)return(0,n.pi)((0,n.pi)({},u),{layer:a,source:s})}}return null},e.prototype._flattenLayers=function(){var t=this;this._layers=[],this._layerImplementationsById.forEach((function(e){t._layers.push({layer:e.layer,implementation:e}),e.hotspots&&t._layers.push({layer:e.hotspots.layer,implementation:e})}))},e.prototype._createGraphicsLayerImplementation=function(t,e){var o=new vt(this._size,this._camera,this._worldOptions,e),i=o.group().on("requestRender",this._requestRenderLoopUpdate);return(0,n.pi)((0,n.pi)({},t),{layer:o,eventGroup:i})},e.prototype._createMarkersLayerImplementation=function(t,e){var o=new Q({size:this._size,camera:this._camera,worldOptions:this._worldOptions,projection:this._projection,dataSource:e}),i=o.group().on("requestRender",this._requestRenderLoopUpdate);return(0,n.pi)((0,n.pi)({},t),{layer:o,eventGroup:i})},e.prototype.preloadHotspotsInPoint=function(t){this._layerImplementationsById.forEach((function(e){var o=e.hotspots;o&&o.layer.preloadHotspotsInPoint(t)}))},e.prototype.preloadHotspotsForViewport=function(){this._layerImplementationsById.forEach((function(t){var e=t.hotspots;e&&e.layer.preloadHotspotsForViewport()}))},e.prototype.setObjectFilters=function(t){},e.prototype.setInvisibleCollidingPrimitives=function(t){},e.prototype.setObjectHighlight=function(t){},e.prototype._createTileLayerImplementation=function(t,e){var o=this,i=new V(this._size,this._camera,e,this._zoomRoundingRule,this.animateFirstScreen,this._processingQueue),r=i.group().on("stateChanged",this._onLayerStateChange).on("requestRender",this._requestRenderLoopUpdate),a=e.group(),s=(0,n.pi)((0,n.pi)({},t),{layer:i,eventGroup:r,tileSourceEventGroup:a});return a.on("sourceChanged",(function(){o._resetTileHotspotsLayer(s,e.getHotspotTileDataSource())})),this._resetTileHotspotsLayer(s,e.getHotspotTileDataSource()),s},e.prototype._resetTileHotspotsLayer=function(t,e){if(!(!e&&!t.hotspots||e&&t.hotspots&&(0,k.PP)(t.hotspots.source,e))){if(t.hotspots&&(t.hotspots.eventGroup.offAll(),t.hotspots.layer.destroy(),t.hotspots=void 0),e){var o=new q.K(this._size,this._camera,e,this._processingQueue,this._worldOptions,this._zoomRoundingRule),i=o.on("hotspotsChanged",this._emitHotspotsChanged).on("requestRender",this._requestRenderLoopUpdate);t.hotspots={layer:o,eventGroup:i,source:e}}this._flattenLayers()}},e.prototype._render=function(t){this._processingQueue.pause(),this._layers.forEach((function(e){return e.layer.render(t)})),this._processingQueue.resume()},e.prototype._removeLayerElementFromDom=function(t){t.element&&t.element.parentElement&&t.element.parentElement.removeChild(t.element)},e.prototype._removeLayerElementsFromDom=function(){for(var t=0,e=this._layers;t<e.length;t++){var o=e[t].layer;this._removeLayerElementFromDom(o)}},e.prototype._addLayerElementsToDom=function(){for(var t=new r.Map,e=0,o=this._layers;e<o.length;e++){var i=o[e].layer;if(i.element){var n=this.element,a=t.get(n)||0,s=n.childNodes[a];i.element!==s&&n.insertBefore(i.element,s||null),t.set(n,a+1)}}},e.prototype._applyLayersOptions=function(){for(var t,e=0,o=this._layers;e<o.length;e++){var i=o[e],n=i.layer,r=i.implementation;if(n.element){var a=(0,R.q)(null!==(t=r.options.raster.opacity)&&void 0!==t?t:1,0,1);n.element.style.opacity=String(a)}}},e.prototype._destroyDataSourceSubscriptions=function(){for(var t=0,e=this._dataSourceSubscriptions;t<e.length;t++){e[t].offAll()}this._dataSourceSubscriptions=[]},Object.defineProperty(e.prototype,"fov",{get:function(){return X},enumerable:!1,configurable:!0}),e}((0,E.GA)().with());var zt,wt=o(38961),Tt=(0,wt.u)("ease");function Ct(t,e,o){return t(e)-t(e-o)}function Rt(t,e,o,i,n){void 0===n&&(n=Tt);var r=i?z.B.worldToRelativePixels(u.sub(i,t.worldCenter),t.zoom):null,a=Mt(n,e-t.zoom,r);return t.animateForDuration(o,a)}function At(t,e,o,i){if(void 0===i&&(i=Tt),u.areFuzzyEqual(e,u.ORIGIN,1e-10))return{complete:Promise.resolve(),isRunning:!1,stop:function(){}};var r=(0,wt.u)(i);return t.animateForDuration(o,(function(t,o,i){var a=u.muln(e,Ct(r,o,i)),s=u.add(t.worldCenter,a);return(0,n.pi)((0,n.pi)({},t),{worldCenter:s})}))}function Pt(t,e,o,i,r){return void 0===r&&(r=Tt),Math.abs(o-t.zoom)<1e-10?At(t,u.sub(e,t.worldCenter),i,r):function(t,e,o,i,r){void 0===r&&(r=Tt);var a=t.worldCenter,s={x:0,y:0},u={x:!1,y:!1},l=Mt(r,o-t.zoom,s);return t.animateForDuration(i,(function(i,r,c){if(1===r)return(0,n.pi)((0,n.pi)({},i),{worldCenter:e,zoom:o});var d=z.B.convertPixelSizeToWorldSize(t.size,i.zoom),p=!t.worldOptions.cycledX&&d.x>2,h=!t.worldOptions.cycledY&&Math.abs(d.y)>2;if(!u.x&&!p){var _=Dt(e,o,a,i.zoom).x;s.x=_,u.x=!0}if(!u.y&&!h){var m=Dt(e,o,a,i.zoom).y;s.y=m,u.y=!0}return l(i,r,c)}))}(t,e,o,i,r)}function Mt(t,e,o){var i=(0,wt.u)(t);return function(t,r,a){var s=t.zoom+e*Ct(i,r,a);if(!o)return(0,n.pi)((0,n.pi)({},t),{zoom:s});var l=u.sub(z.B.convertPixelSizeToWorldSize(o,t.zoom),z.B.convertPixelSizeToWorldSize(o,s)),c=u.add(t.worldCenter,l);return(0,n.pi)((0,n.pi)({},t),{worldCenter:c,zoom:s})}}function Dt(t,e,o,i){var n=e-i,a=u.sub(t,o),s=u.muln(a,(0,r.mathSign)(n)/(Math.pow(2,Math.abs(n))-1)),l=n>0?t:o,c=u.add(l,s);return z.B.worldToRelativePixels(u.sub(c,o),i)}function Lt(t,e,o){var i=e.zoom,n=e.azimuth,r=z.B.getScale(i,o),a=u.muln(t,r-1);return u.rotate(z.B.convertPixelSizeToWorldSize(a,o,a),n)}function It(){return/mac os/i.test(navigator.userAgent)}function Ot(){return/firefox/i.test(navigator.userAgent)}function Ft(){var t=/ipad|iphone/i.test(navigator.userAgent),e=Ot()&&/windows/i.test(navigator.userAgent);return!t&&!e&&"PointerEvent"in window}!function(t){t[t.INACTIVE=-1]="INACTIVE",t[t.PRIMARY=0]="PRIMARY",t[t.SECONDARY=2]="SECONDARY",t[t.CTRL_PRIMARY=8]="CTRL_PRIMARY",t[t.CMD_PRIMARY=16]="CMD_PRIMARY"}(zt||(zt={}));var kt=function(t){function e(o,i,n){var r=t.call(this)||this;return r._suppressNextClickStartTs=0,r.destroyed=!1,r.state=zt.INACTIVE,r._spots=[],r._onElementPointerDown=function(){if(void 0===e._owner)e._owner=r;else if(e._owner!==r)return;r.element.removeEventListener(r._eventMap.start,r._onElementPointerDown),document.addEventListener(r._eventMap.start,r._onDocumentPointerDown),document.addEventListener(r._eventMap.end,r._onPointerUp)},r._onDocumentPointerDown=function(t){if(e._owner===r){var o=0===r._spots.length;r.state=o?r._getEventState(t):r.state,r._handleAdd(t),r._emit("spotsAdded"),o&&r._emit("stateChanged")}},r._onPointerMove=function(t){e._owner===r&&(r._handleChange(t),r._spots.length>0&&r._emit("spotsChanged"))},r._onPointerUp=function(t){e._owner===r&&(r._handleRemove(t),0===r._spots.length?(document.removeEventListener(r._eventMap.start,r._onDocumentPointerDown),document.removeEventListener(r._eventMap.end,r._onPointerUp),r.element.addEventListener(r._eventMap.start,r._onElementPointerDown),e._owner=void 0,r._emit("spotsRemoved"),r.state=zt.INACTIVE,r._emit("stateChanged")):r._emit("spotsRemoved"))},r._onClick=function(t){var e=Date.now();r._suppressNextClickStartTs+500>e&&(r._suppressNextClickStartTs=0,t.stopPropagation(),t.preventDefault())},r._onDragStart=function(t){t.stopPropagation(),t.preventDefault()},r.element=o,r._eventMap=i,r.options=n,r.element.style.touchAction="none",r.element.addEventListener(r._eventMap.start,r._onElementPointerDown),r.element.addEventListener("click",r._onClick,!0),r.element.addEventListener("dragstart",r._onDragStart),document.addEventListener(r._eventMap.move,r._onPointerMove),r}return(0,n.ZT)(e,t),Object.defineProperty(e.prototype,"spots",{get:function(){return this._spots},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointerPosition",{get:function(){return this._spots.length>0?u.avg(this._spots):this._getPointerPositionWithoutSpots()},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this.destroyed||(this.element.removeEventListener(this._eventMap.start,this._onElementPointerDown),document.removeEventListener(this._eventMap.start,this._onDocumentPointerDown),document.removeEventListener(this._eventMap.move,this._onPointerMove),document.removeEventListener(this._eventMap.end,this._onPointerUp),this.element.removeEventListener("dragstart",this._onDragStart),this.element.removeEventListener("click",this._onClick,!0),this.element.style.touchAction="auto",this.destroyed=!0,e._owner===this&&(e._owner=void 0))},e.prototype.suppressNextClick=function(){this._suppressNextClickStartTs=Date.now()},e.prototype.suppressSelection=function(){},e.prototype._getEventState=function(t){return t instanceof MouseEvent?t.ctrlKey&&0===t.button?zt.CTRL_PRIMARY:t.metaKey&&0===t.button&&It()?zt.CMD_PRIMARY:t.button:zt.PRIMARY},e}((0,E.GA)().with()),jt={start:"pointerdown",move:"pointermove",end:"pointerup"};function Bt(t){var e=[];return t.forEach((function(t){e.push(t)})),e}var Gt=function(t){function e(e,o){var i=t.call(this,e,jt,o)||this;return i._spotMap=new r.Map,i._pointerPosition={x:0,y:0},i._suppressSelection=!1,i._onWheel=function(t){("boolean"!=typeof t.isTrusted||t.isTrusted)&&(i._pointerPosition={x:t.clientX,y:t.clientY})},document.addEventListener("wheel",i._onWheel,!0),document.addEventListener("pointercancel",(function(){i._spotMap.clear(),i.state=zt.INACTIVE,i._emit("stateChanged")})),i}return(0,n.ZT)(e,t),e.prototype.suppressSelection=function(){this._suppressSelection=!0},e.prototype.destroy=function(){document.removeEventListener("wheel",this._onWheel,!0),t.prototype.destroy.call(this)},e.prototype._handleAdd=function(t){var e,o=this;if(!(null===(e=this.options)||void 0===e?void 0:e.filter(t))){this._spotMap.set(t.pointerId,{x:t.clientX,y:t.clientY}),this._spots=Bt(this._spotMap),this._pointerPosition={x:t.clientX,y:t.clientY};var i=t.target;if(i){var n=function(t){i.removeEventListener("pointerup",n),o._handleRemove(t)};i.addEventListener("pointerup",n)}}},e.prototype._handleChange=function(t){var e;(null===(e=this.options)||void 0===e?void 0:e.filter(t))||(this._suppressSelection&&1===this._spots.length&&t.preventDefault(),this._pointerPosition={x:t.clientX,y:t.clientY},this._spots.length>0&&this._spotMap.has(t.pointerId)&&(this._spotMap.set(t.pointerId,this._pointerPosition),this._spots=Bt(this._spotMap)))},e.prototype._handleRemove=function(t){var e;(null===(e=this.options)||void 0===e?void 0:e.filter(t))||(this._spotMap.delete(t.pointerId),this._spots=Bt(this._spotMap),this._suppressSelection=!1)},e.prototype._getPointerPositionWithoutSpots=function(){return this._pointerPosition},e}(kt),Zt={start:"touchstart",move:"touchmove",end:"touchend"},Wt=function(t){function e(o,i){var n=t.call(this,o,Zt,i)||this;return n._mouseCoords={x:0,y:0},n._holdingMouseButton=!1,n._onMouseDown=function(t){if(void 0===e._mouseOwner)e._mouseOwner=n;else if(e._mouseOwner!==n)return;n._mouseCoords={x:t.clientX,y:t.clientY};var o=n.state===zt.INACTIVE;n.state=o?n._getEventState(t):n.state,n._holdingMouseButton=!0,document.addEventListener("mouseup",n._onMouseUp),n._emit("spotsAdded"),o&&n._emit("stateChanged")},n._onMouseMove=function(t){n._mouseCoords={x:t.clientX,y:t.clientY},e._mouseOwner===n&&n._holdingMouseButton&&n._emit("spotsChanged")},n._onMouseUp=function(){e._mouseOwner===n&&(e._mouseOwner=void 0,n._holdingMouseButton=!1,document.removeEventListener("mouseup",n._onMouseUp),n._emit("spotsRemoved"),n.state=zt.INACTIVE,n._emit("stateChanged"))},n._onWheel=function(t){("boolean"!=typeof t.isTrusted||t.isTrusted)&&(n._mouseCoords={x:t.clientX,y:t.clientY})},n.element.addEventListener("mousedown",n._onMouseDown),document.addEventListener("mousemove",n._onMouseMove),n.element.addEventListener("wheel",n._onWheel),/ipad|iphone/i.test(navigator.userAgent)&&n.element.addEventListener("touchmove",(function(t){return t.preventDefault()})),n}return(0,n.ZT)(e,t),Object.defineProperty(e.prototype,"spots",{get:function(){return 0!==this._spots.length?this._spots:this._holdingMouseButton?[this._mouseCoords]:[]},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this.destroyed||(this.element.removeEventListener("mousedown",this._onMouseDown),document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),this.element.removeEventListener("wheel",this._onWheel),t.prototype.destroy.call(this))},e.prototype._handleAdd=function(t){var e;(null===(e=this.options)||void 0===e?void 0:e.filter(t))||(this._spots=Nt(t.touches))},e.prototype._handleChange=function(t){var e;if(!(null===(e=this.options)||void 0===e?void 0:e.filter(t))){var o=this._spots.length;this._spots=Nt(t.touches),this._spots.length<o?this._emit("spotsRemoved"):this._spots.length>o&&this._emit("spotsAdded")}},e.prototype._handleRemove=function(t){var e;(null===(e=this.options)||void 0===e?void 0:e.filter(t))||(this._spots=Nt(t.touches))},e.prototype._getPointerPositionWithoutSpots=function(){return this._mouseCoords},e}(kt);function Nt(t){for(var e=new Array,o=0;o<t.length;o++)e[o]={x:t[o].clientX,y:t[o].clientY};return e}var Yt,Ht=new r.WeakMap;function Xt(t,e){var o=Ht.get(t);return o&&!o.destroyed||(o=Ft()?new Gt(t,e):new Wt(t,e),Ht.set(t,o)),o}!function(t){t[t.IDLE=0]="IDLE",t[t.DRAGGING_BEYOND_THRESHOLD=1]="DRAGGING_BEYOND_THRESHOLD",t[t.DRAGGING=2]="DRAGGING"}(Yt||(Yt={}));var Vt={tremorPixels:3,listenToButtons:new r.Set([zt.PRIMARY]),minSpotsCount:1},qt=function(t){function e(e,o){void 0===o&&(o={});var i=t.call(this)||this;return i._state=Yt.IDLE,i._startingPoint={x:0,y:0},i._dragOffset={x:0,y:0},i._pointerPosition={x:0,y:0},i._onSpotAdded=function(){if(!(i._device.spots.length<i._options.minSpotsCount)){var t=i._device.state;if(i._state<Yt.DRAGGING_BEYOND_THRESHOLD&&i._options.listenToButtons.has(t)){var e=i._device.pointerPosition;i._state=Yt.DRAGGING_BEYOND_THRESHOLD,i._startingPoint.x=e.x,i._startingPoint.y=e.y,i._dragOffset={x:0,y:0},i._pointerPosition=i._device.pointerPosition}else i._skip(i._device.pointerPosition)}},i._onSpotsChanged=function(){if(!(i._state<Yt.DRAGGING_BEYOND_THRESHOLD)){var t=i._device.pointerPosition,e=i._dragOffset;i._dragOffset=u.sub(t,i._startingPoint),i._pointerPosition=i._device.pointerPosition,i._state<=Yt.DRAGGING_BEYOND_THRESHOLD&&Math.max(Math.abs(i._dragOffset.x),Math.abs(i._dragOffset.y))>i._options.tremorPixels?(i._emit("dragStart"),i._state=Yt.DRAGGING,i._device.suppressSelection()):i._state!==Yt.DRAGGING||u.areEqual(e,i._dragOffset)||i._emit("dragMove")}},i._onSpotsRemoved=function(){i._device.spots.length<i._options.minSpotsCount?(i._emit("dragEnd"),i._state===Yt.DRAGGING&&i._device.suppressNextClick(),i._state=Yt.IDLE,i._dragOffset={x:0,y:0},i._pointerPosition={x:0,y:0}):i._skip(i._device.pointerPosition)},i._device=e,i._options=(0,n.pi)((0,n.pi)({},Vt),o),i._deviceSubscription=i._device.on("spotsAdded",i._onSpotAdded).on("spotsChanged",i._onSpotsChanged).on("spotsRemoved",i._onSpotsRemoved),i}return(0,n.ZT)(e,t),e.prototype.destroy=function(){this._deviceSubscription.offAll()},Object.defineProperty(e.prototype,"dragStartingPoint",{get:function(){return this._startingPoint},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointerPosition",{get:function(){return this._pointerPosition},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dragOffset",{get:function(){return this._state===Yt.DRAGGING?this._dragOffset:{x:0,y:0}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDragging",{get:function(){return this._state!==Yt.IDLE},enumerable:!1,configurable:!0}),e.prototype._skip=function(t){if(this._state<Yt.DRAGGING)return this._startingPoint=t,void(this._pointerPosition=t);this._emit("dragEnd"),this._startingPoint=t,this._pointerPosition=t,this._emit("dragStart")},e}((0,E.GA)().with()),Ut=12*S.Z,Qt=function(t){function e(e){var o=t.call(this)||this;return o._scale=1,o._state=0,o._angle=0,o._angleDelta=0,o._panTiltDelta=0,o._initialTouchDistance=1,o._initialTouchesY=[0,0],o._initialDirection={x:0,y:0},o._device=e,o._deviceSubscription=o._device.on("spotsAdded",(function(){2===o._device.spots.length&&(o._state=1,o._initialTouchDistance=Kt(o._device.spots),o._initialTouchesY=[o._device.spots[0].y,o._device.spots[1].y],o._initialDirection=Jt(o._device.spots),o._updateState())})).on("spotsChanged",(function(){if(!(o._device.spots.length<=1)&&(o._updateState(),1===o._state)){var t=Math.abs(Kt(o._device.spots)-o._initialTouchDistance),e=Math.abs(o._angle)>Ut,i=t>=15,n=o._device.spots[0].y-o._initialTouchesY[0],a=o._device.spots[1].y-o._initialTouchesY[1],s=!e&&(0,r.mathSign)(n)===(0,r.mathSign)(a)&&Math.abs(n)>=5&&Math.abs(a)>=5&&t<10;(e||i||s)&&(o._state=2,o._initialTouchDistance=Kt(o._device.spots),o._initialDirection=Jt(o._device.spots),o._updateState(),o._emit(i||e?"pinchRotateStart":"panTiltStart"))}})).on("spotsRemoved",(function(){o._device.spots.length<=1?(2===o._state&&o._emit("gestureEnd"),o._scale=1,o._angle=0,o._angleDelta=0,o._panTiltDelta=0,o._initialDirection={x:0,y:0},o._initialTouchDistance=0,o._initialTouchesY=[0,0]):o._updateState()})),o}return(0,n.ZT)(e,t),e.prototype.destroy=function(){this._deviceSubscription.offAll()},Object.defineProperty(e.prototype,"scale",{get:function(){return 2===this._state?this._scale:1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return 2===this._state?this._getCorrectedAngle():0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"panTiltDelta",{get:function(){return 2===this._state?this._panTiltDelta:0},enumerable:!1,configurable:!0}),e.prototype._updateState=function(){var t,e,o=this._device.spots,i=Kt(o);this._scale=i?i/this._initialTouchDistance:1,this._angle=(t=Jt(o),e=this._initialDirection,Math.atan2(t.y,t.x)-Math.atan2(e.y,e.x)),this._panTiltDelta=this._initialTouchesY[0]-o[0].y},e.prototype._getCorrectedAngle=function(){var t=Math.abs(this._angle)>Ut;return!this._angleDelta&&t&&(this._angleDelta=-(0,r.mathSign)(this._angle)*Ut),this._angleDelta?this._angle+this._angleDelta:0},e}((0,E.GA)().with());function Kt(t){if(t.length<2)return 0;var e=u.sub(t[0],t[1]);return u.length(e)}function Jt(t){return u.sub(t[0],t[1])}var $t;!function(t){t[t.SCROLL_DOWN=-1]="SCROLL_DOWN",t[t.SCROLL_UP=1]="SCROLL_UP"}($t||($t={}));var te,ee=function(t){function e(e,o){var i=t.call(this)||this;return i._disabled=!1,i._onWheel=function(t){var e;if(!i._disabled&&("boolean"!=typeof t.isTrusted||t.isTrusted)&&!(null===(e=i.options)||void 0===e?void 0:e.filter(t))){t.preventDefault(),t.stopPropagation();var o=t.deltaMode===WheelEvent.DOM_DELTA_PIXEL?1:40;(function(){var t,e=null===(t=navigator.userAgent)||void 0===t?void 0:t.match(/firefox\/(\d+)/i);return!!e&&Number(e[1])>=90})()&&t.deltaMode===WheelEvent.DOM_DELTA_LINE&&(o=1);var n=(void 0!==t.wheelDeltaY?t.wheelDeltaY:-t.deltaY)*o*(t.shiftKey?.25:1);t.ctrlKey&&It()&&Ot()&&(n*=6),i._emit("wheel",n)}},i._element=e,i._element.addEventListener("wheel",i._onWheel,{passive:!1}),i.options=o,i}return(0,n.ZT)(e,t),e.prototype.destroy=function(){this._element.removeEventListener("wheel",this._onWheel)},e.prototype.disable=function(){this._disabled=!0},e.prototype.enable=function(){this._disabled=!1},e}((0,E.GA)().with());!function(t){t[t.ZOOM_TO_CENTER=0]="ZOOM_TO_CENTER",t[t.ZOOM_TO_POINTER=1]="ZOOM_TO_POINTER"}(te||(te={}));var oe=function(t){function e(e,o,i,a){var l=t.call(this)||this;return l._deltaAccumulator=0,l._zoomPointCenterOffset=u.ORIGIN,l._onWheel=function(t){var e=Date.now();l._deltaAccumulator=t;var o=l.zoomDuration;if(l._updateWheelTrend(t)&&!(l._state&&e-l._state.startTs<o)){l._zoomPointCenterOffset=u.sub(l._zoomPointSource(),u.divn(l._map.size,2));var i=(0,r.mathSign)(l._deltaAccumulator);l._deltaAccumulator=0;var n=l._computeNewState(l._state,e,i);if(n){var a=!l._state;l._state=n,a&&l._emit("zoomStart")}l._state&&!l.isInAction&&(l._animation=l._map.animate(l._animationStep),(0,s.promiseFinally)(l._animation.complete,(function(){return l._emit("zoomEnd")})))}},l._animationStep=function(t){var e=ie(l._state,Date.now()),o=e.zoom;if(e.dt>=l._state.duration+50&&(l._animation.stop(),l._animation=void 0,l._state=void 0,l._currentWheelTrend=void 0),o===t.zoom)return t;var i=Lt(l._zoomPointCenterOffset,t,o),r=u.add(t.worldCenter,i);return(0,n.pi)((0,n.pi)({},t),{worldCenter:r,zoom:o})},l._map=e,l._device=o,l._zoomPointSource=i,l.zoomDuration=a,l._init(),l}return(0,n.ZT)(e,t),Object.defineProperty(e.prototype,"isInAction",{get:function(){return void 0!==this._animation&&this._animation.isRunning},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._suspend()},e.prototype.enable=function(){this._init()},e.prototype.disable=function(){this._suspend()},e.prototype._init=function(){this._deviceSubscription||(this._deviceSubscription=this._device.on("wheel",this._onWheel))},e.prototype._suspend=function(){this._animation&&this._animation.isRunning&&this._animation.stop(),this._deviceSubscription&&(this._deviceSubscription.offAll(),this._deviceSubscription=void 0)},e.prototype._computeNewState=function(t,e,o){var i=t?ie(t,e).zoom:this._map.zoom,n=i+o;if(t&&(n=(0,R.q)(n,t.startZoom-4,t.startZoom+4)),n=(0,R.q)(n,this._map.zoomRange.min,this._map.zoomRange.max),n=Math.round(n),(n=Number(n.toFixed(2)))!==i)return{startZoom:i,targetZoom:n,startTs:e,duration:this.zoomDuration}},e.prototype._updateWheelTrend=function(t){var e=this._currentWheelTrend,o=(0,r.mathSign)(t);return!(Math.abs(o)<1e-10)&&(this._currentWheelTrend=o,!e||o===e)},e}((0,E.GA)().with());function ie(t,e){var o=e-t.startTs,i=(0,R.q)(o/t.duration,0,1);return{zoom:t.startZoom+(t.targetZoom-t.startZoom)*i,dt:o}}var ne=.03,re=function(t){function e(e,o,i){var a=t.call(this)||this;return a._wheelAccumulator=0,a._zoomPointCenterOffset=u.ORIGIN,a._deltaZoom=0,a._prevFrameTimestamp=0,a._onWheel=function(t){a._wheelAccumulator+=t,a._zoomPointCenterOffset=u.sub(a._zoomPointSource(),u.divn(a._map.size,2)),a._animation||(a._prevFrameTimestamp=Date.now(),a._animation=a._map.animate(a._animationStep),(0,s.promiseFinally)(a._animation.complete,(function(){clearTimeout(a._zoomEndTimer),a._zoomEndTimer=setTimeout((function(){a._emit("zoomEnd"),a._zoomEndTimer=void 0}))})),clearTimeout(a._zoomEndTimer),a._zoomEndTimer=void 0,a._emit("zoomStart"))},a._animationStep=function(t){var e,o,i,s,l;a._wheelAccumulator&&((0,r.mathSign)(a._wheelAccumulator)!==(0,r.mathSign)(a._deltaZoom)&&(a._deltaZoom=0),a._deltaZoom+=(e=a._wheelAccumulator,o=a._deltaZoom,i=(0,r.mathSign)(e),s=Math.min(1,1/Math.abs(5.5*Math.abs(o)-1)),l=(0,R.q)(Math.abs(e)*s/600,.005,2),i*l),a._wheelAccumulator=0);var c,d=Date.now();if(d-a._prevFrameTimestamp>400||Math.abs(a._deltaZoom)<=.03){var p=t.zoom,h=(0,R.q)(p+a._deltaZoom,a._map.zoomRange.min,a._map.zoomRange.max);a._deltaZoom=0,a._animation.stop(),a._animation=void 0;var _=Lt(a._zoomPointCenterOffset,t,h),m=u.add(t.worldCenter,_);return(0,n.pi)((0,n.pi)({},t),{worldCenter:m,zoom:h})}c=Math.abs(a._deltaZoom)>.12?.25*a._deltaZoom:(0,r.mathSign)(a._deltaZoom)*ne,a._deltaZoom-=c;var f=(0,R.q)(t.zoom+c,a._map.zoomRange.min,a._map.zoomRange.max),y=Lt(a._zoomPointCenterOffset,t,f),v=u.add(t.worldCenter,y);return a._prevFrameTimestamp=d,(0,n.pi)((0,n.pi)({},t),{worldCenter:v,zoom:f})},a._map=e,a._device=o,a._zoomPointSource=i,a._init(),a}return(0,n.ZT)(e,t),Object.defineProperty(e.prototype,"isInAction",{get:function(){return void 0!==this._animation&&this._animation.isRunning},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._suspend()},e.prototype.enable=function(){this._init()},e.prototype.disable=function(){this._suspend()},e.prototype._init=function(){this._deviceSubscription||(this._deviceSubscription=this._device.on("wheel",this._onWheel))},e.prototype._suspend=function(){this._animation&&this._animation.isRunning&&this._animation.stop(),this._deviceSubscription&&(this._deviceSubscription.offAll(),this._deviceSubscription=void 0)},e}((0,E.GA)().with());var ae=Math.cos(Math.PI/6),se=(0,wt.u)("ease-out"),ue=function(){function t(){this._history=[]}return t.prototype.push=function(t){this._history.push({position:t,ts:Date.now()}),this._history.length>=30&&this._history.shift()},t.prototype.computeMovement=function(){var t=Date.now(),e=this._history.filter((function(e){return e.ts>=t-500}));if(e.length<2||t-e[e.length-1].ts>=100)return null;var o=u.sub(e[e.length-2].position,e[e.length-1].position);if(u.areFuzzyEqual(o,u.ORIGIN,2))return null;u.normalize(o,o);for(var i=0,n=e.length-1;n>=1;n--){var a=u.sub(e[n-1].position,e[n].position),s=u.length(a);if(u.dot(a,o)/s<=ae)break;var l=(t-e[n].ts)/500;i+=s/(0,r.mathLog2)(2+l)}return u.muln(o,Math.min(i,500))},t}(),le=function(t){function e(e,o){var i=t.call(this)||this;return i._map=e,i._dragger=o,i._dragSubscription=i._initDrag(),i}return(0,n.ZT)(e,t),e.prototype.destroy=function(){this._stopAnimationIfAny(),this._stopAllSubscriptions()},e.prototype.enable=function(){this._dragSubscription||(this._dragSubscription=this._initDrag())},e.prototype.disable=function(){this._stopAnimationIfAny(),this._stopAllSubscriptions(),this._dragger.isDragging&&this._emit("dragEnd")},Object.defineProperty(e.prototype,"isInAction",{get:function(){return void 0!==this._dragAnimation&&this._dragAnimation.isRunning},enumerable:!1,configurable:!0}),e.prototype._stopAllSubscriptions=function(){this._dragEndSubscription&&(this._dragEndSubscription.offAll(),this._dragEndSubscription=void 0),this._dragSubscription&&(this._dragSubscription.offAll(),this._dragSubscription=void 0)},e.prototype._initDrag=function(){var t=this,e=this._dragger.group();return e.on("dragStart",(function(){if(!t._map.dragger.isDragging){t._emit("dragStart"),t._stopAnimationIfAny();var o=(0,C.XA)(t._dragger.dragStartingPoint,t._map),i=new ue;i.push(t._dragger.pointerPosition),e.on("dragMove",(function(){return i.push(t._dragger.pointerPosition)})),t._dragAnimation=t._map.animate((function(e){return(0,n.pi)((0,n.pi)({},e),{worldCenter:t._computeWorldCenter(o)})})),t._dragEndSubscription=t._dragger.on("dragEnd",(function(){t._dragEndSubscription.offAll();var e={worldCenter:t._computeWorldCenter(o),zoom:t._map.zoom,azimuth:t._map.azimuth,tilt:t._map.tilt};t._map.setCamera(e),t._stopAnimationIfAny();var n=i.computeMovement();if(n){var r=z.B.convertPixelSizeToWorldSize(n,t._map.zoom),a=u.rotate(r,e.azimuth),l=u.add(t._map.worldCenter,a);t._emit("inertiaStart",{targetPositionWcs:l}),t._dragAnimation=At(t._map,a,400,se),(0,s.promiseFinally)(t._dragAnimation.complete,(function(){return t._emit("dragEnd")}))}else t._emit("dragEnd")}))}})),e},e.prototype._stopAnimationIfAny=function(){this._dragAnimation&&this._dragAnimation.isRunning&&this._dragAnimation.stop()},e.prototype._computeWorldCenter=function(t){var e=(0,C.XA)(this._dragger.pointerPosition,this._map),o=u.sub(e,t);return u.sub(this._map.worldCenter,o)},e}((0,E.GA)().with()),ce=function(t){function e(e,o,i){var n=t.call(this)||this;return n._isEnabled=!1,n._onDblClick=function(){n._zoomOn(1)},n._onRightDblClick=function(){n._zoomOn(-1)},n._map=e,n._zoomDuration=o,n._zoomPointSrc=i,n._init(),n}return(0,n.ZT)(e,t),Object.defineProperty(e.prototype,"isInAction",{get:function(){return void 0!==this._animation&&this._animation.isRunning},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._suspend()},e.prototype.enable=function(){this._init()},e.prototype.disable=function(){this._suspend()},e.prototype._init=function(){this._isEnabled||(this._map.events.on("dblclick","any",this._onDblClick),this._map.events.on("rightdblclick","any",this._onRightDblClick),this._isEnabled=!0)},e.prototype._suspend=function(){this._isEnabled&&(this._map.events.off("dblclick","any",this._onDblClick),this._map.events.off("rightdblclick","any",this._onRightDblClick)),this._animation&&this._animation.isRunning&&this._animation.stop(),this._isEnabled=!1},e.prototype._zoomOn=function(t){var e=this;this._emit("zoomStart");var o=(0,C.wm)(this._zoomPointSrc(),this._map);this._animation=Rt(this._map,this._map.zoom+t,this._zoomDuration,o),(0,s.promiseFinally)(this._animation.complete,(function(){return e._emit("zoomEnd")}))},e}((0,E.GA)().with()),de=function(t){function e(e,o,i){var a=t.call(this)||this;return a.rotationAllowed=!1,a.tiltAllowed=!1,a._onTiltStart=function(){if(!a.tiltAllowed)return a._onPinchRotateStart();a._stopAnimationIfAny(),a._emit("tiltStart"),a._map.updateCameraOptions({enabledTiltTransition:!0});var t=a._map.tilt,e=a._map.animate((function(e){var o=t+Math.PI*a._gestureRecognizer.panTiltDelta/a._map.size.y;return a._emit("tiltChanged"),(0,n.pi)((0,n.pi)({},e),{tilt:o})})),o=a._gestureRecognizer.on("gestureEnd",(function(){o.offAll(),e.stop();var t=function(){a._emit("tiltEnd"),a._map.updateCameraOptions({enabledTiltTransition:!1})},i=a._map.tilt<H.eQ;if(i||a._map.tilt>H.oU){var r=i?H.eQ:H.oU;a._stopTiltAnimationIfAny(),a._tiltAnimation=function(t,e,o,i){void 0===i&&(i=Tt);var r=e-t.tilt,a=(0,wt.u)(i);return t.animateForDuration(o,(function(t,o,i){if(1===o)return(0,n.pi)((0,n.pi)({},t),{tilt:e});var s=t.tilt+r*Ct(a,o,i);return(0,n.pi)((0,n.pi)({},t),{tilt:s})}))}(a._map,r,a._tiltDuration),(0,s.promiseFinally)(a._tiltAnimation.complete,t)}else t()}))},a._onPinchRotateStart=function(){a._stopAnimationIfAny(),a._emit("zoomStart");var t=a._map.zoom,e=a._map.azimuth,o=a._map.animate((function(o){var i,s=t+(0,r.mathLog2)(a._gestureRecognizer.scale);i=a.rotationAllowed?e+a._gestureRecognizer.angle:o.azimuth;var l=o.worldCenter;if(a._getZoomStrategy()===te.ZOOM_TO_CENTER){var c=Lt(u.sub(a._getZoomPointSrc(),u.divn(a._map.size,2)),o,s);l=u.add(o.worldCenter,c)}return a._emit("zoomChanged"),(0,n.pi)((0,n.pi)({},o),{worldCenter:l,azimuth:i,zoom:s})})),i=a._gestureRecognizer.on("gestureEnd",(function(){i.offAll(),o.stop();var t=Math.round(a._map.zoom),r=[];if(a.rotationAllowed&&Math.abs(a._gestureRecognizer.angle)<a._rotateThreshold&&(a._stopRotateAnimationIfAny(),a._rotateAnimation=function(t,e,o,i,r){void 0===r&&(r=Tt);var a=(0,wt.u)(r);return t.animateForDuration(i,(function(t,i,r){if(1===i)return(0,n.pi)((0,n.pi)({},t),{azimuth:o});var s=t.azimuth+e*Ct(a,i,r);return(0,n.pi)((0,n.pi)({},t),{azimuth:s})}))}(a._map,-a._gestureRecognizer.angle,e,a._rotateDuration),r.push(a._rotateAnimation.complete)),a.snapToRound&&t!==a._map.zoom){a._stopZoomAnimationIfAny();var u=void 0;if(a._getZoomStrategy()===te.ZOOM_TO_CENTER){var l=a._map.center,c=l[0],d=l[1];u=a._map.projection.toGlobalCoordinates([c,d])}a._zoomAnimation=Rt(a._map,t,a._zoomDuration,u),r.push(a._zoomAnimation.complete)}r.length?(0,s.promiseFinally)(Promise.all(r),(function(){return a._emit("zoomEnd")})).catch((function(t){return(0,A.H)(t)})):a._emit("zoomEnd")}))},a._map=e,a.snapToRound=i.snapToRound,a._zoomDuration=i.zoomDuration,a._rotateDuration=i.rotateDuration,a._rotateThreshold=i.rotateThreshold,a._tiltDuration=i.tiltDuration,a._getZoomPointSrc=i.getZoomPointSrc,a._getZoomStrategy=i.getZoomStrategy,a._gestureRecognizer=o,a._init(),a}return(0,n.ZT)(e,t),e.prototype.destroy=function(){this._suspend()},Object.defineProperty(e.prototype,"isInAction",{get:function(){var t,e,o;return Boolean((null===(t=this._zoomAnimation)||void 0===t?void 0:t.isRunning)||(null===(e=this._rotateAnimation)||void 0===e?void 0:e.isRunning)||(null===(o=this._tiltAnimation)||void 0===o?void 0:o.isRunning))},enumerable:!1,configurable:!0}),e.prototype.enable=function(){this._init()},e.prototype.disable=function(){this._suspend()},e.prototype._init=function(){this._deviceSubscription||(this._deviceSubscription=this._gestureRecognizer.on("pinchRotateStart",this._onPinchRotateStart).on("panTiltStart",this._onTiltStart))},e.prototype._suspend=function(){this._deviceSubscription&&(this._deviceSubscription.offAll(),this._deviceSubscription=void 0),this._stopAnimationIfAny()},e.prototype._stopAnimationIfAny=function(){this._stopZoomAnimationIfAny(),this._stopRotateAnimationIfAny(),this._stopTiltAnimationIfAny()},e.prototype._stopZoomAnimationIfAny=function(){var t;(null===(t=this._zoomAnimation)||void 0===t?void 0:t.isRunning)&&(this._zoomAnimation.stop(),this._zoomAnimation=void 0)},e.prototype._stopRotateAnimationIfAny=function(){var t;(null===(t=this._rotateAnimation)||void 0===t?void 0:t.isRunning)&&(this._rotateAnimation.stop(),this._rotateAnimation=void 0)},e.prototype._stopTiltAnimationIfAny=function(){var t;(null===(t=this._tiltAnimation)||void 0===t?void 0:t.isRunning)&&(this._tiltAnimation.stop(),this._tiltAnimation=void 0)},e}((0,E.GA)().with()),pe=function(t){function e(e,o,i){var n=t.call(this)||this;return n._element=w("ymaps3x0--magnifier"),n._backdropElement=w("ymaps3x0--magnifier-backdrop"),n._onDragStart=function(){n._selectionInfo=n._computeSelectionInfo(),n._map.container.appendChild(n._element),document.body.appendChild(n._backdropElement),n._updateElementDimensions(n._selectionInfo),n._emit("selectionStart")},n._onDragMove=function(){n._selectionInfo&&(n._selectionInfo=n._computeSelectionInfo(),n._updateElementDimensions(n._selectionInfo))},n._onDragEnd=function(){n._selectionInfo&&(n._animation=n._zoomByCurrentSelection(n._selectionInfo),(0,s.promiseFinally)(n._animation.complete,(function(){return n._emit("selectionEnd")})),n._cleanupSelection()),setTimeout((function(){return n._detachBackdrop()}))},n._onKeyDown=function(t){"Escape"===t.key&&n._selectionInfo&&(n._emit("selectionEnd"),n._cleanupSelection())},n._backdropElement.addEventListener("contextmenu",(function(t){return t.preventDefault()})),n._map=e,n._dragger=o,n.snapToRound=i,n._init(),n}return(0,n.ZT)(e,t),e.prototype.destroy=function(){this._suspend(),this._detachElement()},Object.defineProperty(e.prototype,"isInAction",{get:function(){return void 0!==this._animation&&this._animation.isRunning},enumerable:!1,configurable:!0}),e.prototype.enable=function(){this._init()},e.prototype.disable=function(){this._suspend()},e.prototype._init=function(){this._subscriptions||(document.addEventListener("keydown",this._onKeyDown),this._subscriptions=this._dragger.group().on("dragStart",this._onDragStart).on("dragMove",this._onDragMove).on("dragEnd",this._onDragEnd))},e.prototype._suspend=function(){this._animation&&this._animation.isRunning&&this._animation.stop(),document.removeEventListener("keydown",this._onKeyDown),this._subscriptions&&(this._subscriptions.offAll(),this._subscriptions=void 0),this._detachBackdrop()},e.prototype._cleanupSelection=function(){this._selectionInfo=void 0,this._detachElement()},e.prototype._detachElement=function(){this._element.parentNode&&this._element.parentNode.removeChild(this._element)},e.prototype._detachBackdrop=function(){this._backdropElement.parentNode&&this._backdropElement.parentNode.removeChild(this._backdropElement)},e.prototype._updateElementDimensions=function(t){var e=t.point,o=t.offset;this._element.style.left="".concat(Math.round(e.x),"px"),this._element.style.top="".concat(Math.round(e.y),"px"),this._element.style.width="".concat(Math.abs(Math.round(o.x)),"px"),this._element.style.height="".concat(Math.abs(Math.round(o.y)),"px"),this._element.style.transform="scale(".concat(o.x<0?-1:1,", ").concat(o.y<0?-1:1,")")},e.prototype._zoomByCurrentSelection=function(t){var e=function(t,e,o){var i=t.size,n=t.worldCenter,a=t.zoom,s=t.zoomRange,l=t.azimuth,c=t.tilt,d=t.fov,p=(0,R.q)(Math.abs(e.offset.x),1e-10,i.x),h=(0,R.q)(Math.abs(e.offset.y),1e-10,i.y),_=a+Math.min((0,r.mathLog2)(i.x/p),(0,r.mathLog2)(i.y/h));o&&(_=Math.floor(_));var m=e.point,f=u.add(e.point,e.offset),y=u.divn(u.add(m,f),2);return{zoom:Math.min(Math.max(_,s.min),s.max),center:(0,C.wm)(y,{size:i,worldCenter:n,zoom:a,azimuth:l,tilt:c,fov:d})}}(this._map,t,this.snapToRound),o=e.center,i=e.zoom;return Pt(this._map,o,i,300)},e.prototype._computeSelectionInfo=function(){var t=this._map.container.getBoundingClientRect(),e=t.left,o=t.top;return{point:u.sub(this._dragger.dragStartingPoint,{x:e,y:o}),offset:this._dragger.dragOffset}},e}((0,E.GA)().with());var he=function(t){function e(e,o,i,n){var r=t.call(this)||this;return r._isEnabled=!1,r._deviceStateChangedEventGroup=void 0,r._onClick=function(t){if(r._dragEventGroup)r._destroyDragEvents();else{var e=u.create(t.x,t.y);r._dragEventGroup=r._initDragEvents(e),window.clearTimeout(r._clickTimer),r._clickTimer=window.setTimeout((function(){r._destroyDragEvents()}),300)}},r._map=e,r._device=o,r._dragger=i,r.zoomStrategy=n,r._init(),r}return(0,n.ZT)(e,t),e.prototype.destroy=function(){this._suspend()},Object.defineProperty(e.prototype,"isInAction",{get:function(){return void 0!==this._animation&&this._animation.isRunning},enumerable:!1,configurable:!0}),e.prototype.enable=function(){this._init()},e.prototype.disable=function(){this._suspend()},e.prototype._init=function(){this._isEnabled||(this._addListeners(),this._isEnabled=!0)},e.prototype._suspend=function(){this._isEnabled&&(window.clearTimeout(this._clickTimer),this._destroyDragEvents(),this._removeListeners(),this._animation&&this._animation.isRunning&&this._animation.stop(),this._isEnabled=!1)},e.prototype._addListeners=function(){var t,e=this;this._deviceStateChangedEventGroup||(this._deviceStateChangedEventGroup=this._device.on("stateChanged",(function(){e._device.state!==zt.PRIMARY?(t&&u.length(u.sub(t,e._device.pointerPosition))<=7&&e._onClick(t),t=void 0):t=e._device.pointerPosition})))},e.prototype._removeListeners=function(){this._deviceStateChangedEventGroup&&(this._deviceStateChangedEventGroup.offAll(),this._deviceStateChangedEventGroup=void 0)},e.prototype._initDragEvents=function(t){var e=this,o=this._dragger.group();return o.on("dragStart",(function(){var i=e._dragger.dragStartingPoint;window.clearTimeout(e._clickTimer),u.length(u.sub(t,i))>20||(e._emit("zoomStart"),o.on("dragMove",(function(){var o=e._dragger.pointerPosition,n=u.sub(o,i);i=o;var r=n.y/e._map.size.y*10,a=e._map.zoom+r,s=e._map.zoomRange;if(!(a<s.min||a>s.max)){var l=e.zoomStrategy===te.ZOOM_TO_CENTER?e._map.worldCenter:(0,C.XA)(t,e._map);e._animation=Rt(e._map,a,0,l)}})),o.on("dragEnd",(function(){e._destroyDragEvents(),e._animation?(0,s.promiseFinally)(e._animation.complete,(function(){return e._emit("zoomEnd")})):e._emit("zoomEnd")})))})),o},e.prototype._destroyDragEvents=function(){this._dragEventGroup&&(this._dragEventGroup.offAll(),this._dragEventGroup=void 0)},e}((0,E.GA)().with()),_e=function(t){function e(e,o){var i=t.call(this)||this;return i._isRotateStartEmitted=!1,i._isTiltStartEmitted=!1,i._state={type:0},i.rotationAllowed=!0,i.tiltAllowed=!0,i._onDragStart=function(){0===i._state.type&&(i._state={type:1,animation:i._map.animate(i._onAnimationStep),previousPoint:i._dragger.dragStartingPoint})},i._onDragMove=function(){i._state.type},i._onDragEnd=function(){1===i._state.type&&(i._state.animation.stop(),i._state={type:0},i._stopRotate(),i._stopTilt())},i._onAnimationStep=function(t){if(1!==i._state.type)return t;var e=u.sub(i._state.previousPoint,i._dragger.pointerPosition);i._state.previousPoint=i._dragger.pointerPosition;var o=i.rotationAllowed?Math.PI*e.x/i._map.size.x:0,r=i.tiltAllowed?Math.PI*e.y/i._map.size.y:0;return o&&!i._isRotateStartEmitted&&(i._emit("rotateStart"),i._isRotateStartEmitted=!0),r&&!i._isTiltStartEmitted&&(i._emit("tiltStart"),i._isTiltStartEmitted=!0),(0,n.pi)((0,n.pi)({},t),{azimuth:t.azimuth+o,tilt:t.tilt+r})},i._map=e,i._dragger=o,i._draggerSubscription=i._dragger.on("dragStart",i._onDragStart).on("dragMove",i._onDragMove).on("dragEnd",i._onDragEnd),i.enable(),i}return(0,n.ZT)(e,t),Object.defineProperty(e.prototype,"isInAction",{get:function(){return 1===this._state.type},enumerable:!1,configurable:!0}),e.prototype.enable=function(){this._state={type:0}},e.prototype.disable=function(){this.stop(),this._state={type:2}},e.prototype.stop=function(){1===this._state.type&&(this._state.animation.stop(),this._state={type:0},this._stopRotate(),this._stopTilt())},e.prototype.destroy=function(){this.disable(),this._draggerSubscription.offAll()},e.prototype._stopRotate=function(){this._isRotateStartEmitted&&(this._emit("rotateEnd"),this._isRotateStartEmitted=!1)},e.prototype._stopTilt=function(){this._isTiltStartEmitted&&(this._emit("tiltEnd"),this._isTiltStartEmitted=!1)},e}((0,E.GA)().with()),me=18*S.Z,fe=function(t){function e(e,o){var i=t.call(this)||this;i._subscriptions=[],i._zoomStrategy=te.ZOOM_TO_POINTER,i._userEnabled=[],i._mapEnabledRotation=!0,i._restoreDrag=function(){-1!==i._userEnabled.indexOf("drag")&&i.drag.enable()},i._deviceEventsFilter=function(t){var o=t.target,i=o instanceof HTMLElement?e.findMarkerByElement(o):null;return Boolean(null==i?void 0:i.marker.options.blockBehaviors)};var n=Xt(e.container,{filter:i._deviceEventsFilter});i._map=e;var a="snap"===i._map.effectiveZoomRounding;i._zoomPointSrc=function(){if(i._zoomStrategy===te.ZOOM_TO_CENTER){var t=i._map.center,o=t[0],r=t[1],a=i._map.projection.toGlobalCoordinates([o,r]);return(0,C.k6)(a,i._map)}var s=n.pointerPosition,u=e.container.getBoundingClientRect();return{x:s.x-u.left,y:s.y-u.top}},i._leftButtonDragger=new qt(n),i._rightButtonDragger=new qt(n,{listenToButtons:new r.Set([zt.SECONDARY])}),i.magnifier=new pe(e,i._rightButtonDragger,a),i._proxyEvents(i.magnifier,"magnifier",["selectionStart","selectionEnd"]),i.drag=new le(e,i._leftButtonDragger),i._proxyEvents(i.drag,"drag",["dragStart","dragEnd"]),i.dblClick=new ce(e,200,i._zoomPointSrc),i._proxyEvents(i.dblClick,"dblClick",["zoomStart","zoomEnd"]),i.magnifier.disable();var s={zoomDuration:200,rotateDuration:200,rotateThreshold:me,tiltDuration:200,getZoomStrategy:function(){return i._zoomStrategy},getZoomPointSrc:i._zoomPointSrc,snapToRound:a};i._twoFingersGesture=new Qt(n),i.pinchZoom=new de(e,i._twoFingersGesture,s),i._proxyEvents(i.pinchZoom,"pinchZoom",["zoomStart","zoomEnd"]),i._proxyEvents(i.pinchZoom,"panTilt",["tiltStart","tiltEnd"]);var u=i.pinchZoom.on("zoomStart",(function(){i._zoomStrategy===te.ZOOM_TO_CENTER&&i.drag.disable()})).on("zoomEnd",i._restoreDrag).on("tiltStart",(function(){return i.drag.disable()})).on("tiltEnd",i._restoreDrag);i._subscriptions.push(u),i._wheelDevice=new ee(i._map.container,{filter:i._deviceEventsFilter}),i._roundScrollZoom=new oe(i._map,i._wheelDevice,i._zoomPointSrc,200),i._proxyEvents(i._roundScrollZoom,"scrollZoom",["zoomStart","zoomEnd"]),i._smoothScrollZoom=new re(i._map,i._wheelDevice,i._zoomPointSrc),i._proxyEvents(i._smoothScrollZoom,"scrollZoom",["zoomStart","zoomEnd"]),i.oneFingerZoom=new he(e,n,i._leftButtonDragger,i._zoomStrategy),i._proxyEvents(i.oneFingerZoom,"oneFingerZoom",["zoomStart","zoomEnd"]);var l=i.oneFingerZoom.on("zoomStart",(function(){return i.drag.disable()})).on("zoomEnd",i._restoreDrag);i._subscriptions.push(l);var c=new qt(n,{listenToButtons:new r.Set([zt.CTRL_PRIMARY,zt.CMD_PRIMARY])});return i.rotate=new _e(i._map,c),i._proxyEvents(i.rotate,"mouseRotate",["rotateStart","rotateEnd"]),i._proxyEvents(i.rotate,"mouseTilt",["tiltStart","tiltEnd"]),i._behaviorsRegistry={drag:i.drag,pinchZoom:i.pinchZoom,scrollZoom:a?i._roundScrollZoom:i._smoothScrollZoom,dblClick:i.dblClick,magnifier:i.magnifier,oneFingerZoom:i.oneFingerZoom,mouseRotate:!1,mouseTilt:!1,pinchRotate:!1,panTilt:!1},i.setEnabled(o),i._updateZoomRounding(),i}return(0,n.ZT)(e,t),Object.defineProperty(e.prototype,"isInAction",{get:function(){for(var t=0,e=Object.keys(this._behaviorsRegistry);t<e.length;t++){var o=e[t];if("pinchRotate"!==o&&"panTilt"!==o&&"mouseRotate"!==o&&"mouseTilt"!==o&&this._behaviorsRegistry[o].isInAction)return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoomStrategy",{get:function(){return this._zoomStrategy},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._subscriptions.forEach((function(t){return t.offAll()})),this.drag.destroy(),this.pinchZoom.destroy(),this.dblClick.destroy(),this.magnifier.destroy(),this.oneFingerZoom.destroy(),this.rotate.destroy(),this._roundScrollZoom.destroy(),this._smoothScrollZoom.destroy(),this._leftButtonDragger.destroy(),this._rightButtonDragger.destroy(),this._twoFingersGesture.destroy(),this._wheelDevice.destroy()},e.prototype.setEnabled=function(t){var e;(e=this._userEnabled).splice.apply(e,(0,n.ev)([0,1/0],t,!1));for(var o=0,i=Object.keys(this._behaviorsRegistry);o<i.length;o++){var r=i[o];this._setEnabledSingle(r,-1!==t.indexOf(r))}},e.prototype.setZoomStrategy=function(t){this._zoomStrategy=t,this.oneFingerZoom.zoomStrategy=t},e.prototype.mapToggleRotation=function(t){this._mapEnabledRotation=t,this.setEnabled(this._userEnabled)},e.prototype._updateZoomRounding=function(){var t="snap"===this._map.effectiveZoomRounding;this.magnifier.snapToRound=t,this.pinchZoom.snapToRound=t,t?(this._roundScrollZoom.enable(),this._smoothScrollZoom.disable(),this._behaviorsRegistry.scrollZoom=this._roundScrollZoom):(this._roundScrollZoom.disable(),this._smoothScrollZoom.enable(),this._behaviorsRegistry.scrollZoom=this._smoothScrollZoom)},e.prototype._setEnabledSingle=function(t,e){"pinchRotate"===t?this._behaviorsRegistry.pinchZoom.rotationAllowed=this._mapEnabledRotation&&e:"panTilt"===t?this._behaviorsRegistry.pinchZoom.tiltAllowed=this._mapEnabledRotation&&e:"mouseRotate"===t?this.rotate.rotationAllowed=this._mapEnabledRotation&&e:"mouseTilt"===t?this.rotate.tiltAllowed=this._mapEnabledRotation&&e:e?this._behaviorsRegistry[t].enable():this._behaviorsRegistry[t].disable(),"scrollZoom"===t&&(e?this._wheelDevice.enable():this._wheelDevice.disable())},e.prototype._proxyEvents=function(t,e,o){var i=this;this._subscriptions.push(t.on(o[0],(function(){return i._emit("actionStart",e)})).on(o[1],(function(){return i._emit("actionEnd",e)})))},e}((0,E.GA)().with()),ye=function(){function t(t,e){void 0===t&&(t=6378137),void 0===e&&(e=.0818191908426),this.radius=t,this.e=e,this._e2=this.e*this.e,this._e4=this._e2*this._e2,this._e6=this._e4*this._e2,this._e8=this._e4*this._e4,this._subradius=1/t,this._d2=this._e2/2+5*this._e4/24+this._e6/12+13*this._e8/360,this._d4=7*this._e4/48+29*this._e6/240+811*this._e8/11520,this._d6=7*this._e6/120+81*this._e8/1120,this._d8=4279*this._e8/161280}return t.prototype.mercatorToGeo=function(t){var e=this.xToLongitude(t.x),o=this.yToLatitude(t.y),i=void 0!==t.z?this.zToAltitude(t.z,o):void 0;return void 0!==i?[e,o,i]:[e,o]},t.prototype.geoToMercator=function(t){var e=t[2];return{x:this.longitudeToX(t[0]),y:this.latitudeToY(t[1]),z:void 0!==e?this.altitudeToZ(e,t[1]):void 0}},t.prototype.xToLongitude=function(t){return S.j*(0,R.d)(t*this._subradius,-Math.PI,Math.PI)},t.prototype.yToLatitude=function(t){var e=.5*Math.PI-2*Math.atan(1/Math.exp(t*this._subradius)),o=e+this._d2*Math.sin(2*e)+this._d4*Math.sin(4*e)+this._d6*Math.sin(6*e)+this._d8*Math.sin(8*e);return S.j*o},t.prototype.zToAltitude=function(t,e){return t*Math.cos(S.Z*e)},t.prototype.longitudeToX=function(t){var e=(0,R.d)(S.Z*t,-Math.PI,Math.PI);return this.radius*e},t.prototype.latitudeToY=function(t){var e=S.Z*(0,R.q)(t,1e-10-90,90-1e-10),o=this.e*Math.sin(e),i=Math.tan(.25*Math.PI+.5*e)/Math.pow(Math.tan(.25*Math.PI+.5*Math.asin(o)),this.e);return this.radius*Math.log(i)},t.prototype.altitudeToZ=function(t,e){return t/Math.cos(S.Z*e)},t}(),ve=new(function(){function t(t,e){this._mercator=new ye(t,e),this._halfEquator=Math.PI*this._mercator.radius}return t.prototype.toGlobalCoordinates=function(t){var e=this._mercator.geoToMercator(t);return{x:(this._halfEquator+e.x)/this._halfEquator-1,y:(0,R.q)(1-(this._halfEquator-e.y)/this._halfEquator,-1,1),z:void 0!==e.z?e.z/this._halfEquator:void 0}},t.prototype.fromGlobalCoordinates=function(t){var e=this._mercator.yToLatitude(this._halfEquator-(1-t.y)*this._halfEquator);e=(0,R.q)(e,-90,90);var o=S.j*(0,R.d)(Math.PI*t.x,-Math.PI,Math.PI),i=void 0!==t.z?t.z*this._halfEquator:void 0;return void 0!==i?[o,e,i]:[o,e]},t}()),ge="none",be="any",Se=Math.pow(15,2),xe=["touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointercancel","click","dblclick","mouseup","mousedown","mouseenter","mouseleave","mousemove","contextmenu"],Ee=["mousedown","touchstart","pointerdown","contextmenu"],ze=function(){},we=function(){function t(t,e){var o=this;this._previousRightClickTimestamp=0,this._stopWaitingHotspots=ze,this._handlers={},this._activeObject=null,this.clickTimeout=300,this.waitHotspotsTimeout=1e3,this._onEvent=function(t){if("dblclick"!==t.type&&!o._map.isInAction){var e,i,n=t.target instanceof HTMLElement?o._map.findMarkerByElement(t.target):null;if(!(null==n?void 0:n.marker.options.blockEvents)||(null==n?void 0:n.marker.options.draggable))if(Ee.indexOf(t.type)>=0&&o._stopWaitingHotspots(!1),"click"===t.type)if(o._processEvent("fastclick",t),t.preventDefault(),void 0!==o._clickTimer){window.clearTimeout(o._clickTimer),o._clickTimer=void 0;var r=Te(t);e=o._previousClickPosition,i=r,Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2)<Se&&o._processEvent("dblclick",t)}else o._previousClickPosition=Te(t),o._clickTimer=window.setTimeout((function(){o._clickTimer=void 0,o._map.isInAction||o._waitHotspots(t).then((function(e){e&&!o._map.isInAction&&o._processEvent("click",t)}))}),o.clickTimeout);else if("contextmenu"===t.type){var a=Date.now();a-o._previousRightClickTimestamp<o.clickTimeout?(o._previousRightClickTimestamp=0,o._processEvent("rightdblclick",t)):o._previousRightClickTimestamp=a}else o._processEvent(t.type,t)}},this._waitHotspots=function(t){return new Promise((function(e){var i=o._computeAllCoordinates(t);if(i){var n=i[1],a=function(){var t=o._map.findObjectInWorldPositionEx(n),e=(0,r.arrayFind)(t.layers,(function(t){return null!==t.object}));e&&void 0===e.object||o._stopWaitingHotspots(!0)},s=window.setTimeout((function(){return o._stopWaitingHotspots(!0)}),o.waitHotspotsTimeout),u=o._map.on("hotspotsChanged",a);o._stopWaitingHotspots=function(t){window.clearTimeout(s),u.offAll(),e(t),o._stopWaitingHotspots=ze},a()}else e(!1)})).catch((function(t){(0,A._y)(t)}))},this._computeAllCoordinates=function(t){var e=Te(t);if(!isFinite(e.x)||!isFinite(e.y))return null;var i=(0,C.XA)(e,o._map);return[e,i,o._map.projection.fromGlobalCoordinates(i)]},this._processEvent=function(t,e){var i=o._computeAllCoordinates(e);if(i){var n=i[0],r=i[1],a=i[2],s=o._map.findObjectInWorldPosition(r);o._eventObjectsFilter&&!o._eventObjectsFilter(s)&&(s=null);var u={coordinates:[a[0],a[1]],screenCoordinates:[n.x,n.y]};if("mousemove"===e.type){s&&o._emitLayerEvent("mousemove",s,u,e);var l=o._activeObject;l&&s&&function(t,e){if(t.type!==e.type||t.layer!==e.layer)return!1;return"hotspot"===t.type&&t.feature.id===e.feature.id||"feature"===t.type&&t.feature.id===e.feature.id||"marker"===t.type&&t.marker===e.marker}(l,s)||(l&&o._emitLayerEvent("mouseleave",l,u,e),s&&o._emitLayerEvent("mouseenter",s,u,e)),o._activeObject=s}else s&&o._emitLayerEvent(t,s,u,e);s||(o._initHandlers(t,ge),o._handlers[t].none.forEach((function(t){return t(null,u,e)})),o._initHandlers(t,be),o._handlers[t].any.forEach((function(t){return t(null,u,e)})))}},this._emitLayerEvent=function(t,e,i,n){o._initHandlers(t,e.layer),o._handlers[t][e.layer].forEach((function(t){return t(e,i,n)})),o._initHandlers(t,be),o._handlers[t].any.forEach((function(t){return t(e,i,n)}))},this._initHandlers=function(t,e){o._handlers[t]=o._handlers[t]||{},o._handlers[t][e]=o._handlers[t][e]||[]},this._map=t,this._eventObjectsFilter=e,xe.forEach((function(t){return o._map.container.addEventListener(t,o._onEvent)}))}return t.prototype.destroy=function(){var t=this;this._stopWaitingHotspots(!1),window.clearInterval(this._clickTimer),xe.forEach((function(e){return t._map.container.removeEventListener(e,t._onEvent)}))},t.prototype.on=function(t,e,o){this._initHandlers(t,e),this._handlers[t][e].push(o)},t.prototype.off=function(t,e,o){this._initHandlers(t,e);var i=this._handlers[t][e].indexOf(o);-1!==i&&this._handlers[t][e].splice(i,1)},t}();function Te(t){if("touches"in t){var e=t.touches[0]||t.changedTouches[0];return{x:e.clientX,y:e.clientY}}return{x:t.clientX,y:t.clientY}}var Ce=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.element=w(),e}return(0,n.ZT)(e,t),e.prototype.getLayerReadyState=function(){},e.prototype.destroy=function(){},e.prototype.update=function(){},e.prototype.resize=function(){},e.prototype.setLayers=function(){},e.prototype.setObjectFilters=function(){},e.prototype.setInvisibleCollidingPrimitives=function(){},e.prototype.findObjectInPosition=function(){return null},e.prototype.findObjectInPositionEx=function(){return{layers:[]}},e.prototype.preloadHotspotsInPoint=function(){},e.prototype.preloadHotspotsForViewport=function(){},e.prototype.setDataSources=function(){},e.prototype.getIndoorPlans=function(){return null},e.prototype.getVisibleObjects=function(){return null},e.prototype.getTile3dState=function(){return null},e.prototype.setObjectHighlight=function(){},Object.defineProperty(e.prototype,"fov",{get:function(){return X},enumerable:!1,configurable:!0}),e}((0,E.GA)().with()),Re=function(){function t(t,e,o,i){var n=this;this._dataSources={},this._layers=new r.Map,this._onMouseEnter=function(t){var e;if("feature"===t.type){var o=null===(e=n._dataSources[t.source].features.get(t.feature.id))||void 0===e?void 0:e.style.cursor;void 0!==o&&(void 0===n._prevCursor&&(n._prevCursor=n._element.style.cursor),n._element.style.cursor=o)}},this._onMouseLeave=function(){void 0!==n._prevCursor&&(n._element.style.cursor=n._prevCursor,n._prevCursor=void 0)},this._map=t,this._element=e,this.setDataSources(o),this.setLayers(i)}return t.prototype.destroy=function(){var t=this;this._layers.forEach((function(e,o){return t._unsubscribeFromLayerEvents(o)}))},t.prototype.setDataSources=function(t){this._dataSources=(0,n.pi)({},t)},t.prototype.setLayers=function(t){for(var e=this,o=new r.Set,i=0,n=t;i<n.length;i++){var a=n[i];a.source in this._dataSources&&o.add(a.id)}var s=(0,B.B)(this._layers,o,(function(t){return e._subscribeToLayerEvents(t)}),(function(t,o){return e._unsubscribeFromLayerEvents(o)})).result;this._layers=s},t.prototype._subscribeToLayerEvents=function(t){this._map.events.on("mouseenter",t,this._onMouseEnter),this._map.events.on("mouseleave",t,this._onMouseLeave)},t.prototype._unsubscribeFromLayerEvents=function(t){this._map.events.off("mouseenter",t,this._onMouseEnter),this._map.events.off("mouseleave",t,this._onMouseLeave)},t}();function Ae(t,e,o){var i=z.B.pixelsToWorld(e,o);return t.fromGlobalCoordinates(i)}function Pe(t,e,o){var i=t.toGlobalCoordinates(e);return z.B.worldToPixels(i,o)}function Me(t,e,o){var i=Pe(t,e[0],o),n=Pe(t,e[1],o),r=z.B.getWorldPixelSize(o),a=[[i.x,i.y],[n.x,n.y]];return i.x>n.x&&(a[0][0]=i.x,a[1][0]=n.x+r),i.y>n.y&&(a[0][1]=n.y,a[1][1]=i.y),a}function De(t,e){return{x:Math.max(t.x-(e?e[1]+e[3]:0),1),y:Math.max(t.y-(e?e[0]+e[2]:0),1)}}function Le(t,e,o,i,n,a){void 0===n&&(n=!0),void 0===a&&(a=(0,g.oF)());var s=function(t,e,o,i,n){var a=Me(t,e,0),s=a[0],u=s[0],l=s[1],c=a[1],d=c[0],p=c[1],h=Math.max(Math.abs(d-u),1e-10),_=Math.max(Math.abs(p-l),1e-10),m=(0,R.q)(Math.min((0,r.mathLog2)(o.x/h),(0,r.mathLog2)(o.y/_)),n.min,n.max);return i?Math.floor(m+1e-6):m}(t,e,De(o,i),n,a),u=function(t,e,o){var i=Me(t,e,o),n=i[0],r=n[0],a=n[1],s=i[1];return Ae(t,{x:(r+s[0])/2,y:(a+s[1])/2},o)}(t,e,s);return{center:u,zoom:s}}var Ie={x:0,y:0},Oe={pointer:{start:["pointerdown"],move:["pointermove"],end:["pointerup"]},touchMouse:{start:["touchstart","mousedown"],move:["touchmove","mousemove"],end:["touchend","mouseup"]}},Fe=function(t){function e(e,o){void 0===o&&(o={tremorPixels:3});var i=t.call(this)||this;return i._map=e,i._options=o,i._filters=new r.Set,i._draggableObjectPointer=null,i._startDiff=null,i._startCursorPosition=null,i._pointerPosition=Ie,i._state=0,i._mapCenterOffsetWcs=Ie,i._eventsNames=Ft()?Oe.pointer:Oe.touchMouse,i._onDragStart=function(t,e){var o=e.screenCoordinates;if(t&&("marker"===t.type||"feature"===t.type)&&i._isDraggable(i._draggableObject(t))){i._state=1,i._draggableObjectPointer=t,i._startCursorPosition=o,i._pointerPosition={x:o[0],y:o[1]};var n=ke(i._draggableObject(t)),r=(0,C.XA)({x:o[0],y:o[1]},i._map);i._startDiff={world:u.sub(n,r),pixels:u.sub(z.B.worldToPixels(n,i._map.zoom),z.B.worldToPixels(r,i._map.zoom))},i._eventsNames.move.forEach((function(t){i._map.events.on(t,"any",i._onDrag)})),i._eventsNames.end.forEach((function(t){window.addEventListener(t,i._onDragEnd)}))}},i._onDrag=function(t,e){var o=e.screenCoordinates;i._pointerPosition={x:o[0],y:o[1]};var n=(0,C.XA)(i._pointerPosition,i._map),r=i._getNewGeometry(n),a=i._draggableObject(i._draggableObjectPointer);1===i._state?Math.max(Math.abs(i._startCursorPosition[0]-o[0]),Math.abs(i._startCursorPosition[1]-o[1]))>i._options.tremorPixels&&!1!==i._emit("dragStart",{object:a,newGeometry:r})&&(i._state=2,i._map.on("stateChanged",i._onMapChanged)):(i._startCursorPosition=o,!1!==i._emit("dragMove",{object:a,newGeometry:r})&&(i._updateCoordinates(r),i._markerDragMapFollowerHandler(a)))},i._onMapChanged=function(){i._onDrag(null,{screenCoordinates:[i._pointerPosition.x,i._pointerPosition.y]})},i._onDragEnd=function(){if(0!==i._state){if(i._stopMapDragFollowAnimation(),i._eventsNames.move.forEach((function(t){i._map.events.off(t,"any",i._onDrag)})),i._eventsNames.end.forEach((function(t){window.removeEventListener(t,i._onDragEnd)})),i._map.offSingle("stateChanged",i._onMapChanged),2===i._state){var t=(0,C.XA)(i._pointerPosition,i._map);i._emit("dragEnd",{object:i._draggableObject(i._draggableObjectPointer),newGeometry:i._getNewGeometry(t)})}i._draggableObjectPointer=null,i._state=0}},i._eventsNames.start.forEach((function(t){i._map.events.on(t,"any",i._onDragStart)})),i}return(0,n.ZT)(e,t),e.prototype.destroy=function(){var t=this;this._eventsNames.start.forEach((function(e){t._map.events.off(e,"any",t._onDragStart)})),this._onDragEnd(),this._stopMapDragFollowAnimation()},Object.defineProperty(e.prototype,"filters",{get:function(){var t=[];return this._filters.forEach((function(e){t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDragging",{get:function(){return this._state>0},enumerable:!1,configurable:!0}),e.prototype.addFilter=function(t){return this._filters.add(t),this},e.prototype.removeFilter=function(t){return this._filters.delete(t),this},e.prototype._draggableObject=function(t){return"marker"===t.type?t:"feature"===t.type?this._map.getFeatureInWorldCoordinatesById(t.source,t.feature.id):void(0,A._y)(new Error("Need implementation for type: ".concat(t.type)))},e.prototype._isDraggable=function(t){if(!t||!this._filters.size)return!1;var e=!1;return this._filters.forEach((function(o){o(t)&&(e=!0)})),e},e.prototype._getNewGeometry=function(t){var e=this._draggableObjectPointer,o=this._draggableObject(e);if("marker"===o.type)return this._calculateWorldWithPixelFixedOffset(t);if("Point"===o.geometry.type)return this._calculateWorldWithPixelFixedOffset(t);var i=u.sub(ke(o),u.add(t,this._startDiff.world));return(0,y.ZE)(o.geometry,(function(t){return u.sub(t,i)}))},e.prototype._updateCoordinates=function(t){var e=this._draggableObjectPointer,o=this._draggableObject(e);if("marker"===o.type)return o.marker.setWorldCoordinates(t.coordinates);o.geometry.coordinates=t.coordinates,this._map.updateInWorldCoordinatesFeature(e.source,o)},e.prototype._calculateWorldWithPixelFixedOffset=function(t){var e=z.B.worldToPixels(t,this._map.zoom);return{type:"Point",coordinates:z.B.pixelsToWorld(u.add(e,this._startDiff.pixels),this._map.zoom)}},e.prototype._markerDragMapFollowerHandler=function(t){if("marker"===t.type&&t.marker.options.mapFollowsOnDrag){var e=t.marker,o=this._map;if(o&&this.isDragging){var i=(0,n.ev)([],e.options.mapActiveZoneMargin,!0);o.margin&&(i[0]+=o.margin[0],i[1]+=o.margin[1],i[2]+=o.margin[2],i[3]+=o.margin[3]);var a=o.container.getBoundingClientRect(),s={x:a.width,y:a.height};s.x-=i[1]+i[3],s.y-=i[0]+i[2];var l=function(t,e,o){var i=u.divn(t,2),n=u.sub(o,e);if(n.x>-i.x&&n.x<i.x&&n.y>-i.y&&n.y<i.y)return{x:0,y:0};var a={x:0,y:0};if(0===n.x)a.x=0,a.y=i.y*(0,r.mathSign)(n.y);else{var s=n.y/n.x,l=s*i.x;if(l>=-i.y&&l<=i.y){var c=(0,r.mathSign)(n.x);a.x=i.x*c,a.y=l*c}else{var d=1/s*i.y;c=(0,r.mathSign)(n.y),a.x=d*c,a.y=i.y*c}}return u.sub(n,a)}(s,u.add(u.divn(s,2),{x:i[3],y:i[0]}),u.sub(this._pointerPosition,{x:a.left,y:a.top}));u.divn(l,2,l);var c=u.length(l);c>120&&u.muln(l,120/c,l),this._setMapCenterOffsetWcs(e,z.B.convertPixelSizeToWorldSize(l,o.zoom))}else this._setMapCenterOffsetWcs(e,Ie)}},e.prototype._animateMap=function(t){var e=this;if(this._hasOffset&&this.isDragging){var o=this._map;this._mapDragFollowHandler=this._map.animate((function(){return t.setWorldCoordinates(u.add(t.worldCoordinates,e._mapCenterOffsetWcs)),{worldCenter:u.add(e._mapCenterOffsetWcs,o.worldCenter),azimuth:o.azimuth,zoom:o.zoom,tilt:o.tilt}}))}},e.prototype._stopMapDragFollowAnimation=function(){var t;(null===(t=this._mapDragFollowHandler)||void 0===t?void 0:t.isRunning)&&this._mapDragFollowHandler.stop()},e.prototype._setMapCenterOffsetWcs=function(t,e){var o,i=e.x,n=e.y;this._mapCenterOffsetWcs.x===i&&this._mapCenterOffsetWcs.y===n||(this._mapCenterOffsetWcs={x:i,y:n},null===(o=this._stopMapDragFollowAnimation)||void 0===o||o.call(this),this._animateMap(t))},Object.defineProperty(e.prototype,"_hasOffset",{get:function(){return 0!==this._mapCenterOffsetWcs.x||0!==this._mapCenterOffsetWcs.y},enumerable:!1,configurable:!0}),e}((0,E.GA)().with());function ke(t){if("marker"===t.type)return t.marker.worldCoordinates;switch(t.geometry.type){case"Point":return t.geometry.coordinates;case"LineString":return t.geometry.coordinates[0];case"Polygon":case"MultiLineString":return t.geometry.coordinates[0][0];case"MultiPolygon":return t.geometry.coordinates[0][0][0]}}var je=Math.round,Be=Math.round,Ge="ymaps3x0--main-engine-container",Ze="ymaps3x0--hide",We=function(t){function e(e){var o=t.call(this)||this;o._renderLoop=new v.d,o._dataSources={},o._filters=new r.Set,o._invisibleCollidingPrimitives=new r.Map,o._topRasterLayers=[],o._mainLayers=[],o._vectorFailed=!1,o._featuresByDataSource=new r.Map,o._cameraOptions={enabledTiltTransition:!1},o._destroyed=!1,o.container=w("ymaps3x0--map"),o._onVectorError=function(t){o._vectorFailed=!0,o._applyMode(),o._emit("vectorError"),(0,A.H)(t),console.error(t)};var i,a=e.element,s=e.dataSources,u=e.topRasterLayers,l=e.mainLayers,c=e.mode,d=e.margin,p=e.zoomRange,h=e.zoomRounding,_=void 0===h?"auto":h,m=e.behaviors,f=void 0===m?["drag","scrollZoom","pinchZoom","dblClick","magnifier"]:m,y=e.projection,S=void 0===y?ve:y,x=e.worldOptions,E=void 0===x?{cycledX:!0,cycledY:!1}:x,z=e.restrictMapArea,T=void 0!==z&&z,C=e.eventObjectsFilter,R=e.disableRasterPreload,P=e.experiments,M=void 0===P?{}:P,D=e.nonRotatableRasterSources,L=void 0===D?[]:D,O=e.metricsTransport,F=void 0===O?function(){}:O,k=e.devpreview,j=void 0===k?{}:k;i=F,I||(I=i),o._experiments=M,o._devpreview=j,o._projection=S,o.worldOptions=E,o.restrictMapArea=T,o._worldRestrictMapArea=T&&T.map((function(t){return S.toGlobalCoordinates(t)})),o._nonRotatableRasterSources=new r.Set(L),o._topEngineContainer=w("ymaps3x0--top-engine-container"),o._mainEngineContainer=w(Ge),o.container.appendChild(o._mainEngineContainer),o.container.appendChild(o._topEngineContainer),a.appendChild(o.container);var B=Ne(o.container),G=B.size,Z=B.offset;o._size=G,o._offset=Z,o._zoomRange=p?(0,n.pi)({},p):(0,g.oF)(),o._zoomRounding=_,o._margin=d;var W=e,N=W.bounds,Y=W.center,H=W.zoom;o._camera=o._createCamera(N,Y,H),o._effectiveMode=null,o._desiredMode=c,o._disableRasterPreload=Boolean(R),o._dataSourceDescriptions={};for(var X=0,V=Object.keys(s);X<V.length;X++){var q=V[X];o._dataSourceDescriptions[q]=(0,b.wo)(s[q]);var U=o._createDataSource(o._dataSourceDescriptions[q]);null!==U&&(o._dataSources[q]=U)}He(o._zoomRange,o._dataSourceDescriptions),o._mainLayers=Ye(l,s),o._topRasterLayers=Ye(u,s),o._assertLayersIsValid(o._topRasterLayers,o._mainLayers);var Q=o._createTopEngine(),K=Q.topEngine,J=Q.eventGroup;return o._topRasterEngine=K,o._topRasterEngineEventGroup=J,o._applyMode(),o.events=new we(o,C),o.behaviors=new fe(o,f),o.dragger=new Fe(o),o.dragger.addFilter((function(t){return"marker"===(null==t?void 0:t.type)?t.marker.options.draggable:"Feature"===(null==t?void 0:t.type)&&Boolean(t.draggable)})),o._subscribeToDomEvents(),o._handleRotatability(),o._update(),o.on("ready",(function(){o._topRasterEngine.animateFirstScreen=!0,"raster"===o._mainEngine.type&&(o._mainEngine.engine.animateFirstScreen=!0)})),o}return(0,n.ZT)(e,t),Object.defineProperty(e.prototype,"projection",{get:function(){return this._projection},enumerable:!1,configurable:!0}),e.prototype._createCamera=function(t,e,o,i,n){var r;void 0===i&&(i=0),void 0===n&&(n=0),t&&(e=(r=Le(this.projection,t,this.size,this.margin,"snap"===this.zoomRounding,this.zoomRange)).center,o=r.zoom);var a=D(this.projection,e,o,i,this.margin),s=z.B.restrictToZeroWorld(a,this.worldOptions);return this._restrictCamera({zoom:o,worldCenter:s,azimuth:i,tilt:n})},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return this._offset},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this.calculateCenter(this._camera.worldCenter)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldCenter",{get:function(){return this._camera.worldCenter},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoom",{get:function(){return this._camera.zoom},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bounds",{get:function(){return t=this.projection,e=this.center,o=this.zoom,i=this.size,n=this.margin,r=De(i,n),a=Pe(t,e,o),s={x:a.x-r.x/2,y:a.y-r.y/2},u={x:a.x+r.x/2,y:a.y+r.y/2},[Ae(t,s,o),Ae(t,u,o)];var t,e,o,i,n,r,a,s,u},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tilt",{get:function(){return this._camera.tilt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"azimuth",{get:function(){return this._camera.azimuth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fov",{get:function(){return this._mainEngine.engine.fov},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoomRange",{get:function(){for(var t=(0,n.pi)({},this._zoomRange),e=0,o=(0,n.ev)((0,n.ev)([],this._topRasterLayers,!0),this._mainLayers,!0);e<o.length;e++){var i=o[e];if(i.source&&i.source!==O.X_){var r=this._dataSourceDescriptions[i.source];"tile"===r.type&&r.clampMapZoom&&(t=(0,g.Hx)(t,r.zoomRange||this._zoomRange))}}return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInAction",{get:function(){return Boolean(this._animateHandler&&this._animateHandler.isRunning||this.behaviors&&this.behaviors.isInAction)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoomRounding",{get:function(){return this._zoomRounding},enumerable:!1,configurable:!0}),e.prototype.setZoomRounding=function(t){t!==this._zoomRounding&&(this._zoomRounding=t,this._chooseEffectiveZoomRounding())},Object.defineProperty(e.prototype,"effectiveZoomRounding",{get:function(){return this._effectiveZoomRounding},enumerable:!1,configurable:!0}),e.prototype.addObjectFilter=function(t){this._filters.add(t),this._applyFilters()},e.prototype.removeObjectFilter=function(t){this._filters.delete(t),this._applyFilters()},e.prototype.getInvisibleCollidingPrimitives=function(){return this._invisibleCollidingPrimitives},e.prototype.addInvisibleCollidingPrimitives=function(t){var e=this;t.forEach((function(t,o){e._invisibleCollidingPrimitives.set(o,{anchor:e.projection.toGlobalCoordinates(t.anchor),rect:t.rect})})),this._applyInvisibleCollidingPrimitives()},e.prototype.removeInvisibleCollidingPrimitives=function(t){var e=this;t.forEach((function(t){e._invisibleCollidingPrimitives.delete(t)})),this._applyInvisibleCollidingPrimitives()},e.prototype.setObjectHighlight=function(t){this._mainEngine.engine.setObjectHighlight(t),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.setObjectHighlight(t)},e.prototype.calculateCenter=function(t){return function(t,e,o,i,n){if(n){var r=L(n,o,i);e=u.add(e,r)}return t.fromGlobalCoordinates(e)}(this.projection,t,this._camera.zoom,this._camera.azimuth,this._margin)},e.prototype.setProjection=function(t){this._projection=t,this._update()},e.prototype.setCamera=function(t){var e=t.worldCenter,o=t.zoom;isFinite(e.x)&&isFinite(e.y)||(0,A._y)(new Error("Trying to set non-finite center")),isFinite(o)||(0,A._y)(new Error("Trying to set non-finite zoom")),this._camera=this._restrictCamera((0,n.pi)((0,n.pi)({},t),{zoom:o})),this._update()},e.prototype.animate=function(t){var e=this;return this._renderLoop.animate((function(o){var i=e._camera,n=t(i,o);n!==i&&e.setCamera(n)}))},e.prototype.animateForDuration=function(t,e){var o=this,i=0;return this._renderLoop.animateForDuration((function(t){var n=t-i;i=t;var r=o._camera,a=e(r,t,n);a!==r&&o.setCamera(a)}),t)},e.prototype.setZoomRange=function(t){He(t,this._dataSourceDescriptions),this._zoomRange=(0,n.pi)({},t),this._emit("zoomRangeChange")},e.prototype.getMode=function(){return this._desiredMode},e.prototype.getEffectiveMode=function(){return this._effectiveMode},e.prototype.setMode=function(t){this._desiredMode!==t&&(this._desiredMode=t,this._applyMode())},Object.defineProperty(e.prototype,"margin",{get:function(){if(this._margin)return this._margin},enumerable:!1,configurable:!0}),e.prototype.setMargin=function(t){this._margin=t,this._emit("update")},e.prototype.setCenter=function(t){this._setCenterAndZoom(t,this.zoom)},e.prototype._setCenterAndZoom=function(t,e){var o=D(this.projection,t,e,this._camera.azimuth,this._margin);u.areEqual(o,this._camera.worldCenter)||this.setCamera((0,n.pi)((0,n.pi)({},this._camera),{worldCenter:o,zoom:e,azimuth:0,tilt:0}))},e.prototype.setZoom=function(t){var e=this._restrictZoom(t);e!==this._camera.zoom&&(this._camera=this._restrictCamera((0,n.pi)((0,n.pi)({},this._camera),{zoom:e})),this._update())},e.prototype.setBounds=function(t){var e=Le(this.projection,t,this.size,this.margin,"snap"===this.zoomRounding,this.zoomRange),o=e.center,i=e.zoom;this._setCenterAndZoom(o,i)},e.prototype.animateBounds=function(t,e,o){var i=Le(this.projection,t,this.size,this.margin,"snap"===this.zoomRounding,this.zoomRange),n=i.center,r=i.zoom;return this.animateCenterAndZoom(n,r,e,o)},e.prototype.animateCenterAndZoom=function(t,e,o,i){var n=this;this._animateHandler&&this._animateHandler.isRunning&&this._animateHandler.stop();var r=this.zoomRange,a=(0,R.q)(e,r.min,r.max),s=D(this.projection,t,e,this._camera.azimuth,this._margin),u=z.B.moveCloseToCenter(s,this._camera.worldCenter);return this._animateHandler=Pt(this,u,a,o,i),this._animateHandler.complete.then((function(){return n._emit("update")}))},e.prototype.getLayerReadyState=function(t){var e=this._topRasterEngine.getLayerReadyState(t),o=this._mainEngine.engine.getLayerReadyState(t);return e||o},e.prototype.destroy=function(){this._destroyed||(this._emit("beforeDestroy"),this.dragger.destroy(),this.events.destroy(),this.behaviors.destroy(),this._destroyMainEngine(),this._topRasterEngineEventGroup.offAll(),this._topRasterEngine.destroy(),this.container.removeChild(this._topEngineContainer),this.container.removeChild(this._mainEngineContainer),this.container.parentElement.removeChild(this.container),this._destroyed=!0)},e.prototype.resize=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1);var o=Ne(this.container),i=o.size,r=o.offset;if(!u.areEqual(i,this._size)){var a=this._camera.worldCenter;if(t){var s=u.divn(u.sub(i,this._size),2);u.rotate(s,this._camera.azimuth,s);var l=z.B.convertPixelSizeToWorldSize({x:s.x,y:-s.y},this._camera.zoom);a=u.sub(this._camera.worldCenter,l)}var c=z.B.convertPixelSizeToWorldSize(u.divn(i,2),this._camera.zoom);a={x:a.x,y:(0,R.q)(a.y,-1-c.y,1+c.y)},u.areEqual(a,this._camera.worldCenter)||this.setCamera((0,n.pi)((0,n.pi)({},this._camera),{worldCenter:a})),this._size=i,this._offset=r,this._topRasterEngine.resize(this._size),this._mainEngine.engine.resize(this._size),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.resize(this._size),this._emit("resize"),e?this.renderImmediately():this._renderLoop.update()}},e.prototype.addGroup=function(t,e,o,i){void 0===o&&(o={}),void 0===i&&(i=_t.o),this._getGraphicsDataSource(t).addGroup(e,o,i)},e.prototype.removeGroupAndChildren=function(t,e){this._getGraphicsDataSource(t).removeGroupAndChildren(e)},e.prototype.addFeature=function(t,e,o,i){void 0===o&&(o={}),void 0===i&&(i=_t.o);var n=this._convertFeatureToWorld(e),r=n.feature,a=n.bbox;this._getGraphicsDataSource(t).addFeature(r,o,a,i),this._getFeaturesForDataSource(t).set(e.id,e)},e.prototype.addFeatureInWorldCoordinates=function(t,e,o,i){void 0===o&&(o={}),void 0===i&&(i=_t.o);var n=this._convertFeatureToGeo(e),r=n.feature,a=n.bbox;this._getGraphicsDataSource(t).addFeature(e,o,a,i),this._getFeaturesForDataSource(t).set(e.id,r)},e.prototype.getFeatureById=function(t,e){var o,i=this._getFeaturesForDataSource(t);return i.has(e)&&null!==(o=i.get(e))&&void 0!==o?o:null},e.prototype.getFeatureInWorldCoordinatesById=function(t,e){var o,i;return null!==(i=null===(o=this._getGraphicsDataSource(t).getFeatureById(e))||void 0===o?void 0:o.feature)&&void 0!==i?i:null},e.prototype.removeFeatureById=function(t,e){this._getGraphicsDataSource(t).removeFeatureById(e),this._getFeaturesForDataSource(t).delete(e)},e.prototype.updateFeature=function(t,e,o){var i=this._convertFeatureToWorld(e),n=i.feature,r=i.bbox;this._getGraphicsDataSource(t).updateFeature(n,r,o),this._getFeaturesForDataSource(t).set(e.id,e)},e.prototype.updateInWorldCoordinatesFeature=function(t,e,o){var i=this._convertFeatureToGeo(e),n=i.feature,r=i.bbox;this._getGraphicsDataSource(t).updateFeature(e,r,o),this._getFeaturesForDataSource(t).set(e.id,n)},e.prototype.upsertFeature=function(t,e,o,i){void 0===o&&(o={}),void 0===i&&(i=_t.o);var n=this._getGraphicsDataSource(t),r=this._convertFeatureToWorld(e),a=r.feature,s=r.bbox;n.hasFeatureWithId(e.id)?(n.updateFeature(a,s,o),n.moveFeatureToGroup(e.id,i)):n.addFeature(a,o,s,i),this._getFeaturesForDataSource(t).set(e.id,e)},e.prototype.moveFeatureToGroup=function(t,e,o){return void 0===o&&(o=_t.o),this._getGraphicsDataSource(t).moveFeatureToGroup(e,o)},e.prototype.hasFeature=function(t,e){return this._getGraphicsDataSource(t).hasFeatureWithId(e)},e.prototype.createMarker=function(t){return new M(t,this.projection)},e.prototype.addMarker=function(t,e){this._getMarkerDataSource(t).addMarker(e)},e.prototype.removeMarker=function(t,e){this._getMarkerDataSource(t).removeMarker(e)},e.prototype.addTile3d=function(t,e){this._getTile3dDataSource(t).addRootTile(e)},e.prototype.replaceTile3d=function(t,e){this._getTile3dDataSource(t).replaceRootTile(e)},e.prototype.removeTile3d=function(t,e){this._getTile3dDataSource(t).removeRootTile(e)},e.prototype.showTile3d=function(t,e){this._getTile3dDataSource(t).showRootTile(e)},e.prototype.hideTile3d=function(t,e){this._getTile3dDataSource(t).hideRootTile(e)},e.prototype.getTile3dState=function(t,e){return"vector"===this._mainEngine.type?this._mainEngine.engine.getTile3dState(t,e):"transitionToVector"===this._mainEngine.type?this._mainEngine.vector.engine.getTile3dState(t,e):null},e.prototype.setLayers=function(t){var e=t.topRasterLayers,o=t.mainLayers;e&&(this._topRasterLayers=Ye(e,this._dataSourceDescriptions)),o&&(this._mainLayers=Ye(o,this._dataSourceDescriptions)),this._assertLayersIsValid(this._topRasterLayers,this._mainLayers),this._topRasterEngine.setLayers(this._topRasterLayers),"vector"===this._mainEngine.type&&this._mainEngine.initLayersTimer||this._setMainEngineLayers(this._mainLayers),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.setLayersAbortController&&this._mainEngine.vector.engine.setLayers(this._mainLayers),this._chooseEffectiveZoomRounding(),this._handleRotatability(),this._emit("update"),this._emit("copyrightsChange")},e.prototype.getLayers=function(){return{topRasterLayers:this._topRasterLayers.map(Xe),mainLayers:this._mainLayers.map(Xe)}},e.prototype.getDataSource=function(t){var e=this._dataSourceDescriptions[t];return e?(0,b.wo)(e):void 0},e.prototype.addDataSource=function(t,e){this._dataSourceDescriptions[t]=(0,b.wo)(e);var o=this._createDataSource(this._dataSourceDescriptions[t]);null!==o&&(this._dataSources[t]=o),this._setEngineDataSources(this._dataSources)},e.prototype.removeDataSource=function(t){(0,n.ev)((0,n.ev)([],this._mainLayers,!0),this._topRasterLayers,!0).some((function(e){return e.source===t}))&&(0,A._y)(new Error("Can't remove, data source with id=\"".concat(t,' is used"'))),delete this._dataSourceDescriptions[t],delete this._dataSources[t],this._setEngineDataSources(this._dataSources)},e.prototype.updateTileDataSource=function(t,e){var o=this._getTileDataSource(t),i=(0,b.wo)(e);this._dataSourceDescriptions[t]=i,o.setSource(i),He(this._zoomRange,this._dataSourceDescriptions),this._emit("zoomRangeChange"),this._emit("copyrightsChange")},e.prototype.provideVectorMapEngineFactory=function(t){this._vectorMapEngineFactory=t,this._emit("vectorLoad"),"vector"===this._desiredMode&&this._applyMode()},e.prototype.isVectorMapEngineFactoryProvided=function(){return Boolean(this._vectorMapEngineFactory)},e.prototype.findMarkerByElement=function(t){var e=this._topRasterEngine.findMarkerByElement(t);return e?(0,n.pi)((0,n.pi)({},e),{layer:e.layer,source:e.source,marker:e.marker}):null},e.prototype.findObjectInWorldPosition=function(t){var e=this._topRasterEngine.findObjectInPosition(t)||this._mainEngine.engine.findObjectInPosition(t);return this._toMapObject(e)||null},e.prototype.findObjectInWorldPositionEx=function(t){var e=this,o=this._topRasterEngine.findObjectInPositionEx(t),i=(0,r.arrayFind)(o.layers,(function(t){return t.object}))?{layers:[]}:this._mainEngine.engine.findObjectInPositionEx(t);return{layers:(0,n.ev)((0,n.ev)([],o.layers.map((function(t){var o=t.layer,i=t.object;return{layer:o,object:e._toMapObject(i)}})),!0),i.layers.map((function(t){var o=t.layer,i=t.object;return{layer:o,object:e._toMapObject(i)}})),!0)}},e.prototype.renderImmediately=function(t){void 0===t&&(t=v._.FULL),this._renderLoop.renderImmediately(t)},e.prototype.preloadHotspotsInPoint=function(t){var e=z.B.restrictToZeroWorld(t,this.worldOptions);this._topRasterEngine.preloadHotspotsInPoint(e),this._mainEngine.engine.preloadHotspotsInPoint(e),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.preloadHotspotsInPoint(t)},e.prototype.preloadHotspotsForViewport=function(){this._topRasterEngine.preloadHotspotsForViewport(),this._mainEngine.engine.preloadHotspotsForViewport(),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.preloadHotspotsForViewport()},e.prototype.getIndoorPlans=function(){return"vector"===this._mainEngine.type?this._mainEngine.engine.getIndoorPlans():"transitionToVector"===this._mainEngine.type?this._mainEngine.vector.engine.getIndoorPlans():null},e.prototype.getVisibleObjects=function(t){return"vector"===this._mainEngine.type?this._mainEngine.engine.getVisibleObjects(t):"transitionToVector"===this._mainEngine.type?this._mainEngine.vector.engine.getVisibleObjects(t):null},e.prototype._setMainEngineLayers=function(t){this._mainEngine.engine.setLayers(t),"vector"===this._mainEngine.type&&this._mainEngine.cursorController&&this._mainEngine.cursorController.setLayers(t)},e.prototype._setEngineDataSources=function(t){this._topRasterEngine.setDataSources(t),this._mainEngine.engine.setDataSources(t),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.setDataSources(t),"vector"===this._mainEngine.type&&this._mainEngine.cursorController&&this._mainEngine.cursorController.setDataSources(t)},e.prototype._applyMode=function(){var t=this,e=Boolean(this._vectorMapEngineFactory),o=e&&!this._vectorFailed,i="vector"===this._desiredMode&&!e&&!this._vectorFailed&&this._disableRasterPreload?"preVector":o?this._desiredMode:"raster";if(this._effectiveMode===i)return this._setMainEngineLayers(this._mainLayers),void this._renderLoop.update();if(this._effectiveMode=i,"preVector"===this._effectiveMode){var n=new Ce;this._mainEngine={type:"preVector",engine:n,eventGroup:n.group()}}else if("raster"===this._effectiveMode){this._destroyMainEngine();n=new Et(this._size,this._camera,this._renderLoop,this.worldOptions,this.projection,this._dataSources,Be,this._topRasterEngine.animateFirstScreen);this._mainEngineContainer.appendChild(n.element),n.setLayers(this._mainLayers),n.setObjectFilters(this._filters);var r=n.group().on("tilesReady",(function(){return t._emit("ready")})).on("tilesLoaded",(function(){return t._emit("loaded")})).on("stateChanged",(function(){return t._emit("stateChanged")})).on("hotspotsChanged",(function(){return t._emit("hotspotsChanged")}));this._mainEngine={type:"raster",engine:n,eventGroup:r},this._emit("mainEngineChanged"),this._chooseEffectiveZoomRounding(),this._handleRotatability(),this._topRasterEngine.update(this._camera,this._mainEngine.engine.fov)}else{var a,s={init:performance.now(),duration:-1};try{a=this._vectorMapEngineFactory(this._size,this._camera,this._dataSources,this._renderLoop,this.worldOptions)}catch(d){return void this._onVectorError(new Error("ymaps3: failed to create vector engine: ".concat(d)))}if("preVector"===this._mainEngine.type){var u=this._switchMainEngineToVector(a);u.initLayersTimer=setTimeout((function(){var e=a.on("stateChanged",(function(){var o;t._isReadyToShowVector(a)&&(e.offAll(),t._mainEngineContainer.appendChild(a.element),t._emit("vectorStart",{duration:s.duration}),o={vectorStart:s.duration},null==I||I(o))}));t._setVectorLayers(u,s),u.initLayersTimer=void 0}))}else{var l=a.on("internalError",(function(){return t._onVectorError(new Error("vector: internal error"))})).on("indoorPlansChanged",(function(){return t._emit("indoorPlansChanged")})).on("hotspotsChanged",(function(){return t._emit("hotspotsChanged")})).on("tile3dChanged",(function(e){return t._emit("tile3dChanged",e)})).on("tile3dVisibilityChange",(function(e){return t._emit("tile3dVisibilityChange",e)})),c={type:"vector",engine:a,eventGroup:l};this._mainEngine={engine:this._mainEngine.engine,eventGroup:this._mainEngine.eventGroup,type:"transitionToVector",vector:c},this._mainEngine.vector.initLayersTimer=setTimeout((function(){"transitionToVector"===t._mainEngine.type?(l.on("stateChanged",(function(){t._isReadyToShowVector(a,t._mainEngine.engine)&&(l.offAll(),t._finalizeSwitchingToVector(s.duration))})),t._setVectorLayers(c,s),t._mainEngine.vector.initLayersTimer=void 0):t._onVectorError(new Error("ymaps3: unexpected main engine state: ".concat(t._mainEngine.type)))}))}}this._renderLoop.update(),this._emit("indoorPlansChanged")},e.prototype._setVectorLayers=function(t,e){var o=this;return new Promise((function(i){var n=t.engine,r=function(t){o._onVectorError(new Error("ymaps3: failed to set vector layers: ".concat(t)))},s=function(){n.setObjectFilters(o._filters),n.setInvisibleCollidingPrimitives(o._invisibleCollidingPrimitives),e.duration=performance.now()-e.init,i()};try{if(n.initLayersAsync){t.setLayersAbortController=new a.AbortController;var u=t.setLayersAbortController.signal;n.initLayersAsync(o._mainLayers,u).then(s).catch(r)}else n.setLayers(o._mainLayers),s();t.cursorController&&t.cursorController.setLayers(o._mainLayers)}catch(l){r(l)}}))},e.prototype._switchMainEngineToVector=function(t){var e=this;return this._mainEngine.eventGroup.offAll(),this._mainEngine.engine.destroy(),this._mainEngine={type:"vector",engine:t,cursorController:new Re(this,t.element,this._dataSources,this._mainLayers),eventGroup:t.group().on("internalError",(function(){return e._onVectorError(new Error("vector: internal error"))})).on("tilesReady",(function(){return e._emit("ready")})).on("tilesLoaded",(function(){return e._emit("loaded")})).on("stateChanged",(function(){return e._emit("stateChanged")})).on("indoorPlansChanged",(function(){return e._emit("indoorPlansChanged")})).on("tile3dChanged",(function(t){return e._emit("tile3dChanged",t)})).on("tile3dVisibilityChange",(function(t){return e._emit("tile3dVisibilityChange",t)}))},this._topRasterEngine.update(this._camera,this._mainEngine.engine.fov),this._emit("indoorPlansChanged"),this._emit("mainEngineChanged"),this._chooseEffectiveZoomRounding(),this._handleRotatability(),this._mainEngine},e.prototype._isReadyToShowVector=function(t,e){var o=0,i=0,n=0,r=0,a=0,s=0;return this._mainLayers.forEach((function(u){var l=t.getLayerReadyState(u.id);l&&(r+=l.tilesTotal,n+=l.tilesReady),l&&(a+=l.graphicsTotal,s+=l.graphicsReady);var c=null==e?void 0:e.getLayerReadyState(u.id);c&&(i+=c.tilesTotal,o+=c.tilesReady)})),0!==r&&0!==n&&(0===i||s===a&&(n>=.75*r||n/r>=o/i))},e.prototype._finalizeSwitchingToVector=function(t){var e=this;if("transitionToVector"===this._mainEngine.type){var o=this._mainEngine.vector.engine;this._mainEngine.vector.animationAbortController=new a.AbortController;var i=this._mainEngine.vector.animationAbortController.signal,n=this._mainEngineContainer;this._mainEngineContainer=w(Ge),this._mainEngineContainer.appendChild(o.element),this._emit("vectorStart",{duration:t}),function(t,e,o){return new Promise((function(i,n){t.parentElement.insertBefore(e,t),o.addEventListener("abort",(function(){n()})),t.addEventListener("transitionend",(function(){Ve(t),i()})),t.classList.add(Ze),getComputedStyle(t).opacity}))}(n,this._mainEngineContainer,i).then((function(){"transitionToVector"===e._mainEngine.type?e._switchMainEngineToVector(o):e._onVectorError(new Error("ymaps3: unexpected main engine state: ".concat(e._mainEngine.type)))})).catch((function(t){e._onVectorError(new Error("ymaps3: switch to vector aborted: ".concat(t)))}))}else this._onVectorError(new Error("ymaps3: unexpected main engine state: ".concat(this._mainEngine.type)))},e.prototype._handleRotatability=function(){var t,e=this,o=(0,n.ev)((0,n.ev)([],this._topRasterLayers,!0),"vector"!==this._mainEngine.type?this._mainLayers:[],!0).every((function(t){return!e._nonRotatableRasterSources.has(t.source)}));null===(t=this.behaviors)||void 0===t||t.mapToggleRotation(o),!o&&(0!==this._camera.azimuth||this._camera.tilt>0)&&(this._camera=(0,n.pi)((0,n.pi)({},this._camera),{azimuth:0,tilt:0}),this._update())},e.prototype._assertLayersIsValid=function(t,e){for(var o=0,i=e;o<i.length;o++){var a=i[o].source,s=this._dataSourceDescriptions[a];s?"tile"!==s.type||s.hasOwnProperty("vector")?"indoor"!==a||"tile"===s.type&&s.vector&&s.vector.indoorPlanUrl||(0,A._y)(new Error('Source "indoor" has a special meaning and must be a vector indoor data source.')):(0,A._y)(new Error('Source "'.concat(a,'" in main engine does not have vector field'))):(0,A._y)(new Error("Unknown data source ".concat(a)))}var u=(0,n.ev)((0,n.ev)([],e,!0),t,!0).map((function(t){return t.id}));new r.Set(u)},e.prototype._destroyMainEngine=function(){this._mainEngine&&("vector"===this._mainEngine.type&&(this._mainEngine.setLayersAbortController&&this._mainEngine.setLayersAbortController.abort(),this._mainEngine.cursorController&&this._mainEngine.cursorController.destroy(),clearTimeout(this._mainEngine.initLayersTimer),Ve(this._mainEngine.engine.element)),"transitionToVector"===this._mainEngine.type&&(this._mainEngine.vector.animationAbortController&&this._mainEngine.vector.animationAbortController.abort(),this._mainEngine.vector.setLayersAbortController&&this._mainEngine.vector.setLayersAbortController.abort(),clearTimeout(this._mainEngine.vector.initLayersTimer),this._mainEngine.vector.eventGroup.offAll(),Ve(this._mainEngine.vector.engine.element),this._mainEngine.vector.engine.destroy()),this._mainEngine.eventGroup.offAll(),this._mainEngine.engine.destroy())},e.prototype._createTopEngine=function(){var t=this,e=new Et(this._size,this._camera,this._renderLoop,this.worldOptions,this.projection,this._dataSources,(function(e){return t._mainEngine&&"vector"===t._mainEngine.type?function(t){var e=Math.floor(t);return t-e<.5?e:e+1}(e):Be(e)}),!1);this._topEngineContainer.appendChild(e.element);var o=e.group().on("tilesReady",(function(){return t._emit("ready")})).on("tilesLoaded",(function(){return t._emit("loaded")})).on("stateChanged",(function(){return t._emit("stateChanged")})).on("hotspotsChanged",(function(){return t._emit("hotspotsChanged")}));return e.setLayers(this._topRasterLayers),e.setObjectFilters(this._filters),{topEngine:e,eventGroup:o}},e.prototype._update=function(){this._mainEngine.engine.update(this._camera,x),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.update(this._camera,x),this._topRasterEngine.update(this._camera,this._mainEngine.engine.fov),this._renderLoop.update(),this._emit("update")},e.prototype._subscribeToDomEvents=function(){this.container.addEventListener("contextmenu",(function(t){return t.preventDefault()}))},e.prototype.convertScreenToWorldCoordinates=function(t){var e=t.clientX,o=t.clientY,i=(0,C.XA)({x:e,y:o},this);return{worldCoordinates:i,coordinates:this.projection.fromGlobalCoordinates(i)}},e.prototype._restrictZoom=function(t){var e=this.zoomRange,o=e.min,i=e.max;return(0,R.q)(t,o,i)},e.prototype._convertFeatureToWorld=function(t){var e=this;return this._convertAndCalculateBBox(t,(function(t){return e.projection.toGlobalCoordinates(t)}),(function(t,e){return{geo:t,global:e}}))},e.prototype._convertFeatureToGeo=function(t){var e=this;return this._convertAndCalculateBBox(t,(function(t){return e.projection.fromGlobalCoordinates(t)}),(function(t,e){return{geo:e,global:t}}))},e.prototype._convertAndCalculateBBox=function(t,e,o){var i=this,n=1/0,r=-1/0,a=1/0,s=-1/0;return{feature:(0,y.Cr)(t,(function(t){var u=e(t),l=o(t,u),c=l.geo,d=l.global;if(i.worldOptions.cycledX){var p=c[0]<-180||c[0]>180?Math.round(c[0]/360):0;d.x+=2*p}return n=d.x<n?d.x:n,r=d.x>r?d.x:r,a=d.y<a?d.y:a,s=d.y>s?d.y:s,u})),bbox:{minX:n,maxX:r,minY:a,maxY:s}}},e.prototype._getFeaturesForDataSource=function(t){return this._featuresByDataSource.has(t)||this._featuresByDataSource.set(t,new r.Map),this._featuresByDataSource.get(t)},e.prototype._createDataSource=function(t){switch(t.type){case"geojson":return new _t.I({disablePointGeometry:"mapsapi15139"!==this._devpreview.pointGeometry});case"tile":return new k.Nt(t,this.worldOptions);case"markers":return new gt;case"tile3d":return new St.N(t)}return null},e.prototype._getMarkerDataSource=function(t){return this._getDataSourceById(t)},e.prototype._getGraphicsDataSource=function(t){return this._getDataSourceById(t)},e.prototype._getTile3dDataSource=function(t){return this._getDataSourceById(t)},e.prototype._getTileDataSource=function(t){return this._getDataSourceById(t)},e.prototype._getDataSourceById=function(t){return this._dataSources[t]},e.prototype._chooseEffectiveZoomRounding=function(){var t,e=this._effectiveZoomRounding;if("auto"===this._zoomRounding?"vector"===this._effectiveMode&&0!==this._mainLayers.length?this._effectiveZoomRounding="smooth":this._effectiveZoomRounding="snap":this._effectiveZoomRounding=this._zoomRounding,e!==this._effectiveZoomRounding){if("snap"===this._effectiveZoomRounding){var o=je(this._camera.zoom);this.setCamera((0,n.pi)((0,n.pi)({},this._camera),{zoom:o}))}null===(t=this.behaviors)||void 0===t||t._updateZoomRounding(),this._emit("zoomRoundingChanged")}},e.prototype._applyFilters=function(){this._mainEngine.engine.setObjectFilters(this._filters),this._topRasterEngine.setObjectFilters(this._filters),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.setObjectFilters(this._filters)},e.prototype._applyInvisibleCollidingPrimitives=function(){this._mainEngine.engine.setInvisibleCollidingPrimitives(this._invisibleCollidingPrimitives),"transitionToVector"===this._mainEngine.type&&this._mainEngine.vector.engine.setInvisibleCollidingPrimitives(this._invisibleCollidingPrimitives)},e.prototype._toMapObject=function(t){var e=this;if(!t)return t;if("raw-hotspot"===t.type){var o=(0,n.pi)((0,n.pi)({},t.feature),{geometry:t.feature.geometry&&(0,y.ZE)(t.feature.geometry,(function(t){var e=t[0];return[t[1],e]}))});return{type:"hotspot",layer:t.layer,source:t.source,feature:o}}if("hotspot"===t.type){var o=(0,n.pi)((0,n.pi)({},t.feature),{geometry:t.feature.geometry&&(0,y.ZE)(t.feature.geometry,(function(t){return e.projection.fromGlobalCoordinates(t)}))});return{type:"hotspot",layer:t.layer,source:t.source,feature:o}}return"feature"===t.type?(o=this._getFeaturesForDataSource(t.source).get(t.featureId))?{type:"feature",layer:t.layer,source:t.source,feature:o}:null:"marker"===t.type?(0,n.pi)((0,n.pi)({},t),{marker:t.marker}):"empty-object"===t.type?(0,n.pi)({},t):null},e.prototype.updateCameraOptions=function(t){this._cameraOptions=(0,n.pi)((0,n.pi)({},this._cameraOptions),t)},e.prototype._restrictCamera=function(t){var e=this._restrictZoom(t.zoom),o=this._cameraOptions.enabledTiltTransition,i={zoom:e,worldCenter:z.B.fitViewportToWorld(t.worldCenter,{zoom:e,worldOptions:this.worldOptions,size:this.size}),azimuth:(0,R.d)(t.azimuth,0,2*Math.PI),tilt:(0,R.q)(t.tilt,o?H.uB:H.eQ,o?H.dL:H.oU)};return this._worldRestrictMapArea?function(t,e,o,i){var r=De(o,i),a=z.B.convertPixelSizeToWorldSize(r,t.zoom),s=a.x/2,u=-a.y/2,l=t.worldCenter,c=l.x,d=l.y,p=t.worldCenter,h=p.x,_=p.y;return h-s<e[0].x&&(h=e[0].x+s),_-u<e[0].y&&(_=e[0].y+u),h===c&&h+s>e[1].x&&(h=e[1].x-s),_===d&&_+u>e[1].y&&(_=e[1].y-u),h!==c||_!==d?(0,n.pi)((0,n.pi)({},t),{worldCenter:{x:h,y:_}}):t}(i,this._worldRestrictMapArea,this.size,this.margin):i},e}((0,E.GA)().with());function Ne(t){var e=t.getBoundingClientRect(),o=e.top,i=e.left;return{size:{x:t.offsetWidth,y:t.offsetHeight},offset:{top:o,left:i}}}function Ye(t,e){var o={};return t.map((function(t){var i="string"==typeof t?(0,O.F7)(t):t,n=(0,O.XK)(i);if(n.source===O.X_||e[n.source]||(0,A._y)(new Error('Nonexistent data source "'.concat(n.source,'" in "').concat(i.id,'"'))),n.source!==O.X_&&"markers"===e[n.source].type)if(o[n.source]){var r='Marker data source "'.concat(n.source,'" is already used in layer "').concat(i.id,'". ');r+="Marker data source can be used to construct only one layer",(0,A._y)(new Error(r))}else o[n.source]=!0;return n}))}function He(t,e){(0,g.i3)(t);for(var o=(0,n.pi)({},t),i=0,r=Object.keys(e);i<r.length;i++){var a=e[r[i]];if("tile"===a.type&&(a.zoomRange&&(0,g.i3)(a.zoomRange),a.clampMapZoom)){var s=a.zoomRange||t;(0,g.Hx)(o,s,o)}}(0,g.i3)(o)}function Xe(t){return t.id}function Ve(t){t.parentElement&&t.parentElement.removeChild(t)}var qe=o(45428);function Ue(t){var e,o=function(){if(!t.behaviors.isInAction&&e){var o={x:e.clientX,y:e.clientY},i=(0,C.XA)(o,t);t.preloadHotspotsInPoint(i)}},i=function(t){e=t,o()},n=t.behaviors.on("actionEnd",(function(){o()})),r=t.on("beforeDestroy",(function(){r.offAll(),n.offAll(),t.container.removeEventListener("mousemove",i)}));t.container.addEventListener("mousemove",i)}function Qe(t){var e,o=t.behaviors.on("actionStart",(function(){e&&(e.offAll(),e=void 0)})).on("actionEnd",(function(){e||t.behaviors.isInAction||(t.preloadHotspotsForViewport(),e=t.on("update",(function(){return t.preloadHotspotsForViewport()})))})),i=t.on("beforeDestroy",(function(){i.offAll(),o.offAll(),e&&(e.offAll(),e=void 0)}));e=t.on("update",(function(){return t.preloadHotspotsForViewport()}))}function Ke(t){var e=(0,k.B5)(t);return function(t,o,i,n){return function(t,e){if(e.aborted)return Promise.reject(new G._);var o=new XMLHttpRequest;o.open("get",t,!0);var i=o.abort.bind(o);e.addEventListener("abort",i);var n=new Promise((function(e,i){o.onload=function(){if(200===o.status)try{e(JSON.parse(o.responseText))}catch(n){(0,A.H)(n),i(n)}else if(204===o.status)e(null);else{var t=new Error("Bad status code: ".concat(o.status));(0,A.H)(t),i(t)}},o.onerror=function(){var e=new Error("Error on GET to ".concat(t,". ").concat(o.status,", ").concat(o.statusText,". ").concat(o.response));(0,A.H)(e),i(e)},o.onabort=function(){return i(new G._)}}));return o.send(),(0,s.promiseFinally)(n,(function(){return e.removeEventListener("abort",i)}))}(e(t,o,i,1),n).then((function(t){if(!t||t.error&&404===t.error.code)return[];if(t.error)throw new Error("Server sent an error (code = ".concat(t.error.code,"): ").concat(t.error.message));return(0,y.$7)(t.data).map((function(t){return{type:"rendered",feature:Je(t),geometry:(0,y.ZE)(t.properties.HotspotMetaData.RenderedGeometry,(function(t){return{x:t[0],y:t[1]}}))}}))})).catch((function(t){(0,A._y)(t)}))}}function Je(t){var e=t.properties.URIMetaData;return{type:"Feature",id:String(t.properties.HotspotMetaData.id),geometry:t.geometry,properties:(0,n.pi)((0,n.pi)({},t.properties),{uri:(e&&e.URIs[0]||{}).uri})}}var $e=o(51127),to=(0,n.pi)((0,n.pi)((0,n.pi)({},r),a),s)},88084:(t,e,o)=>{"use strict";o.r(e),o.d(e,{AbortController:()=>i});var i,n=o(41372),r=o(86457),a="undefined"!=typeof window?window:{};if(a.AbortController)i=a.AbortController;else{var s=function(t){function e(e){var o=t.call(this)||this;return o.onabort=null,o._controller=e,o}return(0,n.ZT)(e,t),Object.defineProperty(e.prototype,"aborted",{get:function(){return this._controller.aborted},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"reason",{get:function(){return this.aborted?this._controller.reason:void 0},enumerable:!1,configurable:!0}),e.prototype.addEventListener=function(t,e){this.on(String(t),e)},e.prototype.removeEventListener=function(t,e){this.offSingle(String(t),e)},e.prototype.dispatchEvent=function(t){return this.onabort&&this.onabort(t),this._emit(t.type,t),!1},e.prototype.throwIfAborted=function(){if(this.aborted)throw new Error(this.reason)},e}((0,r.GA)().with());i=function(){function t(){this._aborted=!1,this._reason=void 0,this.signal=new s(this)}return t.prototype.abort=function(t){if(!this._aborted){this._aborted=!0,this._reason=t;var e=document.createEvent("Event");e.initEvent("abort",!1,!1),this.signal.dispatchEvent(e)}},Object.defineProperty(t.prototype,"aborted",{get:function(){return this._aborted},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reason",{get:function(){return this._reason},enumerable:!1,configurable:!0}),t}()}},9902:(t,e,o)=>{"use strict";o.r(e),o.d(e,{mathSign:()=>r,mathLog2:()=>a,mathLog10:()=>s,arrayFindIndex:()=>_,arrayFind:()=>m,arrayFrom:()=>f,arraySome:()=>b,Symbol:()=>l,Map:()=>d,Set:()=>h,WeakMap:()=>p,MAX_SAFE_INTEGER:()=>u});var i=o(27486),n={},r=Math.sign?Math.sign.bind(Math):function(t){return t<0?-1:0===t?0:1},a=Math.log2?Math.log2.bind(Math):function(t){return Math.log(t)*Math.LOG2E},s=Math.log10?Math.log10.bind(Math):function(t){return Math.log(t)/Math.LN10},u=Number.MAX_SAFE_INTEGER||9007199254740991,l="undefined"==typeof Symbol?function(t){return"__Symbol_".concat(t,"_").concat(Date.now(),"_").concat(Math.random())}:Symbol,c=function(t){return new t([[n,1]]).has(n)?function(e){return new t(e)}:function(e){var o=new t;if(void 0!==e)for(var i=0,n=e;i<n.length;i++){var r=n[i],a=r[0],s=r[1];o.set(a,s)}return o}},d=c(Map),p=c(WeakMap),h=new Set([n]).has(n)?function(t){return new Set(t)}:function(t){var e=new Set;if(void 0!==t)for(var o=0,i=t;o<i.length;o++){var n=i[o];e.add(n)}return e};d.prototype=Map.prototype,p.prototype=WeakMap.prototype,h.prototype=Set.prototype;var _=Boolean(Array.prototype.findIndex)?function(t,e,o){return t.findIndex(e,o)}:function(t,e,o){for(var i=0;i<t.length;i++)if(e.call(o,t[i],i,t))return i;return-1},m=Boolean(Array.prototype.find)?function(t,e,o){return t.find(e,o)}:function(t,e,o){var i=_(t,e,o);return-1===i?void 0:t[i]},f=Array.from?Array.from:function(t){var e=this,o=Object(t);null==t&&(0,i._y)(new TypeError("Array.from requires an array-like object - not null or undefined"));var n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;void 0===n||v(n)||(0,i._y)(new TypeError("Array.from: when provided, the second argument must be a function"));for(var a=g(o.length),s=v(e)?Object(new e(a)):new Array(a),u=0;u<a;){var l=o[u];s[u]=n?void 0===r?n(l,u):n.call(r,l,u):l,u+=1}return s.length=a,s},y=Object.prototype.toString;function v(t){return"function"==typeof t||"[object Function]"===y.call(t)}function g(t){var e=Number(t);return isNaN(e)||e<=0?0:Math.min(e,u)}var b=function(t,e,o){return-1!==_(t,e,o)}},80414:(t,e,o)=>{"use strict";o.r(e),o.d(e,{queueMicrotask:()=>r,Promise:()=>i,promiseFinally:()=>a});var i=Promise,n=i.resolve(),r=function(t){return n.then(t)},a=function(t,e){var o=Promise.resolve(t);return"finally"in o?o.finally(e):o.then((function(t){return Promise.resolve(e()).then((function(){return Promise.resolve(t)}))}),(function(t){return Promise.resolve(e()).then((function(){return Promise.reject(t)}))}))}},39670:(t,e,o)=>{"use strict";o.d(e,{x:()=>a});var i=o(41372),n=o(86457),r=o(87619),a=function(t){function e(e){var o=t.call(this)||this;return o.state=r.A,o}return(0,i.ZT)(e,t),e.prototype.findObjectInPosition=function(t){return null},e.prototype._requestRender=function(){this._emit("requestRender")},e.prototype.update=function(t){},e.prototype.resize=function(t){},e.prototype.render=function(t){},e}((0,n.GA)().with())},87619:(t,e,o)=>{"use strict";o.d(e,{A:()=>i});var i={tilesLoaded:0,tilesReady:0,tilesTotal:0,borderLoaded:0,borderReady:0,borderTotal:0,graphicsReady:0,graphicsTotal:0}},77122:(t,e,o)=>{"use strict";o.d(e,{K:()=>f});var i=o(41372),n=o(9902),r=o(80414),a=o(2194),s=o(86457),u=o(67444),l=o(29306),c=o(85623),d=o(88367),p=o(77698),h=o(27486),_=o(34009),m=function(){},f=function(t){function e(e,o,i,r,a,s){var u=t.call(this)||this;return u._newTiles=new n.Map,u._loadingTiles=new n.Map,u._readyTiles=new n.Map,u._size=e,u._camera=o,u._tileSource=i,u._zoomRoundingRule=s,u._worldOptions=a,u._queue=r,u}return(0,i.ZT)(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return{tilesLoaded:0,tilesReady:0,tilesTotal:0,borderTotal:0,borderLoaded:0,borderReady:0,graphicsTotal:0,graphicsReady:0}},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._loadingTiles.forEach((function(t){t.abortController.abort()}))},e.prototype.preloadHotspotsInPoint=function(t){for(var e=this._zoomRoundingRule(this._camera.zoom),o=!1,i=0,n=this._computeAffectedTiles(t,e);i<n.length;i++){var r=n[i],s=(0,a.vD)(r,r.zoom);this._isTileDataReadyOrLoading(s)||this._newTiles.has(s)||(this._newTiles.set(s,{id:r}),o=!0)}var u=this._stopLoadingTilesOutsideRadius(t);(o||u)&&this._emit("hotspotsChanged"),o&&this._emit("requestRender")},e.prototype.preloadHotspotsForViewport=function(){for(var t=this,e=this._getTilesForViewport().filter((function(e){return!t._isTileDataReadyOrLoading((0,a.vD)(e,e.zoom))})),o=!1,i=0,n=e;i<n.length;i++){var r=n[i],s=(0,a.vD)(r,r.zoom);this._isTileDataReadyOrLoading(s)||this._newTiles.has(s)||(this._newTiles.set(s,{id:r}),o=!0)}o&&(this._emit("hotspotsChanged"),this._emit("requestRender"))},e.prototype.resize=function(t){p.areEqual(t,this._size)||(this._size=t,this._removeTilesOutsideViewport()&&this._emit("hotspotsChanged"))},e.prototype.update=function(t,e){var o=t.worldCenter,i=t.zoom;o===this._camera.worldCenter&&i===this._camera.zoom||(this._camera=t,this._removeTilesOutsideViewport()&&this._emit("hotspotsChanged"))},e.prototype.render=function(t){var e=this;t.qualityHint<_._.FULL||this._camera.zoom<this._tileSource.zoomRange.min||this._camera.zoom>this._tileSource.zoomRange.max||(this._newTiles.forEach((function(t){var o=(0,a.vD)(t.id,t.id.zoom),n=e._loadTile(t);e._loadingTiles.set(o,n),(0,r.promiseFinally)(n.promise.then((function(r){var a=r.map((function(o){return"world"===o.type?o:function(t,e,o){var i=p.muln(e,o);return{type:"world",feature:t.feature,geometry:(0,c.ZE)(t.geometry,(function(t){return l.B.pixelsToWorld(p.add(t,i),e.zoom)}))}}(o,t.id,e._tileSource.tileSize)})),s=e._zoomRoundingRule(e._camera.zoom),u=e._tileSource.padding/l.B.getWorldPixelSize(s),d=0===e._tileSource.padding?a:a.map((function(t){return(0,i.pi)((0,i.pi)({},t),{geometry:v(t.geometry,u)})}));e._readyTiles.set(o,{id:n.id,hotspots:d}),e._emit("hotspotsChanged")})),(function(){return e._loadingTiles.delete(o)})).catch((function(t){t&&"AbortError"===t.name||(0,h._y)(t)}))})),this._newTiles.clear())},e.prototype.findObjectInPosition=function(t){for(var e,o,i=l.B.restrictToZeroWorld(t,this._worldOptions),n=this._zoomRoundingRule(this._camera.zoom),r=!0,s=0,c=this._computeAffectedTiles(i,n);s<c.length;s++){var d=c[s],p=this._readyTiles.get((0,a.vD)(d,n));if(p)for(var h=p.hotspots.length-1;h>=0;h--){var _=p.hotspots[h];if((0,u.R)(_.geometry,i))return{type:"raw-hotspot",feature:_.feature}}else r=!1}var m=null===(o=(e=this._tileSource).internalFindHotspotInPosition)||void 0===o?void 0:o.call(e,i,n);return m||(r?null:void 0)},e.prototype._stopLoadingTilesOutsideRadius=function(t){var e=this._zoomRoundingRule(this._camera.zoom),o=p.divn(l.B.worldToPixels(t,e),this._tileSource.tileSize),i=Math.max(this._tileSource.hotspotAbortRadius,this._tileSource.inset)/this._tileSource.tileSize,n=y(this._loadingTiles,(function(t){return function(t,e,o){var i=p.create((0,d.q)(e.x,t.x,t.x+1),(0,d.q)(e.y,t.y,t.y+1));return p.sub(i,e,i),p.length2(i)<=Math.pow(o,2)}(t.id,o,i)}),(function(t){return t.abortController.abort()}));return n},e.prototype._removeTilesOutsideViewport=function(){var t=this._zoomRoundingRule(this._camera.zoom),e=l.B.getScale(t,this._camera.zoom),o=p.create(this._size.x+2*this._tileSource.inset,this._size.y+2*this._tileSource.inset),i=l.B.worldToPixels(this._camera.worldCenter,t),n=(0,a.TG)(i,o,e,this._tileSource.tileSize),r=function(e){var o=e.id;return o.zoom===t&&o.x<=n.maxX&&o.x+1>=n.minX&&o.y<=n.maxY&&o.y+1>=n.minY},s=y(this._newTiles,r),u=y(this._loadingTiles,r,(function(t){return t.abortController.abort()})),c=y(this._readyTiles,r);return s||u||c},e.prototype._isTileDataReadyOrLoading=function(t){return this._loadingTiles.has(t)||this._readyTiles.has(t)},e.prototype._getTilesForViewport=function(){for(var t=this._zoomRoundingRule(this._camera.zoom),e=l.B.getScale(t,this._camera.zoom),o=l.B.worldToPixels(this._camera.worldCenter,t),i=(0,a.TG)(o,this._size,e,this._tileSource.tileSize),n=[],r=i.minX;r<=i.maxX;r++)for(var s=i.minY;s<=i.maxY;s++)n.push({x:r,y:s,zoom:t});return n},e.prototype._loadTile=function(t){var e=this,o=(0,a.Su)(t.id.zoom,this._tileSource.tileSize),i=p.applyFunction(t.id,(function(t){return(0,d.d)(t,0,o)})),n=this._queue.enqueue((function(o){var n=e._tileSource.fetchHotspots;return!o.aborted&&n?Promise.resolve(n(i.x,i.y,t.id.zoom,o)).catch((function(t){return(0,h._y)(t)})):Promise.resolve([])})),r=n.promise,s=n.abortController;return{id:t.id,abortController:s,promise:r}},e.prototype._computeAffectedTiles=function(t,e){var o=l.B.worldToTile(t,e,this._tileSource.tileSize),i=p.applyFunction(o,Math.floor),n=p.sub(o,i);p.muln(n,this._tileSource.tileSize,n);var r=n.x<this._tileSource.inset,a=n.x>this._tileSource.tileSize-this._tileSource.inset,s=n.y<this._tileSource.inset,u=n.y>this._tileSource.tileSize-this._tileSource.inset,c=[{x:i.x,y:i.y,zoom:e}];return r&&c.push({x:i.x-1,y:i.y,zoom:e}),a&&c.push({x:i.x+1,y:i.y,zoom:e}),s&&c.push({x:i.x,y:i.y-1,zoom:e}),u&&c.push({x:i.x,y:i.y+1,zoom:e}),r&&s&&c.push({x:i.x-1,y:i.y-1,zoom:e}),r&&u&&c.push({x:i.x-1,y:i.y+1,zoom:e}),a&&s&&c.push({x:i.x+1,y:i.y-1,zoom:e}),a&&u&&c.push({x:i.x+1,y:i.y+1,zoom:e}),c},e}((0,s.GA)().with());function y(t,e,o){void 0===o&&(o=m);var i=!1;return t.forEach((function(n,r){e(n)||(o(n),t.delete(r),i=!0)})),i}function v(t,e){if("Polygon"!==t.type)return t;for(var o=t.coordinates[0],i=o.reduce((function(t,e){return p.add(t,e,t)}),p.create(0,0)),n=p.divn(i,o.length),r=1+e/o.reduce((function(t,e){return Math.max(t,p.length(p.sub(e,n)))}),0),a=0,s=o;a<s.length;a++){var u=s[a],l=p.sub(u,n);p.muln(l,r,l),p.add(l,n,u)}return t}}}]);